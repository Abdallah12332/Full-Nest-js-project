9b25f808f6c8b7f456e043b8eb8f4505
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
/* eslint-disable @typescript-eslint/no-unsafe-assignment */
// موكات يجب أن تكون قبل أي imports تصلح لـ hoisting
jest.mock("./generation", () => ({
    generation: jest.fn(() => ({
        num: 123456,
        expiresAt: new Date("2025-11-03T22:08:23.789Z"),
    })),
}));
// mock bcryptjs قبل الاستيراد
jest.mock("bcryptjs", () => ({
    __esModule: true,
    compare: jest.fn(),
    hash: jest.fn(),
    default: {
        compare: jest.fn(),
        hash: jest.fn(),
    },
}));
const bcrypt = __importStar(require("bcryptjs"));
const testing_1 = require("@nestjs/testing");
const typeorm_1 = require("@nestjs/typeorm");
const jwt_1 = require("@nestjs/jwt");
const config_1 = require("@nestjs/config");
const auth_service_1 = require("./auth.service");
const User_entity_1 = require("../entities/User.entity");
const Cart_entity_1 = require("../entities/Cart.entity");
const Verification_entity_1 = require("../entities/Verification.entity");
const FailedAttempt_entity_1 = require("../entities/FailedAttempt.entity");
const PasswordReset_entity_1 = require("../entities/PasswordReset.entity");
const Mailer_1 = require("./Mailer");
const BlackList_entity_1 = require("../entities/BlackList.entity");
const response_dto_1 = require("../common/dto/response.dto");
describe("AuthService", () => {
    let service;
    let emailService;
    // Repos كلها معرفة بالـ methods اللي يستخدمهم service
    const mockUserRepository = {
        findOne: jest.fn(),
        create: jest.fn(),
        save: jest.fn(),
        update: jest.fn(),
        delete: jest.fn(),
        find: jest.fn(),
    };
    const mockCartRepository = {
        findOne: jest.fn(),
        create: jest.fn(),
        save: jest.fn(),
        update: jest.fn(),
        delete: jest.fn(),
        find: jest.fn(),
    };
    const mockVerificationRepository = {
        findOne: jest.fn(),
        create: jest.fn(),
        save: jest.fn(),
        update: jest.fn(),
        delete: jest.fn(),
        find: jest.fn(),
    };
    const mockFailedAttemptRepository = {
        findOne: jest.fn(),
        create: jest.fn(),
        save: jest.fn(),
        update: jest.fn(),
        delete: jest.fn(),
        find: jest.fn(),
    };
    const mockPasswordResetRepository = {
        findOne: jest.fn(),
        create: jest.fn(),
        save: jest.fn(),
        update: jest.fn(),
        delete: jest.fn(),
        find: jest.fn(),
    };
    const mockBlacklistRepository = {
        findOne: jest.fn(),
        create: jest.fn(),
        save: jest.fn(),
        update: jest.fn(),
        delete: jest.fn(),
        find: jest.fn(),
    };
    beforeEach(async () => {
        // مسح الـ mocks
        jest.clearAllMocks();
        // قيم افتراضية للـ bcrypt
        bcrypt.hash.mockResolvedValue("hashed-password");
        bcrypt.compare.mockResolvedValue(true);
        const module = await testing_1.Test.createTestingModule({
            providers: [
                auth_service_1.AuthService,
                {
                    provide: jwt_1.JwtService,
                    useValue: {
                        sign: jest.fn().mockReturnValue("mock-jwt-token"),
                        verify: jest.fn().mockReturnValue({ sub: "test-uuid" }),
                    },
                },
                {
                    provide: config_1.ConfigService,
                    useValue: {
                        get: jest.fn(),
                    },
                },
                { provide: (0, typeorm_1.getRepositoryToken)(User_entity_1.User), useValue: mockUserRepository },
                { provide: (0, typeorm_1.getRepositoryToken)(Cart_entity_1.Cart), useValue: mockCartRepository },
                {
                    provide: (0, typeorm_1.getRepositoryToken)(Verification_entity_1.Verification),
                    useValue: mockVerificationRepository,
                },
                {
                    provide: (0, typeorm_1.getRepositoryToken)(FailedAttempt_entity_1.FailedAttempt),
                    useValue: mockFailedAttemptRepository,
                },
                {
                    provide: (0, typeorm_1.getRepositoryToken)(PasswordReset_entity_1.PasswordReset),
                    useValue: mockPasswordResetRepository,
                },
                {
                    provide: (0, typeorm_1.getRepositoryToken)(BlackList_entity_1.RefreshTokenBlacklist),
                    useValue: mockBlacklistRepository,
                },
                {
                    provide: Mailer_1.EmailService,
                    useValue: {
                        Mailer: jest.fn().mockResolvedValue("Email sent!"),
                        sendPasswordResetEmail: jest
                            .fn()
                            .mockResolvedValue("Password reset email sent!"),
                    },
                },
            ],
        }).compile();
        service = module.get(auth_service_1.AuthService);
        emailService = module.get(Mailer_1.EmailService);
    });
    it("should be defined", () => {
        expect(service).toBeDefined();
    });
    describe("register_half", () => {
        const email = "new@example.com";
        const ip = "127.0.0.1";
        beforeEach(() => {
            // إعادة تعيين bcrypt في بداية كل اختبار
            bcrypt.hash.mockResolvedValue("hashed-password");
            bcrypt.compare.mockResolvedValue(true);
            mockFailedAttemptRepository.findOne.mockResolvedValue(null);
        });
        it("should send verification email if user does not exist", async () => {
            mockUserRepository.findOne.mockResolvedValueOnce(null);
            mockVerificationRepository.findOne.mockResolvedValueOnce(null);
            const mailerSpy = jest
                .spyOn(emailService, "Mailer")
                .mockResolvedValue("Email sent!");
            await service.register_half(email, ip);
            expect(mailerSpy).toHaveBeenCalledWith(email, expect.objectContaining({
                code: expect.anything(),
                expiresAt: expect.any(Date),
            }));
            mailerSpy.mockRestore();
        });
        it("should throw when user already exists", async () => {
            mockUserRepository.findOne.mockResolvedValueOnce({ email });
            await expect(service.register_half(email, ip)).rejects.toThrow("انت لديك حساب انتقل الي صفحه تسجيل الدخول (login page)");
        });
        it("should update existing verification record", async () => {
            mockUserRepository.findOne.mockResolvedValueOnce(null);
            mockVerificationRepository.findOne.mockResolvedValueOnce({ email });
            const result = await service.register_half(email, ip);
            expect(mockVerificationRepository.update).toHaveBeenCalledWith({ email }, expect.objectContaining({
                code: expect.anything(),
                expiresAt: expect.any(Date),
            }));
            expect(result).toBeInstanceOf(response_dto_1.ApiResponse);
            expect(result.success).toBe(true);
            expect(result.message).toBe("Email sent!");
            expect(result.data).toBeUndefined();
        });
    });
    describe("register_full", () => {
        const email = "user@example.com";
        const code = "123456";
        const ipAddress = "127.0.0.1";
        beforeEach(() => {
            bcrypt.hash.mockResolvedValue("hashed-password");
            bcrypt.compare.mockResolvedValue(true);
        });
        it("should throw NotFoundException if verification record not found", async () => {
            mockVerificationRepository.findOne.mockResolvedValueOnce(null);
            await expect(service.register_full(email, code, ipAddress)).rejects.toThrow("Email:code not found");
        });
        it("should throw BadRequestException if code is expired", async () => {
            mockVerificationRepository.findOne.mockResolvedValueOnce({
                email,
                code,
                expiresAt: new Date(Date.now() - 10000),
            });
            await expect(service.register_full(email, code, ipAddress)).rejects.toThrow("code is expired");
        });
        it("should throw BadRequestException if code is invalid", async () => {
            mockVerificationRepository.findOne.mockResolvedValueOnce({
                email,
                code: "000000",
                expiresAt: new Date(Date.now() + 10000),
            });
            const recordFailedAttemptSpy = jest.spyOn(service, "recordFailedAttempt");
            await expect(service.register_full(email, code, ipAddress)).rejects.toThrow("invalid code");
            expect(recordFailedAttemptSpy).toHaveBeenCalledWith(email, ipAddress, "verification");
        });
        it("should create user and cart if code valid", async () => {
            mockVerificationRepository.findOne.mockResolvedValueOnce({
                email,
                code,
                expiresAt: new Date(Date.now() + 10000),
            });
            mockUserRepository.create.mockReturnValueOnce({
                email,
                provider: "local",
                isVerified: false,
                googleId: undefined,
                role: "user",
            });
            mockUserRepository.save.mockResolvedValueOnce({ id: 1, email });
            mockCartRepository.create.mockReturnValueOnce({ id: 10 });
            mockCartRepository.save.mockResolvedValueOnce({ id: 10 });
            const clearFailedAttemptsSpy = jest.spyOn(service, "clearFailedAttempts");
            const result = await service.register_full(email, code, ipAddress);
            expect(clearFailedAttemptsSpy).toHaveBeenCalledWith(email, ipAddress, "verification");
            expect(mockVerificationRepository.delete).toHaveBeenCalledWith({ email });
            expect(mockUserRepository.create).toHaveBeenCalledWith({
                email,
                provider: "local",
                isVerified: false,
                googleId: undefined,
                role: "user",
            });
            expect(mockCartRepository.create).toHaveBeenCalledWith({
                user: expect.objectContaining({ email }),
            });
            expect(result).toBeInstanceOf(response_dto_1.ApiResponse);
            expect(result.success).toBe(true);
            expect(result.message).toBe("Code verified successfully");
        });
    });
    describe("register_complete", () => {
        const email = "new@example.com";
        const password = "securePassword123";
        beforeEach(() => {
            bcrypt.hash.mockResolvedValue("hashed-password");
            bcrypt.compare.mockResolvedValue(true);
        });
        it("should throw NotFoundException if user not found", async () => {
            mockUserRepository.findOne.mockResolvedValueOnce(null);
            await expect(service.register_complete(email, password)).rejects.toThrow("user not found");
        });
        it("should complete registration and return tokens", async () => {
            const user = { id: "uuid-123", email, role: "user", isVerified: false };
            mockUserRepository.findOne.mockResolvedValueOnce(user);
            bcrypt.hash
                .mockResolvedValueOnce("hashed-password")
                .mockResolvedValueOnce("hashed-refresh");
            const jwtService = service["jwtService"];
            const configService = service["configService"];
            jest.spyOn(jwtService, "sign").mockReturnValue("mock-token");
            jest.spyOn(configService, "get").mockReturnValue("1h");
            mockUserRepository.update.mockResolvedValueOnce({ affected: 1 });
            const result = await service.register_complete(email, password);
            expect(mockUserRepository.findOne).toHaveBeenCalledWith({
                where: { email },
            });
            expect(mockUserRepository.update).toHaveBeenCalledWith({ email }, expect.objectContaining({
                password: expect.any(String),
                isVerified: true,
                refresh_Token: expect.any(String),
            }));
            expect(result).toEqual({
                access_token: "mock-token",
                refresh_Token: "mock-token",
            });
        });
    });
    describe("login", () => {
        const email = "user@example.com";
        const password = "password123";
        const ipAddress = "127.0.0.1";
        beforeEach(() => {
            jest.clearAllMocks();
            bcrypt.compare.mockResolvedValue(true);
        });
        it("should throw NotFoundException if user not found", async () => {
            mockUserRepository.findOne.mockResolvedValueOnce(null);
            const recordSpy = jest.spyOn(service, "recordFailedAttempt");
            await expect(service.login(email, password, ipAddress)).rejects.toThrow("User not found");
            expect(recordSpy).toHaveBeenCalledWith(email, ipAddress, "login");
        });
        it("should throw NotFoundException if password not set", async () => {
            mockUserRepository.findOne.mockResolvedValueOnce({
                email,
                password: null,
            });
            const recordSpy = jest.spyOn(service, "recordFailedAttempt");
            await expect(service.login(email, password, ipAddress)).rejects.toThrow("password not set");
            expect(recordSpy).toHaveBeenCalledWith(email, ipAddress, "login");
        });
        it("should throw NotFoundException if password argument missing", async () => {
            mockUserRepository.findOne.mockResolvedValueOnce({
                email,
                password: "hashed",
            });
            const recordSpy = jest.spyOn(service, "recordFailedAttempt");
            await expect(service.login(email, undefined, ipAddress)).rejects.toThrow("write password");
            expect(recordSpy).toHaveBeenCalledWith(email, ipAddress, "login");
        });
        it("should throw UnauthorizedException if user is not verified", async () => {
            mockUserRepository.findOne.mockResolvedValueOnce({
                email,
                password: "hashed",
                isVerified: false,
            });
            await expect(service.login(email, password, ipAddress)).rejects.toThrow("blocked");
        });
        it("should throw BadRequestException if password is wrong", async () => {
            bcrypt.compare.mockResolvedValueOnce(false);
            mockUserRepository.findOne.mockResolvedValueOnce({
                email,
                password: "hashed",
                isVerified: true,
            });
            const recordSpy = jest.spyOn(service, "recordFailedAttempt");
            await expect(service.login(email, password, ipAddress)).rejects.toThrow("password is wrong");
            expect(recordSpy).toHaveBeenCalledWith(email, ipAddress, "login");
        });
        it("should login successfully and return tokens", async () => {
            const user = {
                id: "uuid-1",
                email,
                password: "hashed",
                isVerified: true,
            };
            mockUserRepository.findOne.mockResolvedValueOnce(user);
            const clearSpy = jest.spyOn(service, "clearFailedAttempts");
            const result = await service.login(email, password, ipAddress);
            expect(clearSpy).toHaveBeenCalledWith(email, ipAddress, "login");
            expect(mockUserRepository.update).toHaveBeenCalledWith({ email }, { refresh_Token: expect.any(String) });
            expect(result).toEqual({
                access_token: "mock-jwt-token",
                refresh_Token: "mock-jwt-token",
            });
        });
        it("should login successfully without email/ip (no rate limiting)", async () => {
            const user = {
                id: "uuid-1",
                email,
                password: "hashed",
                isVerified: true,
            };
            mockUserRepository.findOne.mockResolvedValueOnce(user);
            const result = await service.login(email, password);
            expect(result).toEqual({
                access_token: "mock-jwt-token",
                refresh_Token: "mock-jwt-token",
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvb21hci9EZXNrdG9wL1Byb3RvZm9saW9fd2l0aG91dF9yZWRpcy9zcmMvYXV0aC9hdXRoLnNlcnZpY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDREQUE0RDtBQUM1RCxvREFBb0Q7QUFDcEQsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUMvQixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ3pCLEdBQUcsRUFBRSxNQUFNO1FBQ1gsU0FBUyxFQUFFLElBQUksSUFBSSxDQUFDLDBCQUEwQixDQUFDO0tBQ2hELENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyxDQUFDO0FBRUosOEJBQThCO0FBQzlCLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDM0IsVUFBVSxFQUFFLElBQUk7SUFDaEIsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDbEIsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDZixPQUFPLEVBQUU7UUFDUCxPQUFPLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNsQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtLQUNoQjtDQUNGLENBQUMsQ0FBQyxDQUFDO0FBRUosaURBQW1DO0FBQ25DLDZDQUFzRDtBQUN0RCw2Q0FBcUQ7QUFDckQscUNBQXlDO0FBQ3pDLDJDQUErQztBQUUvQyxpREFBNkM7QUFDN0MseURBQStDO0FBQy9DLHlEQUErQztBQUMvQyx5RUFBK0Q7QUFDL0QsMkVBQWlFO0FBQ2pFLDJFQUFpRTtBQUNqRSxxQ0FBd0M7QUFDeEMsbUVBQXFFO0FBQ3JFLDZEQUF5RDtBQUd6RCxRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtJQUMzQixJQUFJLE9BQW9CLENBQUM7SUFDekIsSUFBSSxZQUEwQixDQUFD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QUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL29tYXIvRGVza3RvcC9Qcm90b2ZvbGlvX3dpdGhvdXRfcmVkaXMvc3JjL2F1dGgvYXV0aC5zZXJ2aWNlLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1hc3NpZ25tZW50ICovXG4vLyDZhdmI2YPYp9iqINmK2KzYqCDYo9mGINiq2YPZiNmGINmC2KjZhCDYo9mKIGltcG9ydHMg2KrYtdmE2K0g2YTZgCBob2lzdGluZ1xuamVzdC5tb2NrKFwiLi9nZW5lcmF0aW9uXCIsICgpID0+ICh7XG4gIGdlbmVyYXRpb246IGplc3QuZm4oKCkgPT4gKHtcbiAgICBudW06IDEyMzQ1NixcbiAgICBleHBpcmVzQXQ6IG5ldyBEYXRlKFwiMjAyNS0xMS0wM1QyMjowODoyMy43ODlaXCIpLFxuICB9KSksXG59KSk7XG5cbi8vIG1vY2sgYmNyeXB0anMg2YLYqNmEINin2YTYp9iz2KrZitix2KfYr1xuamVzdC5tb2NrKFwiYmNyeXB0anNcIiwgKCkgPT4gKHtcbiAgX19lc01vZHVsZTogdHJ1ZSxcbiAgY29tcGFyZTogamVzdC5mbigpLFxuICBoYXNoOiBqZXN0LmZuKCksXG4gIGRlZmF1bHQ6IHtcbiAgICBjb21wYXJlOiBqZXN0LmZuKCksXG4gICAgaGFzaDogamVzdC5mbigpLFxuICB9LFxufSkpO1xuXG5pbXBvcnQgKiBhcyBiY3J5cHQgZnJvbSBcImJjcnlwdGpzXCI7XG5pbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSBcIkBuZXN0anMvdGVzdGluZ1wiO1xuaW1wb3J0IHsgZ2V0UmVwb3NpdG9yeVRva2VuIH0gZnJvbSBcIkBuZXN0anMvdHlwZW9ybVwiO1xuaW1wb3J0IHsgSnd0U2VydmljZSB9IGZyb20gXCJAbmVzdGpzL2p3dFwiO1xuaW1wb3J0IHsgQ29uZmlnU2VydmljZSB9IGZyb20gXCJAbmVzdGpzL2NvbmZpZ1wiO1xuXG5pbXBvcnQgeyBBdXRoU2VydmljZSB9IGZyb20gXCIuL2F1dGguc2VydmljZVwiO1xuaW1wb3J0IHsgVXNlciB9IGZyb20gXCIuLi9lbnRpdGllcy9Vc2VyLmVudGl0eVwiO1xuaW1wb3J0IHsgQ2FydCB9IGZyb20gXCIuLi9lbnRpdGllcy9DYXJ0LmVudGl0eVwiO1xuaW1wb3J0IHsgVmVyaWZpY2F0aW9uIH0gZnJvbSBcIi4uL2VudGl0aWVzL1ZlcmlmaWNhdGlvbi5lbnRpdHlcIjtcbmltcG9ydCB7IEZhaWxlZEF0dGVtcHQgfSBmcm9tIFwiLi4vZW50aXRpZXMvRmFpbGVkQXR0ZW1wdC5lbnRpdHlcIjtcbmltcG9ydCB7IFBhc3N3b3JkUmVzZXQgfSBmcm9tIFwiLi4vZW50aXRpZXMvUGFzc3dvcmRSZXNldC5lbnRpdHlcIjtcbmltcG9ydCB7IEVtYWlsU2VydmljZSB9IGZyb20gXCIuL01haWxlclwiO1xuaW1wb3J0IHsgUmVmcmVzaFRva2VuQmxhY2tsaXN0IH0gZnJvbSBcIi4uL2VudGl0aWVzL0JsYWNrTGlzdC5lbnRpdHlcIjtcbmltcG9ydCB7IEFwaVJlc3BvbnNlIH0gZnJvbSBcIi4uL2NvbW1vbi9kdG8vcmVzcG9uc2UuZHRvXCI7XG5pbXBvcnQgeyBSZXBvc2l0b3J5IH0gZnJvbSBcInR5cGVvcm1cIjtcblxuZGVzY3JpYmUoXCJBdXRoU2VydmljZVwiLCAoKSA9PiB7XG4gIGxldCBzZXJ2aWNlOiBBdXRoU2VydmljZTtcbiAgbGV0IGVtYWlsU2VydmljZTogRW1haWxTZXJ2aWNlO1xuXG4gIC8vIFJlcG9zINmD2YTZh9inINmF2LnYsdmB2Kkg2KjYp9mE2YAgbWV0aG9kcyDYp9mE2YTZiiDZitiz2KrYrtiv2YXZh9mFIHNlcnZpY2VcbiAgY29uc3QgbW9ja1VzZXJSZXBvc2l0b3J5OiBQYXJ0aWFsPFJlY29yZDxrZXlvZiBSZXBvc2l0b3J5PFVzZXI+LCBqZXN0Lk1vY2s+PiA9XG4gICAge1xuICAgICAgZmluZE9uZTogamVzdC5mbigpLFxuICAgICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgICBzYXZlOiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICAgIGRlbGV0ZTogamVzdC5mbigpLFxuICAgICAgZmluZDogamVzdC5mbigpLFxuICAgIH07XG5cbiAgY29uc3QgbW9ja0NhcnRSZXBvc2l0b3J5ID0ge1xuICAgIGZpbmRPbmU6IGplc3QuZm4oKSxcbiAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICBzYXZlOiBqZXN0LmZuKCksXG4gICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgZGVsZXRlOiBqZXN0LmZuKCksXG4gICAgZmluZDogamVzdC5mbigpLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tWZXJpZmljYXRpb25SZXBvc2l0b3J5ID0ge1xuICAgIGZpbmRPbmU6IGplc3QuZm4oKSxcbiAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICBzYXZlOiBqZXN0LmZuKCksXG4gICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgZGVsZXRlOiBqZXN0LmZuKCksXG4gICAgZmluZDogamVzdC5mbigpLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tGYWlsZWRBdHRlbXB0UmVwb3NpdG9yeSA9IHtcbiAgICBmaW5kT25lOiBqZXN0LmZuKCksXG4gICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgc2F2ZTogamVzdC5mbigpLFxuICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICAgIGRlbGV0ZTogamVzdC5mbigpLFxuICAgIGZpbmQ6IGplc3QuZm4oKSxcbiAgfTtcblxuICBjb25zdCBtb2NrUGFzc3dvcmRSZXNldFJlcG9zaXRvcnkgPSB7XG4gICAgZmluZE9uZTogamVzdC5mbigpLFxuICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgIHNhdmU6IGplc3QuZm4oKSxcbiAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICBkZWxldGU6IGplc3QuZm4oKSxcbiAgICBmaW5kOiBqZXN0LmZuKCksXG4gIH07XG5cbiAgY29uc3QgbW9ja0JsYWNrbGlzdFJlcG9zaXRvcnkgPSB7XG4gICAgZmluZE9uZTogamVzdC5mbigpLFxuICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgIHNhdmU6IGplc3QuZm4oKSxcbiAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICBkZWxldGU6IGplc3QuZm4oKSxcbiAgICBmaW5kOiBqZXN0LmZuKCksXG4gIH07XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgLy8g2YXYs9itINin2YTZgCBtb2Nrc1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuXG4gICAgLy8g2YLZitmFINin2YHYqtix2KfYttmK2Kkg2YTZhNmAIGJjcnlwdFxuICAgIChiY3J5cHQuaGFzaCBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKFwiaGFzaGVkLXBhc3N3b3JkXCIpO1xuICAgIChiY3J5cHQuY29tcGFyZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuXG4gICAgY29uc3QgbW9kdWxlOiBUZXN0aW5nTW9kdWxlID0gYXdhaXQgVGVzdC5jcmVhdGVUZXN0aW5nTW9kdWxlKHtcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICBBdXRoU2VydmljZSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IEp3dFNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIHNpZ246IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoXCJtb2NrLWp3dC10b2tlblwiKSxcbiAgICAgICAgICAgIHZlcmlmeTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IHN1YjogXCJ0ZXN0LXV1aWRcIiB9KSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogQ29uZmlnU2VydmljZSxcbiAgICAgICAgICB1c2VWYWx1ZToge1xuICAgICAgICAgICAgZ2V0OiBqZXN0LmZuKCksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgeyBwcm92aWRlOiBnZXRSZXBvc2l0b3J5VG9rZW4oVXNlciksIHVzZVZhbHVlOiBtb2NrVXNlclJlcG9zaXRvcnkgfSxcbiAgICAgICAgeyBwcm92aWRlOiBnZXRSZXBvc2l0b3J5VG9rZW4oQ2FydCksIHVzZVZhbHVlOiBtb2NrQ2FydFJlcG9zaXRvcnkgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IGdldFJlcG9zaXRvcnlUb2tlbihWZXJpZmljYXRpb24pLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrVmVyaWZpY2F0aW9uUmVwb3NpdG9yeSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IGdldFJlcG9zaXRvcnlUb2tlbihGYWlsZWRBdHRlbXB0KSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja0ZhaWxlZEF0dGVtcHRSZXBvc2l0b3J5LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogZ2V0UmVwb3NpdG9yeVRva2VuKFBhc3N3b3JkUmVzZXQpLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrUGFzc3dvcmRSZXNldFJlcG9zaXRvcnksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBnZXRSZXBvc2l0b3J5VG9rZW4oUmVmcmVzaFRva2VuQmxhY2tsaXN0KSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja0JsYWNrbGlzdFJlcG9zaXRvcnksXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBFbWFpbFNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIE1haWxlcjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKFwiRW1haWwgc2VudCFcIiksXG4gICAgICAgICAgICBzZW5kUGFzc3dvcmRSZXNldEVtYWlsOiBqZXN0XG4gICAgICAgICAgICAgIC5mbigpXG4gICAgICAgICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZShcIlBhc3N3b3JkIHJlc2V0IGVtYWlsIHNlbnQhXCIpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pLmNvbXBpbGUoKTtcblxuICAgIHNlcnZpY2UgPSBtb2R1bGUuZ2V0PEF1dGhTZXJ2aWNlPihBdXRoU2VydmljZSk7XG4gICAgZW1haWxTZXJ2aWNlID0gbW9kdWxlLmdldDxFbWFpbFNlcnZpY2U+KEVtYWlsU2VydmljZSk7XG4gIH0pO1xuXG4gIGl0KFwic2hvdWxkIGJlIGRlZmluZWRcIiwgKCkgPT4ge1xuICAgIGV4cGVjdChzZXJ2aWNlKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICBkZXNjcmliZShcInJlZ2lzdGVyX2hhbGZcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGVtYWlsID0gXCJuZXdAZXhhbXBsZS5jb21cIjtcbiAgICBjb25zdCBpcCA9IFwiMTI3LjAuMC4xXCI7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIC8vINil2LnYp9iv2Kkg2KrYudmK2YrZhiBiY3J5cHQg2YHZiiDYqNiv2KfZitipINmD2YQg2KfYrtiq2KjYp9ixXG4gICAgICAoYmNyeXB0Lmhhc2ggYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcImhhc2hlZC1wYXNzd29yZFwiKTtcbiAgICAgIChiY3J5cHQuY29tcGFyZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuICAgICAgbW9ja0ZhaWxlZEF0dGVtcHRSZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBzZW5kIHZlcmlmaWNhdGlvbiBlbWFpbCBpZiB1c2VyIGRvZXMgbm90IGV4aXN0XCIsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5maW5kT25lIS5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobnVsbCk7XG4gICAgICBtb2NrVmVyaWZpY2F0aW9uUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlT25jZShudWxsKTtcblxuICAgICAgY29uc3QgbWFpbGVyU3B5ID0gamVzdFxuICAgICAgICAuc3B5T24oZW1haWxTZXJ2aWNlLCBcIk1haWxlclwiKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUoXCJFbWFpbCBzZW50IVwiKTtcblxuICAgICAgYXdhaXQgc2VydmljZS5yZWdpc3Rlcl9oYWxmKGVtYWlsLCBpcCk7XG5cbiAgICAgIGV4cGVjdChtYWlsZXJTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBlbWFpbCxcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIGNvZGU6IGV4cGVjdC5hbnl0aGluZygpLFxuICAgICAgICAgIGV4cGlyZXNBdDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgfSksXG4gICAgICApO1xuXG4gICAgICBtYWlsZXJTcHkubW9ja1Jlc3RvcmUoKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHRocm93IHdoZW4gdXNlciBhbHJlYWR5IGV4aXN0c1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZE9uZSEubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHsgZW1haWwgfSk7XG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5yZWdpc3Rlcl9oYWxmKGVtYWlsLCBpcCkpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgXCLYp9mG2Kog2YTYr9mK2YMg2K3Ys9in2Kgg2KfZhtiq2YLZhCDYp9mE2Yog2LXZgdit2Ycg2KrYs9is2YrZhCDYp9mE2K/YrtmI2YQgKGxvZ2luIHBhZ2UpXCIsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgdXBkYXRlIGV4aXN0aW5nIHZlcmlmaWNhdGlvbiByZWNvcmRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LmZpbmRPbmUhLm1vY2tSZXNvbHZlZFZhbHVlT25jZShudWxsKTtcbiAgICAgIG1vY2tWZXJpZmljYXRpb25SZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHsgZW1haWwgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UucmVnaXN0ZXJfaGFsZihlbWFpbCwgaXApO1xuXG4gICAgICBleHBlY3QobW9ja1ZlcmlmaWNhdGlvblJlcG9zaXRvcnkudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgeyBlbWFpbCB9LFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgY29kZTogZXhwZWN0LmFueXRoaW5nKCksXG4gICAgICAgICAgZXhwaXJlc0F0OiBleHBlY3QuYW55KERhdGUpLFxuICAgICAgICB9KSxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVJbnN0YW5jZU9mKEFwaVJlc3BvbnNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubWVzc2FnZSkudG9CZShcIkVtYWlsIHNlbnQhXCIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5kYXRhKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwicmVnaXN0ZXJfZnVsbFwiLCAoKSA9PiB7XG4gICAgY29uc3QgZW1haWwgPSBcInVzZXJAZXhhbXBsZS5jb21cIjtcbiAgICBjb25zdCBjb2RlID0gXCIxMjM0NTZcIjtcbiAgICBjb25zdCBpcEFkZHJlc3MgPSBcIjEyNy4wLjAuMVwiO1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAoYmNyeXB0Lmhhc2ggYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcImhhc2hlZC1wYXNzd29yZFwiKTtcbiAgICAgIChiY3J5cHQuY29tcGFyZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gaWYgdmVyaWZpY2F0aW9uIHJlY29yZCBub3QgZm91bmRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1ZlcmlmaWNhdGlvblJlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobnVsbCk7XG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHNlcnZpY2UucmVnaXN0ZXJfZnVsbChlbWFpbCwgY29kZSwgaXBBZGRyZXNzKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KFwiRW1haWw6Y29kZSBub3QgZm91bmRcIik7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCB0aHJvdyBCYWRSZXF1ZXN0RXhjZXB0aW9uIGlmIGNvZGUgaXMgZXhwaXJlZFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrVmVyaWZpY2F0aW9uUmVwb3NpdG9yeS5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XG4gICAgICAgIGVtYWlsLFxuICAgICAgICBjb2RlLFxuICAgICAgICBleHBpcmVzQXQ6IG5ldyBEYXRlKERhdGUubm93KCkgLSAxMDAwMCksXG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLnJlZ2lzdGVyX2Z1bGwoZW1haWwsIGNvZGUsIGlwQWRkcmVzcyksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhcImNvZGUgaXMgZXhwaXJlZFwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHRocm93IEJhZFJlcXVlc3RFeGNlcHRpb24gaWYgY29kZSBpcyBpbnZhbGlkXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tWZXJpZmljYXRpb25SZXBvc2l0b3J5LmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIGNvZGU6IFwiMDAwMDAwXCIsXG4gICAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSArIDEwMDAwKSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZWNvcmRGYWlsZWRBdHRlbXB0U3B5ID0gamVzdC5zcHlPbihcbiAgICAgICAgc2VydmljZSBhcyBhbnksXG4gICAgICAgIFwicmVjb3JkRmFpbGVkQXR0ZW1wdFwiLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLnJlZ2lzdGVyX2Z1bGwoZW1haWwsIGNvZGUsIGlwQWRkcmVzcyksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhcImludmFsaWQgY29kZVwiKTtcblxuICAgICAgZXhwZWN0KHJlY29yZEZhaWxlZEF0dGVtcHRTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBlbWFpbCxcbiAgICAgICAgaXBBZGRyZXNzLFxuICAgICAgICBcInZlcmlmaWNhdGlvblwiLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGNyZWF0ZSB1c2VyIGFuZCBjYXJ0IGlmIGNvZGUgdmFsaWRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1ZlcmlmaWNhdGlvblJlcG9zaXRvcnkuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgY29kZSxcbiAgICAgICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMTAwMDApLFxuICAgICAgfSk7XG5cbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5jcmVhdGUhLm1vY2tSZXR1cm5WYWx1ZU9uY2Uoe1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgcHJvdmlkZXI6IFwibG9jYWxcIixcbiAgICAgICAgaXNWZXJpZmllZDogZmFsc2UsXG4gICAgICAgIGdvb2dsZUlkOiB1bmRlZmluZWQsXG4gICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgfSk7XG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuc2F2ZSEubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHsgaWQ6IDEsIGVtYWlsIH0pO1xuXG4gICAgICBtb2NrQ2FydFJlcG9zaXRvcnkuY3JlYXRlLm1vY2tSZXR1cm5WYWx1ZU9uY2UoeyBpZDogMTAgfSk7XG4gICAgICBtb2NrQ2FydFJlcG9zaXRvcnkuc2F2ZS5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoeyBpZDogMTAgfSk7XG5cbiAgICAgIGNvbnN0IGNsZWFyRmFpbGVkQXR0ZW1wdHNTcHkgPSBqZXN0LnNweU9uKFxuICAgICAgICBzZXJ2aWNlIGFzIGFueSxcbiAgICAgICAgXCJjbGVhckZhaWxlZEF0dGVtcHRzXCIsXG4gICAgICApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnJlZ2lzdGVyX2Z1bGwoZW1haWwsIGNvZGUsIGlwQWRkcmVzcyk7XG5cbiAgICAgIGV4cGVjdChjbGVhckZhaWxlZEF0dGVtcHRzU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZW1haWwsXG4gICAgICAgIGlwQWRkcmVzcyxcbiAgICAgICAgXCJ2ZXJpZmljYXRpb25cIixcbiAgICAgICk7XG4gICAgICBleHBlY3QobW9ja1ZlcmlmaWNhdGlvblJlcG9zaXRvcnkuZGVsZXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7IGVtYWlsIH0pO1xuICAgICAgZXhwZWN0KG1vY2tVc2VyUmVwb3NpdG9yeS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHByb3ZpZGVyOiBcImxvY2FsXCIsXG4gICAgICAgIGlzVmVyaWZpZWQ6IGZhbHNlLFxuICAgICAgICBnb29nbGVJZDogdW5kZWZpbmVkLFxuICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KG1vY2tDYXJ0UmVwb3NpdG9yeS5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgdXNlcjogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoeyBlbWFpbCB9KSxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlSW5zdGFuY2VPZihBcGlSZXNwb25zZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0Lm1lc3NhZ2UpLnRvQmUoXCJDb2RlIHZlcmlmaWVkIHN1Y2Nlc3NmdWxseVwiKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJyZWdpc3Rlcl9jb21wbGV0ZVwiLCAoKSA9PiB7XG4gICAgY29uc3QgZW1haWwgPSBcIm5ld0BleGFtcGxlLmNvbVwiO1xuICAgIGNvbnN0IHBhc3N3b3JkID0gXCJzZWN1cmVQYXNzd29yZDEyM1wiO1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAoYmNyeXB0Lmhhc2ggYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZShcImhhc2hlZC1wYXNzd29yZFwiKTtcbiAgICAgIChiY3J5cHQuY29tcGFyZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gaWYgdXNlciBub3QgZm91bmRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LmZpbmRPbmUhLm1vY2tSZXNvbHZlZFZhbHVlT25jZShudWxsKTtcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLnJlZ2lzdGVyX2NvbXBsZXRlKGVtYWlsLCBwYXNzd29yZCkpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgXCJ1c2VyIG5vdCBmb3VuZFwiLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGNvbXBsZXRlIHJlZ2lzdHJhdGlvbiBhbmQgcmV0dXJuIHRva2Vuc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VyID0geyBpZDogXCJ1dWlkLTEyM1wiLCBlbWFpbCwgcm9sZTogXCJ1c2VyXCIsIGlzVmVyaWZpZWQ6IGZhbHNlIH07XG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZE9uZSEubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHVzZXIpO1xuXG4gICAgICAoYmNyeXB0Lmhhc2ggYXMgamVzdC5Nb2NrKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKFwiaGFzaGVkLXBhc3N3b3JkXCIpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoXCJoYXNoZWQtcmVmcmVzaFwiKTtcblxuICAgICAgY29uc3Qgand0U2VydmljZSA9IHNlcnZpY2VbXCJqd3RTZXJ2aWNlXCJdO1xuICAgICAgY29uc3QgY29uZmlnU2VydmljZSA9IHNlcnZpY2VbXCJjb25maWdTZXJ2aWNlXCJdO1xuXG4gICAgICBqZXN0LnNweU9uKGp3dFNlcnZpY2UsIFwic2lnblwiKS5tb2NrUmV0dXJuVmFsdWUoXCJtb2NrLXRva2VuXCIpO1xuICAgICAgamVzdC5zcHlPbihjb25maWdTZXJ2aWNlLCBcImdldFwiKS5tb2NrUmV0dXJuVmFsdWUoXCIxaFwiKTtcblxuICAgICAgbW9ja1VzZXJSZXBvc2l0b3J5LnVwZGF0ZSEubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHsgYWZmZWN0ZWQ6IDEgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UucmVnaXN0ZXJfY29tcGxldGUoZW1haWwsIHBhc3N3b3JkKTtcblxuICAgICAgZXhwZWN0KG1vY2tVc2VyUmVwb3NpdG9yeS5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IGVtYWlsIH0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KG1vY2tVc2VyUmVwb3NpdG9yeS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICB7IGVtYWlsIH0sXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBwYXNzd29yZDogZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICAgIGlzVmVyaWZpZWQ6IHRydWUsXG4gICAgICAgICAgcmVmcmVzaF9Ub2tlbjogZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgYWNjZXNzX3Rva2VuOiBcIm1vY2stdG9rZW5cIixcbiAgICAgICAgcmVmcmVzaF9Ub2tlbjogXCJtb2NrLXRva2VuXCIsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG4gIGRlc2NyaWJlKFwibG9naW5cIiwgKCkgPT4ge1xuICAgIGNvbnN0IGVtYWlsID0gXCJ1c2VyQGV4YW1wbGUuY29tXCI7XG4gICAgY29uc3QgcGFzc3dvcmQgPSBcInBhc3N3b3JkMTIzXCI7XG4gICAgY29uc3QgaXBBZGRyZXNzID0gXCIxMjcuMC4wLjFcIjtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgICAoYmNyeXB0LmNvbXBhcmUgYXMgamVzdC5Nb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIGlmIHVzZXIgbm90IGZvdW5kXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5maW5kT25lIS5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobnVsbCk7XG5cbiAgICAgIGNvbnN0IHJlY29yZFNweSA9IGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksIFwicmVjb3JkRmFpbGVkQXR0ZW1wdFwiKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UubG9naW4oZW1haWwsIHBhc3N3b3JkLCBpcEFkZHJlc3MpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIFwiVXNlciBub3QgZm91bmRcIixcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZWNvcmRTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGVtYWlsLCBpcEFkZHJlc3MsIFwibG9naW5cIik7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCB0aHJvdyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBwYXNzd29yZCBub3Qgc2V0XCIsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5maW5kT25lIS5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgcGFzc3dvcmQ6IG51bGwsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVjb3JkU3B5ID0gamVzdC5zcHlPbihzZXJ2aWNlIGFzIGFueSwgXCJyZWNvcmRGYWlsZWRBdHRlbXB0XCIpO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5sb2dpbihlbWFpbCwgcGFzc3dvcmQsIGlwQWRkcmVzcykpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgXCJwYXNzd29yZCBub3Qgc2V0XCIsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVjb3JkU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChlbWFpbCwgaXBBZGRyZXNzLCBcImxvZ2luXCIpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gaWYgcGFzc3dvcmQgYXJndW1lbnQgbWlzc2luZ1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrVXNlclJlcG9zaXRvcnkuZmluZE9uZSEubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHBhc3N3b3JkOiBcImhhc2hlZFwiLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlY29yZFNweSA9IGplc3Quc3B5T24oc2VydmljZSBhcyBhbnksIFwicmVjb3JkRmFpbGVkQXR0ZW1wdFwiKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UubG9naW4oZW1haWwsIHVuZGVmaW5lZCwgaXBBZGRyZXNzKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBcIndyaXRlIHBhc3N3b3JkXCIsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVjb3JkU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChlbWFpbCwgaXBBZGRyZXNzLCBcImxvZ2luXCIpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgdGhyb3cgVW5hdXRob3JpemVkRXhjZXB0aW9uIGlmIHVzZXIgaXMgbm90IHZlcmlmaWVkXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5maW5kT25lIS5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgcGFzc3dvcmQ6IFwiaGFzaGVkXCIsXG4gICAgICAgIGlzVmVyaWZpZWQ6IGZhbHNlLFxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmxvZ2luKGVtYWlsLCBwYXNzd29yZCwgaXBBZGRyZXNzKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBcImJsb2NrZWRcIixcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCB0aHJvdyBCYWRSZXF1ZXN0RXhjZXB0aW9uIGlmIHBhc3N3b3JkIGlzIHdyb25nXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIChiY3J5cHQuY29tcGFyZSBhcyBqZXN0Lk1vY2spLm1vY2tSZXNvbHZlZFZhbHVlT25jZShmYWxzZSk7XG5cbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5maW5kT25lIS5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgcGFzc3dvcmQ6IFwiaGFzaGVkXCIsXG4gICAgICAgIGlzVmVyaWZpZWQ6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVjb3JkU3B5ID0gamVzdC5zcHlPbihzZXJ2aWNlIGFzIGFueSwgXCJyZWNvcmRGYWlsZWRBdHRlbXB0XCIpO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5sb2dpbihlbWFpbCwgcGFzc3dvcmQsIGlwQWRkcmVzcykpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgXCJwYXNzd29yZCBpcyB3cm9uZ1wiLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlY29yZFNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZW1haWwsIGlwQWRkcmVzcywgXCJsb2dpblwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGxvZ2luIHN1Y2Nlc3NmdWxseSBhbmQgcmV0dXJuIHRva2Vuc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VyID0ge1xuICAgICAgICBpZDogXCJ1dWlkLTFcIixcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHBhc3N3b3JkOiBcImhhc2hlZFwiLFxuICAgICAgICBpc1ZlcmlmaWVkOiB0cnVlLFxuICAgICAgfTtcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5maW5kT25lIS5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UodXNlcik7XG5cbiAgICAgIGNvbnN0IGNsZWFyU3B5ID0gamVzdC5zcHlPbihzZXJ2aWNlIGFzIGFueSwgXCJjbGVhckZhaWxlZEF0dGVtcHRzXCIpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmxvZ2luKGVtYWlsLCBwYXNzd29yZCwgaXBBZGRyZXNzKTtcblxuICAgICAgZXhwZWN0KGNsZWFyU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChlbWFpbCwgaXBBZGRyZXNzLCBcImxvZ2luXCIpO1xuICAgICAgZXhwZWN0KG1vY2tVc2VyUmVwb3NpdG9yeS51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICB7IGVtYWlsIH0sXG4gICAgICAgIHsgcmVmcmVzaF9Ub2tlbjogZXhwZWN0LmFueShTdHJpbmcpIH0sXG4gICAgICApO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIGFjY2Vzc190b2tlbjogXCJtb2NrLWp3dC10b2tlblwiLFxuICAgICAgICByZWZyZXNoX1Rva2VuOiBcIm1vY2stand0LXRva2VuXCIsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGxvZ2luIHN1Y2Nlc3NmdWxseSB3aXRob3V0IGVtYWlsL2lwIChubyByYXRlIGxpbWl0aW5nKVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1c2VyID0ge1xuICAgICAgICBpZDogXCJ1dWlkLTFcIixcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHBhc3N3b3JkOiBcImhhc2hlZFwiLFxuICAgICAgICBpc1ZlcmlmaWVkOiB0cnVlLFxuICAgICAgfTtcbiAgICAgIG1vY2tVc2VyUmVwb3NpdG9yeS5maW5kT25lIS5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UodXNlcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UubG9naW4oZW1haWwsIHBhc3N3b3JkKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIGFjY2Vzc190b2tlbjogXCJtb2NrLWp3dC10b2tlblwiLFxuICAgICAgICByZWZyZXNoX1Rva2VuOiBcIm1vY2stand0LXRva2VuXCIsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==