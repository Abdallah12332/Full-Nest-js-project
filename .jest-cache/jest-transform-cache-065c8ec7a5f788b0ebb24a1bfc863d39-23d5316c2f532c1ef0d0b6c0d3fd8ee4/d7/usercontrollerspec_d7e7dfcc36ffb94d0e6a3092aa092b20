d6c09659ec81c61dcc6809db519486ca
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/* eslint-disable @typescript-eslint/unbound-method */
const testing_1 = require("@nestjs/testing");
const user_controller_1 = require("./user.controller");
const user_service_1 = require("./user.service");
const throttler_1 = require("@nestjs/throttler");
const auth_guard_1 = require("../auth/guards/auth.guard");
describe("UserController", () => {
    let controller;
    let service;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            controllers: [user_controller_1.UserController],
            providers: [
                {
                    provide: user_service_1.UserService,
                    useValue: {
                        Add_Review: jest.fn(),
                        Edit_Review: jest.fn(),
                        Remove_Review: jest.fn(),
                        Add_Cart_Item: jest.fn(),
                        Remove_Cart_Item: jest.fn(),
                        increase_Quantity: jest.fn(),
                        decrease_Quantity: jest.fn(),
                        SearchProducts: jest.fn(),
                        FindProductsByCategory: jest.fn(),
                    },
                },
            ],
        })
            .overrideGuard(throttler_1.ThrottlerGuard)
            .useValue({ canActivate: () => true })
            .overrideGuard(auth_guard_1.JwtAuthGuard)
            .useValue({ canActivate: () => true })
            .compile();
        controller = module.get(user_controller_1.UserController);
        service = module.get(user_service_1.UserService);
    });
    it("should be defined", () => {
        expect(controller).toBeDefined();
    });
    it("should call Add_Review", async () => {
        jest.spyOn(service, "Add_Review").mockResolvedValue("ok");
        const result = await controller.Add_Review({
            email: "a@b.com",
            comment: "good",
            productId: "1",
            rating: 5,
        });
        expect(service.Add_Review).toHaveBeenCalledWith("a@b.com", "good", "1", 5);
        expect(result).toEqual(expect.objectContaining({
            success: true,
            message: "Review added successfully",
        }));
    });
    it("should call Edit_Review", async () => {
        jest.spyOn(service, "Edit_Review").mockResolvedValue("ok");
        const result = await controller.Edit_Review({
            email: "a@b.com",
            reviewId: "123",
            comment: "updated",
            rating: 4,
        });
        expect(service.Edit_Review).toHaveBeenCalled();
        expect(result).toEqual(expect.objectContaining({
            success: true,
            message: "Review updated successfully",
        }));
    });
    it("should call Remove_Review", async () => {
        jest.spyOn(service, "Remove_Review").mockResolvedValue("ok");
        const result = await controller.Remove_Review({
            email: "a@b.com",
            reviewId: "123",
        });
        expect(service.Remove_Review).toHaveBeenCalledWith("a@b.com", "123");
        expect(result).toEqual(expect.objectContaining({
            success: true,
            message: "Review removed successfully",
        }));
    });
    it("should call Add_Cart_Item", async () => {
        jest.spyOn(service, "Add_Cart_Item").mockResolvedValue("ok");
        const result = await controller.Add_Cart_Item({
            cartId: "c1",
            productId: "p1",
        });
        expect(service.Add_Cart_Item).toHaveBeenCalledWith("c1", "p1");
        expect(result).toEqual(expect.objectContaining({
            success: true,
            message: "Item added to cart successfully",
        }));
    });
    it("should call Remove_Cart_Item", async () => {
        jest.spyOn(service, "Remove_Cart_Item").mockResolvedValue("ok");
        const result = await controller.Remove_Cart_Item({
            cartId: "c1",
            productId: "p1",
        });
        expect(service.Remove_Cart_Item).toHaveBeenCalledWith("c1", "p1");
        expect(result).toEqual(expect.objectContaining({
            success: true,
            message: "Item removed from cart successfully",
        }));
    });
    it("should call increase_Quantity", async () => {
        jest.spyOn(service, "increase_Quantity").mockResolvedValue("ok");
        const result = await controller.increase_Quantity({ cartItemId: "ci1" });
        expect(service.increase_Quantity).toHaveBeenCalledWith("ci1");
        expect(result).toEqual(expect.objectContaining({
            success: true,
            message: "Quantity increased successfully",
        }));
    });
    it("should call decrease_Quantity", async () => {
        jest.spyOn(service, "decrease_Quantity").mockResolvedValue("ok");
        const result = await controller.decrease_Quantity({ cartItemId: "ci1" });
        expect(service.decrease_Quantity).toHaveBeenCalledWith("ci1");
        expect(result).toEqual(expect.objectContaining({
            success: true,
            message: "Quantity decreased successfully",
        }));
    });
    it("should call SearchProducts", async () => {
        const mockResult = {
            products: [],
            currentPage: 1,
            totalPages: 1,
        };
        jest.spyOn(service, "SearchProducts").mockResolvedValue(mockResult);
        const result = await controller.SearchProducts({
            searchTerm: "test",
            page: 1,
        });
        expect(service.SearchProducts).toHaveBeenCalledWith("test", 1);
        expect(result).toEqual(expect.objectContaining({
            success: true,
            message: "Products retrieved successfully",
            data: mockResult.products,
            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
            pagination: expect.objectContaining({
                currentPage: mockResult.currentPage,
                totalPages: mockResult.totalPages,
            }),
        }));
    });
    it("should call FindProductsByCategory", async () => {
        const mockResult = {
            products: [],
            currentPage: 1,
            totalPages: 1,
        };
        jest.spyOn(service, "FindProductsByCategory").mockResolvedValue(mockResult);
        const result = await controller.FindProductsByCategory({
            categoryId: "cat1",
            page: 2,
        });
        expect(service.FindProductsByCategory).toHaveBeenCalledWith("cat1", 2);
        expect(result).toEqual(expect.objectContaining({
            success: true,
            message: "Products retrieved successfully",
            data: mockResult.products,
            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
            pagination: expect.objectContaining({
                currentPage: mockResult.currentPage,
                totalPages: mockResult.totalPages,
            }),
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvb21hci9EZXNrdG9wL1Byb3RvZm9saW9fd2l0aG91dF9yZWRpcy9zcmMvdXNlci91c2VyLmNvbnRyb2xsZXIuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLHNEQUFzRDtBQUN0RCw2Q0FBc0Q7QUFDdEQsdURBQW1EO0FBQ25ELGlEQUE2QztBQUM3QyxpREFBbUQ7QUFDbkQsMERBQXlEO0FBRXpELFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUU7SUFDOUIsSUFBSSxVQUEwQixDQUFDO0lBQy9CLElBQUksT0FBb0IsQ0FBQztJQUV6QixVQUFVLENBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsTUFBTSxNQUFNLEdBQWtCLE1BQU0sY0FBSSxDQUFDLG1CQUFtQixDQUFDO1lBQzNELFdBQVcsRUFBRSxDQUFDLGdDQUFjLENBQUM7WUFDN0IsU0FBUyxFQUFFO2dCQUNUO29CQUNFLE9BQU8sRUFBRSwwQkFBVztvQkFDcEIsUUFBUSxFQUFFO3dCQUNSLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3dCQUNyQixXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTt3QkFDdEIsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7d0JBQ3hCLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3dCQUN4QixnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3dCQUMzQixpQkFBaUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3dCQUM1QixpQkFBaUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3dCQUM1QixjQUFjLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTt3QkFDekIsc0JBQXNCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtxQkFDbEM7aUJBQ0Y7YUFDRjtTQUNGLENBQUM7YUFDQyxhQUFhLENBQUMsMEJBQWMsQ0FBQzthQUM3QixRQUFRLENBQUMsRUFBRSxXQUFXLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUM7YUFDckMsYUFBYSxD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U0FDUixDQUFDLENBQUM7UUFDSCxNQUFNLENBQUMsT0FBTyxDQUFDLHNCQUFzQixDQUFDLENBQUMsb0JBQW9CLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3ZFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQ3BCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztZQUN0QixPQUFPLEVBQUUsSUFBSTtZQUNiLE9BQU8sRUFBRSxpQ0FBaUM7WUFDMUMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxRQUFRO1lBQ3pCLG1FQUFtRTtZQUNuRSxVQUFVLEVBQUUsTUFBTSxDQUFDLGdCQUFnQixDQUFDO2dCQUNsQyxXQUFXLEVBQUUsVUFBVSxDQUFDLFdBQVc7Z0JBQ25DLFVBQVUsRUFBRSxVQUFVLENBQUMsVUFBVTthQUNsQyxDQUFDO1NBQ0gsQ0FBQyxDQUNILENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL29tYXIvRGVza3RvcC9Qcm90b2ZvbGlvX3dpdGhvdXRfcmVkaXMvc3JjL3VzZXIvdXNlci5jb250cm9sbGVyLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L3VuYm91bmQtbWV0aG9kICovXG5pbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSBcIkBuZXN0anMvdGVzdGluZ1wiO1xuaW1wb3J0IHsgVXNlckNvbnRyb2xsZXIgfSBmcm9tIFwiLi91c2VyLmNvbnRyb2xsZXJcIjtcbmltcG9ydCB7IFVzZXJTZXJ2aWNlIH0gZnJvbSBcIi4vdXNlci5zZXJ2aWNlXCI7XG5pbXBvcnQgeyBUaHJvdHRsZXJHdWFyZCB9IGZyb20gXCJAbmVzdGpzL3Rocm90dGxlclwiO1xuaW1wb3J0IHsgSnd0QXV0aEd1YXJkIH0gZnJvbSBcIi4uL2F1dGgvZ3VhcmRzL2F1dGguZ3VhcmRcIjtcblxuZGVzY3JpYmUoXCJVc2VyQ29udHJvbGxlclwiLCAoKSA9PiB7XG4gIGxldCBjb250cm9sbGVyOiBVc2VyQ29udHJvbGxlcjtcbiAgbGV0IHNlcnZpY2U6IFVzZXJTZXJ2aWNlO1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBjb250cm9sbGVyczogW1VzZXJDb250cm9sbGVyXSxcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogVXNlclNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIEFkZF9SZXZpZXc6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIEVkaXRfUmV2aWV3OiBqZXN0LmZuKCksXG4gICAgICAgICAgICBSZW1vdmVfUmV2aWV3OiBqZXN0LmZuKCksXG4gICAgICAgICAgICBBZGRfQ2FydF9JdGVtOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBSZW1vdmVfQ2FydF9JdGVtOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBpbmNyZWFzZV9RdWFudGl0eTogamVzdC5mbigpLFxuICAgICAgICAgICAgZGVjcmVhc2VfUXVhbnRpdHk6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIFNlYXJjaFByb2R1Y3RzOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBGaW5kUHJvZHVjdHNCeUNhdGVnb3J5OiBqZXN0LmZuKCksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSlcbiAgICAgIC5vdmVycmlkZUd1YXJkKFRocm90dGxlckd1YXJkKVxuICAgICAgLnVzZVZhbHVlKHsgY2FuQWN0aXZhdGU6ICgpID0+IHRydWUgfSlcbiAgICAgIC5vdmVycmlkZUd1YXJkKEp3dEF1dGhHdWFyZClcbiAgICAgIC51c2VWYWx1ZSh7IGNhbkFjdGl2YXRlOiAoKSA9PiB0cnVlIH0pXG4gICAgICAuY29tcGlsZSgpO1xuXG4gICAgY29udHJvbGxlciA9IG1vZHVsZS5nZXQ8VXNlckNvbnRyb2xsZXI+KFVzZXJDb250cm9sbGVyKTtcbiAgICBzZXJ2aWNlID0gbW9kdWxlLmdldDxVc2VyU2VydmljZT4oVXNlclNlcnZpY2UpO1xuICB9KTtcblxuICBpdChcInNob3VsZCBiZSBkZWZpbmVkXCIsICgpID0+IHtcbiAgICBleHBlY3QoY29udHJvbGxlcikudG9CZURlZmluZWQoKTtcbiAgfSk7XG5cbiAgaXQoXCJzaG91bGQgY2FsbCBBZGRfUmV2aWV3XCIsIGFzeW5jICgpID0+IHtcbiAgICBqZXN0LnNweU9uKHNlcnZpY2UsIFwiQWRkX1Jldmlld1wiKS5tb2NrUmVzb2x2ZWRWYWx1ZShcIm9rXCIpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuQWRkX1Jldmlldyh7XG4gICAgICBlbWFpbDogXCJhQGIuY29tXCIsXG4gICAgICBjb21tZW50OiBcImdvb2RcIixcbiAgICAgIHByb2R1Y3RJZDogXCIxXCIsXG4gICAgICByYXRpbmc6IDUsXG4gICAgfSk7XG4gICAgZXhwZWN0KHNlcnZpY2UuQWRkX1JldmlldykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXCJhQGIuY29tXCIsIFwiZ29vZFwiLCBcIjFcIiwgNSk7XG4gICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChcbiAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogXCJSZXZpZXcgYWRkZWQgc3VjY2Vzc2Z1bGx5XCIsXG4gICAgICB9KSxcbiAgICApO1xuICB9KTtcblxuICBpdChcInNob3VsZCBjYWxsIEVkaXRfUmV2aWV3XCIsIGFzeW5jICgpID0+IHtcbiAgICBqZXN0LnNweU9uKHNlcnZpY2UsIFwiRWRpdF9SZXZpZXdcIikubW9ja1Jlc29sdmVkVmFsdWUoXCJva1wiKTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLkVkaXRfUmV2aWV3KHtcbiAgICAgIGVtYWlsOiBcImFAYi5jb21cIixcbiAgICAgIHJldmlld0lkOiBcIjEyM1wiLFxuICAgICAgY29tbWVudDogXCJ1cGRhdGVkXCIsXG4gICAgICByYXRpbmc6IDQsXG4gICAgfSk7XG4gICAgZXhwZWN0KHNlcnZpY2UuRWRpdF9SZXZpZXcpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKFxuICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiBcIlJldmlldyB1cGRhdGVkIHN1Y2Nlc3NmdWxseVwiLFxuICAgICAgfSksXG4gICAgKTtcbiAgfSk7XG5cbiAgaXQoXCJzaG91bGQgY2FsbCBSZW1vdmVfUmV2aWV3XCIsIGFzeW5jICgpID0+IHtcbiAgICBqZXN0LnNweU9uKHNlcnZpY2UsIFwiUmVtb3ZlX1Jldmlld1wiKS5tb2NrUmVzb2x2ZWRWYWx1ZShcIm9rXCIpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuUmVtb3ZlX1Jldmlldyh7XG4gICAgICBlbWFpbDogXCJhQGIuY29tXCIsXG4gICAgICByZXZpZXdJZDogXCIxMjNcIixcbiAgICB9KTtcbiAgICBleHBlY3Qoc2VydmljZS5SZW1vdmVfUmV2aWV3KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcImFAYi5jb21cIiwgXCIxMjNcIik7XG4gICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChcbiAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogXCJSZXZpZXcgcmVtb3ZlZCBzdWNjZXNzZnVsbHlcIixcbiAgICAgIH0pLFxuICAgICk7XG4gIH0pO1xuXG4gIGl0KFwic2hvdWxkIGNhbGwgQWRkX0NhcnRfSXRlbVwiLCBhc3luYyAoKSA9PiB7XG4gICAgamVzdC5zcHlPbihzZXJ2aWNlLCBcIkFkZF9DYXJ0X0l0ZW1cIikubW9ja1Jlc29sdmVkVmFsdWUoXCJva1wiKTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLkFkZF9DYXJ0X0l0ZW0oe1xuICAgICAgY2FydElkOiBcImMxXCIsXG4gICAgICBwcm9kdWN0SWQ6IFwicDFcIixcbiAgICB9KTtcbiAgICBleHBlY3Qoc2VydmljZS5BZGRfQ2FydF9JdGVtKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcImMxXCIsIFwicDFcIik7XG4gICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChcbiAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogXCJJdGVtIGFkZGVkIHRvIGNhcnQgc3VjY2Vzc2Z1bGx5XCIsXG4gICAgICB9KSxcbiAgICApO1xuICB9KTtcblxuICBpdChcInNob3VsZCBjYWxsIFJlbW92ZV9DYXJ0X0l0ZW1cIiwgYXN5bmMgKCkgPT4ge1xuICAgIGplc3Quc3B5T24oc2VydmljZSwgXCJSZW1vdmVfQ2FydF9JdGVtXCIpLm1vY2tSZXNvbHZlZFZhbHVlKFwib2tcIik7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5SZW1vdmVfQ2FydF9JdGVtKHtcbiAgICAgIGNhcnRJZDogXCJjMVwiLFxuICAgICAgcHJvZHVjdElkOiBcInAxXCIsXG4gICAgfSk7XG4gICAgZXhwZWN0KHNlcnZpY2UuUmVtb3ZlX0NhcnRfSXRlbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXCJjMVwiLCBcInAxXCIpO1xuICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoXG4gICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6IFwiSXRlbSByZW1vdmVkIGZyb20gY2FydCBzdWNjZXNzZnVsbHlcIixcbiAgICAgIH0pLFxuICAgICk7XG4gIH0pO1xuXG4gIGl0KFwic2hvdWxkIGNhbGwgaW5jcmVhc2VfUXVhbnRpdHlcIiwgYXN5bmMgKCkgPT4ge1xuICAgIGplc3Quc3B5T24oc2VydmljZSwgXCJpbmNyZWFzZV9RdWFudGl0eVwiKS5tb2NrUmVzb2x2ZWRWYWx1ZShcIm9rXCIpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuaW5jcmVhc2VfUXVhbnRpdHkoeyBjYXJ0SXRlbUlkOiBcImNpMVwiIH0pO1xuICAgIGV4cGVjdChzZXJ2aWNlLmluY3JlYXNlX1F1YW50aXR5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcImNpMVwiKTtcbiAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKFxuICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiBcIlF1YW50aXR5IGluY3JlYXNlZCBzdWNjZXNzZnVsbHlcIixcbiAgICAgIH0pLFxuICAgICk7XG4gIH0pO1xuXG4gIGl0KFwic2hvdWxkIGNhbGwgZGVjcmVhc2VfUXVhbnRpdHlcIiwgYXN5bmMgKCkgPT4ge1xuICAgIGplc3Quc3B5T24oc2VydmljZSwgXCJkZWNyZWFzZV9RdWFudGl0eVwiKS5tb2NrUmVzb2x2ZWRWYWx1ZShcIm9rXCIpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuZGVjcmVhc2VfUXVhbnRpdHkoeyBjYXJ0SXRlbUlkOiBcImNpMVwiIH0pO1xuICAgIGV4cGVjdChzZXJ2aWNlLmRlY3JlYXNlX1F1YW50aXR5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcImNpMVwiKTtcbiAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKFxuICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiBcIlF1YW50aXR5IGRlY3JlYXNlZCBzdWNjZXNzZnVsbHlcIixcbiAgICAgIH0pLFxuICAgICk7XG4gIH0pO1xuXG4gIGl0KFwic2hvdWxkIGNhbGwgU2VhcmNoUHJvZHVjdHNcIiwgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vY2tSZXN1bHQgPSB7XG4gICAgICBwcm9kdWN0czogW10sXG4gICAgICBjdXJyZW50UGFnZTogMSxcbiAgICAgIHRvdGFsUGFnZXM6IDEsXG4gICAgfTtcbiAgICBqZXN0LnNweU9uKHNlcnZpY2UsIFwiU2VhcmNoUHJvZHVjdHNcIikubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Jlc3VsdCk7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5TZWFyY2hQcm9kdWN0cyh7XG4gICAgICBzZWFyY2hUZXJtOiBcInRlc3RcIixcbiAgICAgIHBhZ2U6IDEsXG4gICAgfSk7XG4gICAgZXhwZWN0KHNlcnZpY2UuU2VhcmNoUHJvZHVjdHMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFwidGVzdFwiLCAxKTtcbiAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKFxuICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiBcIlByb2R1Y3RzIHJldHJpZXZlZCBzdWNjZXNzZnVsbHlcIixcbiAgICAgICAgZGF0YTogbW9ja1Jlc3VsdC5wcm9kdWN0cyxcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtYXNzaWdubWVudFxuICAgICAgICBwYWdpbmF0aW9uOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgY3VycmVudFBhZ2U6IG1vY2tSZXN1bHQuY3VycmVudFBhZ2UsXG4gICAgICAgICAgdG90YWxQYWdlczogbW9ja1Jlc3VsdC50b3RhbFBhZ2VzLFxuICAgICAgICB9KSxcbiAgICAgIH0pLFxuICAgICk7XG4gIH0pO1xuXG4gIGl0KFwic2hvdWxkIGNhbGwgRmluZFByb2R1Y3RzQnlDYXRlZ29yeVwiLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9ja1Jlc3VsdCA9IHtcbiAgICAgIHByb2R1Y3RzOiBbXSxcbiAgICAgIGN1cnJlbnRQYWdlOiAxLFxuICAgICAgdG90YWxQYWdlczogMSxcbiAgICB9O1xuICAgIGplc3Quc3B5T24oc2VydmljZSwgXCJGaW5kUHJvZHVjdHNCeUNhdGVnb3J5XCIpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXN1bHQpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuRmluZFByb2R1Y3RzQnlDYXRlZ29yeSh7XG4gICAgICBjYXRlZ29yeUlkOiBcImNhdDFcIixcbiAgICAgIHBhZ2U6IDIsXG4gICAgfSk7XG4gICAgZXhwZWN0KHNlcnZpY2UuRmluZFByb2R1Y3RzQnlDYXRlZ29yeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXCJjYXQxXCIsIDIpO1xuICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoXG4gICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6IFwiUHJvZHVjdHMgcmV0cmlldmVkIHN1Y2Nlc3NmdWxseVwiLFxuICAgICAgICBkYXRhOiBtb2NrUmVzdWx0LnByb2R1Y3RzLFxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1hc3NpZ25tZW50XG4gICAgICAgIHBhZ2luYXRpb246IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBjdXJyZW50UGFnZTogbW9ja1Jlc3VsdC5jdXJyZW50UGFnZSxcbiAgICAgICAgICB0b3RhbFBhZ2VzOiBtb2NrUmVzdWx0LnRvdGFsUGFnZXMsXG4gICAgICAgIH0pLFxuICAgICAgfSksXG4gICAgKTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==