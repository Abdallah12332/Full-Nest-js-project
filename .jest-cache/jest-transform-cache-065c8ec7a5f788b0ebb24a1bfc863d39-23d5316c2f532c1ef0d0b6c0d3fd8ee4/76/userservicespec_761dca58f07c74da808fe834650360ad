5551bc3714631b1221d25fc9bf0d0bfd
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const user_service_1 = require("./user.service");
const typeorm_1 = require("@nestjs/typeorm");
const User_entity_1 = require("../entities/User.entity");
const common_1 = require("@nestjs/common");
describe("UserService", () => {
    let service;
    let userRepo;
    let productRepo;
    let reviewRepo;
    let cartRepo;
    let cartItemRepo;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                user_service_1.UserService,
                { provide: (0, typeorm_1.getRepositoryToken)(User_entity_1.User), useValue: {} },
                {
                    provide: "UserRepository",
                    useValue: { findOne: jest.fn() },
                },
                {
                    provide: "ProductRepository",
                    useValue: { findOne: jest.fn(), findOneBy: jest.fn() },
                },
                {
                    provide: "ReviewRepository",
                    useValue: {
                        findOne: jest.fn(),
                        create: jest.fn(),
                        save: jest.fn(),
                        update: jest.fn(),
                        delete: jest.fn(),
                    },
                },
                {
                    provide: "CartRepository",
                    useValue: {
                        findOne: jest.fn(),
                        findOneBy: jest.fn(),
                    },
                },
                {
                    provide: "CartItemRepository",
                    useValue: {
                        findOne: jest.fn(),
                        create: jest.fn(),
                        save: jest.fn(),
                        findOneBy: jest.fn(),
                        remove: jest.fn(),
                    },
                },
            ],
        }).compile();
        service = module.get(user_service_1.UserService);
        userRepo = module.get("UserRepository");
        productRepo = module.get("ProductRepository");
        reviewRepo = module.get("ReviewRepository");
        cartRepo = module.get("CartRepository");
        cartItemRepo = module.get("CartItemRepository");
    });
    describe("Check if service defined", () => {
        it("should be defined", () => {
            expect(service).toBeDefined();
        });
    });
    describe("Add_Review", () => {
        it("should throw if user not found", async () => {
            userRepo.findOne.mockResolvedValue(null);
            await expect(service.Add_Review("x@test.com", "good", "1", 5)).rejects.toThrow(common_1.NotFoundException);
        });
        it("should throw if product not found", async () => {
            userRepo.findOne.mockResolvedValue({ isVerified: true });
            productRepo.findOne.mockResolvedValue(null);
            await expect(service.Add_Review("x@test.com", "good", "1", 5)).rejects.toThrow(common_1.NotFoundException);
        });
        it("should return ok if review saved successfully", async () => {
            const mockUser = { email: "x@test.com", isVerified: true };
            const mockProduct = { id: "1" };
            userRepo.findOne.mockResolvedValue(mockUser);
            productRepo.findOne.mockResolvedValue(mockProduct);
            reviewRepo.create.mockReturnValue({});
            reviewRepo.save.mockResolvedValue({});
            const result = await service.Add_Review("x@test.com", "good", "1", 5);
            expect(result).toBe("ok");
        });
    });
    describe("Edit_Review", () => {
        it("should throw notfoundexception", async () => {
            reviewRepo.findOne.mockResolvedValue(null);
            await expect(service.Edit_Review("x@test.com", "343", "good", 5)).rejects.toThrow(common_1.NotFoundException);
        });
        it("should throw NotFoundException if user not authorized", async () => {
            const mockReview = { user: { email: "other@test.com" } }; // مستخدم مختلف
            reviewRepo.findOne.mockResolvedValue(mockReview);
            await expect(service.Edit_Review("x@test.com", "343", "good", 5)).rejects.toThrow(common_1.NotFoundException);
        });
        it("should pass if user owns review", async () => {
            const mockReview = { user: { email: "x@test.com" } };
            reviewRepo.findOne.mockResolvedValue(mockReview);
            reviewRepo.update.mockResolvedValue({});
            const result = await service.Edit_Review("x@test.com", "343", "good", 5);
            expect(result).toBeDefined();
        });
    });
    describe("Remove_Review", () => {
        it("must retutn NotFoundException", async () => {
            reviewRepo.findOne.mockResolvedValue(null);
            await expect(service.Remove_Review("x@test.com", "343")).rejects.toThrow(common_1.NotFoundException);
        });
        it("should throw NotFoundException when user email does not match", async () => {
            reviewRepo.findOne.mockResolvedValue({
                id: "343",
                user: { email: "other@test.com" },
            });
            await expect(service.Remove_Review("x@test.com", "343")).rejects.toThrow(common_1.NotFoundException);
        });
        it("should delete review and return ok when authorized", async () => {
            reviewRepo.findOne.mockResolvedValue({
                id: "343",
                user: { email: "x@test.com" },
            });
            reviewRepo.delete.mockResolvedValue({});
            const result = await service.Remove_Review("x@test.com", "343");
            expect(reviewRepo.delete).toHaveBeenCalledWith({ id: "343" });
            expect(result).toBe("ok");
        });
    });
    describe("Add_Cart_Item", () => {
        it("should throw NotFoundException if cart not found", async () => {
            cartRepo.findOneBy.mockResolvedValue(null);
            await expect(service.Add_Cart_Item("343", "444")).rejects.toThrow(common_1.NotFoundException);
        });
        it("should throw NotFoundException if product not found", async () => {
            // mock cart exists
            cartRepo.findOneBy.mockResolvedValue({ id: "343" });
            // mock product missing
            productRepo.findOneBy.mockResolvedValue(null);
            await expect(service.Add_Cart_Item("343", "444")).rejects.toThrow(common_1.NotFoundException);
        });
        it("should throw BadRequestException if item already in cart", async () => {
            cartRepo.findOneBy.mockResolvedValue({ id: "343" });
            productRepo.findOneBy.mockResolvedValue({ id: "444" });
            cartItemRepo.findOne.mockResolvedValue({ id: "1" }); // item already exists
            await expect(service.Add_Cart_Item("343", "444")).rejects.toThrow(common_1.BadRequestException);
        });
        it("should create and save new cart item when all valid", async () => {
            const mockCart = { id: "343" };
            const mockProduct = { id: "444" };
            const mockCartItem = { id: "999" };
            cartRepo.findOneBy.mockResolvedValue(mockCart);
            productRepo.findOneBy.mockResolvedValue(mockProduct);
            cartItemRepo.findOne.mockResolvedValue(null);
            cartItemRepo.create.mockReturnValue(mockCartItem);
            cartItemRepo.save.mockResolvedValue(mockCartItem);
            const result = await service.Add_Cart_Item("343", "444");
            expect(cartItemRepo.create).toHaveBeenCalledWith({
                quantity: 1,
                cart: mockCart,
                product: mockProduct,
            });
            expect(cartItemRepo.save).toHaveBeenCalledWith(mockCartItem);
            expect(result).toBe("ok");
        });
    });
    describe("Remove_Cart_Item", () => {
        it("should throw NotFoundException if cart not found", async () => {
            cartRepo.findOneBy.mockResolvedValue(null);
            await expect(service.Remove_Cart_Item("1", "2")).rejects.toThrow(common_1.NotFoundException);
        });
        it("should throw NotFoundException if product not found", async () => {
            cartRepo.findOneBy.mockResolvedValue({ id: "1" });
            productRepo.findOneBy.mockResolvedValue(null);
            await expect(service.Remove_Cart_Item("1", "2")).rejects.toThrow(common_1.NotFoundException);
        });
        it("should throw NotFoundException if cart item not found", async () => {
            cartRepo.findOneBy.mockResolvedValue({ id: "1" });
            productRepo.findOneBy.mockResolvedValue({ id: "2" });
            cartItemRepo.findOne.mockResolvedValue(null);
            await expect(service.Remove_Cart_Item("1", "2")).rejects.toThrow(common_1.NotFoundException);
        });
        it("should remove cart item and return ok", async () => {
            const mockItem = { id: "3" };
            cartRepo.findOneBy.mockResolvedValue({ id: "1" });
            productRepo.findOneBy.mockResolvedValue({ id: "2" });
            cartItemRepo.findOne.mockResolvedValue(mockItem);
            cartItemRepo.remove.mockResolvedValue({});
            const result = await service.Remove_Cart_Item("1", "2");
            expect(cartItemRepo.remove).toHaveBeenCalledWith(mockItem);
            expect(result).toBe("ok");
        });
    });
    describe("increase_Quantity", () => {
        it("should throw NotFoundException if cart item not found", async () => {
            cartItemRepo.findOneBy.mockResolvedValue(null);
            await expect(service.increase_Quantity("1")).rejects.toThrow(common_1.NotFoundException);
        });
        it("should return 'no' if quantity >= 999", async () => {
            cartItemRepo.findOneBy.mockResolvedValue({ id: "1", quantity: 999 });
            const result = await service.increase_Quantity("1");
            expect(result).toBe("no");
        });
        it("should increment quantity and save if valid", async () => {
            const mockItem = { id: "1", quantity: 5 };
            cartItemRepo.findOneBy.mockResolvedValue(mockItem);
            cartItemRepo.save.mockResolvedValue({});
            const result = await service.increase_Quantity("1");
            expect(mockItem.quantity).toBe(6);
            expect(cartItemRepo.save).toHaveBeenCalledWith(mockItem);
            expect(result).toBe("ok");
        });
    });
    describe("decrease_Quantity", () => {
        it("should throw NotFoundException if cart item not found", async () => {
            cartItemRepo.findOneBy.mockResolvedValue(null);
            await expect(service.decrease_Quantity("1")).rejects.toThrow(common_1.NotFoundException);
        });
        it("should return 'no' if quantity <= 1", async () => {
            cartItemRepo.findOneBy.mockResolvedValue({ id: "1", quantity: 1 });
            const result = await service.decrease_Quantity("1");
            expect(result).toBe("no");
        });
        it("should decrement quantity and save if valid", async () => {
            const mockItem = { id: "1", quantity: 5 };
            cartItemRepo.findOneBy.mockResolvedValue(mockItem);
            cartItemRepo.save.mockResolvedValue({});
            const result = await service.decrease_Quantity("1");
            expect(mockItem.quantity).toBe(4);
            expect(cartItemRepo.save).toHaveBeenCalledWith(mockItem);
            expect(result).toBe("ok");
        });
    });
    describe("SearchProducts", () => {
        it("should return paginated products", async () => {
            const mockQB = {
                where: jest.fn().mockReturnThis(),
                orWhere: jest.fn().mockReturnThis(),
                leftJoinAndSelect: jest.fn().mockReturnThis(),
                skip: jest.fn().mockReturnThis(),
                take: jest.fn().mockReturnThis(),
                getManyAndCount: jest.fn().mockResolvedValue([[{ id: "p1" }], 1]),
            };
            productRepo.createQueryBuilder = jest.fn().mockReturnValue(mockQB);
            const result = await service.SearchProducts("test", 1);
            expect(result).toEqual({
                products: [{ id: "p1" }],
                currentPage: 1,
                totalPages: 1,
            });
        });
        it("should throw error if query builder fails", async () => {
            productRepo.createQueryBuilder = jest.fn().mockImplementation(() => {
                throw new Error("fail");
            });
            await expect(service.SearchProducts("x", 1)).rejects.toThrow(/Failed to search products/);
        });
    });
    describe("FindProductsByCategory", () => {
        it("should return paginated products by category", async () => {
            const mockQB = {
                where: jest.fn().mockReturnThis(),
                leftJoinAndSelect: jest.fn().mockReturnThis(),
                skip: jest.fn().mockReturnThis(),
                take: jest.fn().mockReturnThis(),
                getManyAndCount: jest.fn().mockResolvedValue([[{ id: "p2" }], 1]),
            };
            productRepo.createQueryBuilder = jest.fn().mockReturnValue(mockQB);
            const result = await service.FindProductsByCategory("cat1", 1);
            expect(result).toEqual({
                products: [{ id: "p2" }],
                currentPage: 1,
                totalPages: 1,
            });
        });
        it("should throw error if query builder fails", async () => {
            productRepo.createQueryBuilder = jest.fn().mockImplementation(() => {
                throw new Error("fail");
            });
            await expect(service.FindProductsByCategory("cat1", 1)).rejects.toThrow(/Failed to fetch products by category/);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvb21hci9EZXNrdG9wL1Byb3RvZm9saW9fd2l0aG91dF9yZWRpcy9zcmMvdXNlci91c2VyLnNlcnZpY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZDQUFzRDtBQUN0RCxpREFBNkM7QUFDN0MsNkNBQXFEO0FBQ3JELHlEQUErQztBQUMvQywyQ0FBd0U7QUFFeEUsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7SUFDM0IsSUFBSSxPQUFvQixDQUFDO0lBQ3pCLElBQUksUUFBbUMsQ0FBQztJQUN4QyxJQUFJLFdBQXNDLENBQUM7SUFDM0MsSUFBSSxVQUFxQyxDQUFDO0lBQzFDLElBQUksUUFBbUMsQ0FBQztJQUN4QyxJQUFJLFlBQXVDLENBQUM7SUFFNUMsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxTQUFTLEVBQUU7Z0JBQ1QsMEJBQVc7Z0JBQ1gsRUFBRSxPQUFPLEVBQUUsSUFBQSw0QkFBa0IsRUFBQyxrQkFBSSxDQUFDLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRTtnQkFDbkQ7b0JBQ0UsT0FBTyxFQUFFLGdCQUFnQjtvQkFDekIsUUFBUSxFQUFFLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsRUFBRTtpQkFDakM7Z0JBQ0Q7b0JBQ0UsT0FBTyxFQUFFLG1CQUFtQjtvQkFDNUIsUUFBUSxFQUFFLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxFQUFFO2lCQUN2RDtnQkFDRDtvQkFDRSxPQUFPLEVBQUUsa0JBQWtCO29CQUMzQixRQUFRLEVBQUU7d0JBQ1IsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7d0JBQ2xCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3dCQUNqQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTt3QkFDZixNQUFN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QUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FDckUsc0NBQXNDLENBQ3ZDLENBQUM7UUFDSixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvb21hci9EZXNrdG9wL1Byb3RvZm9saW9fd2l0aG91dF9yZWRpcy9zcmMvdXNlci91c2VyLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUZXN0LCBUZXN0aW5nTW9kdWxlIH0gZnJvbSBcIkBuZXN0anMvdGVzdGluZ1wiO1xuaW1wb3J0IHsgVXNlclNlcnZpY2UgfSBmcm9tIFwiLi91c2VyLnNlcnZpY2VcIjtcbmltcG9ydCB7IGdldFJlcG9zaXRvcnlUb2tlbiB9IGZyb20gXCJAbmVzdGpzL3R5cGVvcm1cIjtcbmltcG9ydCB7IFVzZXIgfSBmcm9tIFwiLi4vZW50aXRpZXMvVXNlci5lbnRpdHlcIjtcbmltcG9ydCB7IEJhZFJlcXVlc3RFeGNlcHRpb24sIE5vdEZvdW5kRXhjZXB0aW9uIH0gZnJvbSBcIkBuZXN0anMvY29tbW9uXCI7XG5cbmRlc2NyaWJlKFwiVXNlclNlcnZpY2VcIiwgKCkgPT4ge1xuICBsZXQgc2VydmljZTogVXNlclNlcnZpY2U7XG4gIGxldCB1c2VyUmVwbzogUmVjb3JkPHN0cmluZywgamVzdC5Nb2NrPjtcbiAgbGV0IHByb2R1Y3RSZXBvOiBSZWNvcmQ8c3RyaW5nLCBqZXN0Lk1vY2s+O1xuICBsZXQgcmV2aWV3UmVwbzogUmVjb3JkPHN0cmluZywgamVzdC5Nb2NrPjtcbiAgbGV0IGNhcnRSZXBvOiBSZWNvcmQ8c3RyaW5nLCBqZXN0Lk1vY2s+O1xuICBsZXQgY2FydEl0ZW1SZXBvOiBSZWNvcmQ8c3RyaW5nLCBqZXN0Lk1vY2s+O1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG1vZHVsZTogVGVzdGluZ01vZHVsZSA9IGF3YWl0IFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZSh7XG4gICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgVXNlclNlcnZpY2UsXG4gICAgICAgIHsgcHJvdmlkZTogZ2V0UmVwb3NpdG9yeVRva2VuKFVzZXIpLCB1c2VWYWx1ZToge30gfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFwiVXNlclJlcG9zaXRvcnlcIixcbiAgICAgICAgICB1c2VWYWx1ZTogeyBmaW5kT25lOiBqZXN0LmZuKCkgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFwiUHJvZHVjdFJlcG9zaXRvcnlcIixcbiAgICAgICAgICB1c2VWYWx1ZTogeyBmaW5kT25lOiBqZXN0LmZuKCksIGZpbmRPbmVCeTogamVzdC5mbigpIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBcIlJldmlld1JlcG9zaXRvcnlcIixcbiAgICAgICAgICB1c2VWYWx1ZToge1xuICAgICAgICAgICAgZmluZE9uZTogamVzdC5mbigpLFxuICAgICAgICAgICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBzYXZlOiBqZXN0LmZuKCksXG4gICAgICAgICAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIGRlbGV0ZTogamVzdC5mbigpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBcIkNhcnRSZXBvc2l0b3J5XCIsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIGZpbmRPbmU6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIGZpbmRPbmVCeTogamVzdC5mbigpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBcIkNhcnRJdGVtUmVwb3NpdG9yeVwiLFxuICAgICAgICAgIHVzZVZhbHVlOiB7XG4gICAgICAgICAgICBmaW5kT25lOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIHNhdmU6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIGZpbmRPbmVCeTogamVzdC5mbigpLFxuICAgICAgICAgICAgcmVtb3ZlOiBqZXN0LmZuKCksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSkuY29tcGlsZSgpO1xuXG4gICAgc2VydmljZSA9IG1vZHVsZS5nZXQ8VXNlclNlcnZpY2U+KFVzZXJTZXJ2aWNlKTtcbiAgICB1c2VyUmVwbyA9IG1vZHVsZS5nZXQoXCJVc2VyUmVwb3NpdG9yeVwiKTtcbiAgICBwcm9kdWN0UmVwbyA9IG1vZHVsZS5nZXQoXCJQcm9kdWN0UmVwb3NpdG9yeVwiKTtcbiAgICByZXZpZXdSZXBvID0gbW9kdWxlLmdldChcIlJldmlld1JlcG9zaXRvcnlcIik7XG4gICAgY2FydFJlcG8gPSBtb2R1bGUuZ2V0KFwiQ2FydFJlcG9zaXRvcnlcIik7XG4gICAgY2FydEl0ZW1SZXBvID0gbW9kdWxlLmdldChcIkNhcnRJdGVtUmVwb3NpdG9yeVwiKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJDaGVjayBpZiBzZXJ2aWNlIGRlZmluZWRcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIGJlIGRlZmluZWRcIiwgKCkgPT4ge1xuICAgICAgZXhwZWN0KHNlcnZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiQWRkX1Jldmlld1wiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgdGhyb3cgaWYgdXNlciBub3QgZm91bmRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgdXNlclJlcG8uZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5BZGRfUmV2aWV3KFwieEB0ZXN0LmNvbVwiLCBcImdvb2RcIiwgXCIxXCIsIDUpLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFeGNlcHRpb24pO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgdGhyb3cgaWYgcHJvZHVjdCBub3QgZm91bmRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgdXNlclJlcG8uZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlzVmVyaWZpZWQ6IHRydWUgfSk7XG4gICAgICBwcm9kdWN0UmVwby5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLkFkZF9SZXZpZXcoXCJ4QHRlc3QuY29tXCIsIFwiZ29vZFwiLCBcIjFcIiwgNSksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCByZXR1cm4gb2sgaWYgcmV2aWV3IHNhdmVkIHN1Y2Nlc3NmdWxseVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVXNlciA9IHsgZW1haWw6IFwieEB0ZXN0LmNvbVwiLCBpc1ZlcmlmaWVkOiB0cnVlIH07XG4gICAgICBjb25zdCBtb2NrUHJvZHVjdCA9IHsgaWQ6IFwiMVwiIH07XG4gICAgICB1c2VyUmVwby5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcbiAgICAgIHByb2R1Y3RSZXBvLmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3QpO1xuICAgICAgcmV2aWV3UmVwby5jcmVhdGUubW9ja1JldHVyblZhbHVlKHt9KTtcbiAgICAgIHJldmlld1JlcG8uc2F2ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuQWRkX1JldmlldyhcInhAdGVzdC5jb21cIiwgXCJnb29kXCIsIFwiMVwiLCA1KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoXCJva1wiKTtcbiAgICB9KTtcbiAgfSk7XG4gIGRlc2NyaWJlKFwiRWRpdF9SZXZpZXdcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHRocm93IG5vdGZvdW5kZXhjZXB0aW9uXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldmlld1JlcG8uZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS5FZGl0X1JldmlldyhcInhAdGVzdC5jb21cIiwgXCIzNDNcIiwgXCJnb29kXCIsIDUpLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFeGNlcHRpb24pO1xuICAgIH0pO1xuICAgIGl0KFwic2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIGlmIHVzZXIgbm90IGF1dGhvcml6ZWRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JldmlldyA9IHsgdXNlcjogeyBlbWFpbDogXCJvdGhlckB0ZXN0LmNvbVwiIH0gfTsgLy8g2YXYs9iq2K7Yr9mFINmF2K7YqtmE2YFcbiAgICAgIHJldmlld1JlcG8uZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmV2aWV3KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLkVkaXRfUmV2aWV3KFwieEB0ZXN0LmNvbVwiLCBcIjM0M1wiLCBcImdvb2RcIiwgNSksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBwYXNzIGlmIHVzZXIgb3ducyByZXZpZXdcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1JldmlldyA9IHsgdXNlcjogeyBlbWFpbDogXCJ4QHRlc3QuY29tXCIgfSB9O1xuICAgICAgcmV2aWV3UmVwby5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tSZXZpZXcpO1xuICAgICAgcmV2aWV3UmVwby51cGRhdGUubW9ja1Jlc29sdmVkVmFsdWUoe30pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLkVkaXRfUmV2aWV3KFwieEB0ZXN0LmNvbVwiLCBcIjM0M1wiLCBcImdvb2RcIiwgNSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoXCJSZW1vdmVfUmV2aWV3XCIsICgpID0+IHtcbiAgICBpdChcIm11c3QgcmV0dXRuIE5vdEZvdW5kRXhjZXB0aW9uXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldmlld1JlcG8uZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLlJlbW92ZV9SZXZpZXcoXCJ4QHRlc3QuY29tXCIsIFwiMzQzXCIpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIE5vdEZvdW5kRXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICB9KTtcbiAgICBpdChcInNob3VsZCB0aHJvdyBOb3RGb3VuZEV4Y2VwdGlvbiB3aGVuIHVzZXIgZW1haWwgZG9lcyBub3QgbWF0Y2hcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV2aWV3UmVwby5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgaWQ6IFwiMzQzXCIsXG4gICAgICAgIHVzZXI6IHsgZW1haWw6IFwib3RoZXJAdGVzdC5jb21cIiB9LFxuICAgICAgfSk7XG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5SZW1vdmVfUmV2aWV3KFwieEB0ZXN0LmNvbVwiLCBcIjM0M1wiKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBOb3RGb3VuZEV4Y2VwdGlvbixcbiAgICAgICk7XG4gICAgfSk7XG4gICAgaXQoXCJzaG91bGQgZGVsZXRlIHJldmlldyBhbmQgcmV0dXJuIG9rIHdoZW4gYXV0aG9yaXplZFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXZpZXdSZXBvLmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBpZDogXCIzNDNcIixcbiAgICAgICAgdXNlcjogeyBlbWFpbDogXCJ4QHRlc3QuY29tXCIgfSxcbiAgICAgIH0pO1xuICAgICAgcmV2aWV3UmVwby5kZWxldGUubW9ja1Jlc29sdmVkVmFsdWUoe30pO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5SZW1vdmVfUmV2aWV3KFwieEB0ZXN0LmNvbVwiLCBcIjM0M1wiKTtcblxuICAgICAgZXhwZWN0KHJldmlld1JlcG8uZGVsZXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7IGlkOiBcIjM0M1wiIH0pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShcIm9rXCIpO1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoXCJBZGRfQ2FydF9JdGVtXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCB0aHJvdyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBjYXJ0IG5vdCBmb3VuZFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjYXJ0UmVwby5maW5kT25lQnkubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLkFkZF9DYXJ0X0l0ZW0oXCIzNDNcIiwgXCI0NDRcIikpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgTm90Rm91bmRFeGNlcHRpb24sXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gaWYgcHJvZHVjdCBub3QgZm91bmRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gbW9jayBjYXJ0IGV4aXN0c1xuICAgICAgY2FydFJlcG8uZmluZE9uZUJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6IFwiMzQzXCIgfSk7XG4gICAgICAvLyBtb2NrIHByb2R1Y3QgbWlzc2luZ1xuICAgICAgcHJvZHVjdFJlcG8uZmluZE9uZUJ5Lm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5BZGRfQ2FydF9JdGVtKFwiMzQzXCIsIFwiNDQ0XCIpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIE5vdEZvdW5kRXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHRocm93IEJhZFJlcXVlc3RFeGNlcHRpb24gaWYgaXRlbSBhbHJlYWR5IGluIGNhcnRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY2FydFJlcG8uZmluZE9uZUJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6IFwiMzQzXCIgfSk7XG4gICAgICBwcm9kdWN0UmVwby5maW5kT25lQnkubW9ja1Jlc29sdmVkVmFsdWUoeyBpZDogXCI0NDRcIiB9KTtcbiAgICAgIGNhcnRJdGVtUmVwby5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6IFwiMVwiIH0pOyAvLyBpdGVtIGFscmVhZHkgZXhpc3RzXG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLkFkZF9DYXJ0X0l0ZW0oXCIzNDNcIiwgXCI0NDRcIikpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgQmFkUmVxdWVzdEV4Y2VwdGlvbixcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBjcmVhdGUgYW5kIHNhdmUgbmV3IGNhcnQgaXRlbSB3aGVuIGFsbCB2YWxpZFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrQ2FydCA9IHsgaWQ6IFwiMzQzXCIgfTtcbiAgICAgIGNvbnN0IG1vY2tQcm9kdWN0ID0geyBpZDogXCI0NDRcIiB9O1xuICAgICAgY29uc3QgbW9ja0NhcnRJdGVtID0geyBpZDogXCI5OTlcIiB9O1xuXG4gICAgICBjYXJ0UmVwby5maW5kT25lQnkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0NhcnQpO1xuICAgICAgcHJvZHVjdFJlcG8uZmluZE9uZUJ5Lm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9kdWN0KTtcbiAgICAgIGNhcnRJdGVtUmVwby5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgY2FydEl0ZW1SZXBvLmNyZWF0ZS5tb2NrUmV0dXJuVmFsdWUobW9ja0NhcnRJdGVtKTtcbiAgICAgIGNhcnRJdGVtUmVwby5zYXZlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tDYXJ0SXRlbSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuQWRkX0NhcnRfSXRlbShcIjM0M1wiLCBcIjQ0NFwiKTtcblxuICAgICAgZXhwZWN0KGNhcnRJdGVtUmVwby5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgcXVhbnRpdHk6IDEsXG4gICAgICAgIGNhcnQ6IG1vY2tDYXJ0LFxuICAgICAgICBwcm9kdWN0OiBtb2NrUHJvZHVjdCxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGNhcnRJdGVtUmVwby5zYXZlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2NrQ2FydEl0ZW0pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShcIm9rXCIpO1xuICAgIH0pO1xuICB9KTtcbiAgZGVzY3JpYmUoXCJSZW1vdmVfQ2FydF9JdGVtXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCB0aHJvdyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBjYXJ0IG5vdCBmb3VuZFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjYXJ0UmVwby5maW5kT25lQnkubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5SZW1vdmVfQ2FydF9JdGVtKFwiMVwiLCBcIjJcIikpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgTm90Rm91bmRFeGNlcHRpb24sXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gaWYgcHJvZHVjdCBub3QgZm91bmRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY2FydFJlcG8uZmluZE9uZUJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6IFwiMVwiIH0pO1xuICAgICAgcHJvZHVjdFJlcG8uZmluZE9uZUJ5Lm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuUmVtb3ZlX0NhcnRfSXRlbShcIjFcIiwgXCIyXCIpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIE5vdEZvdW5kRXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIGlmIGNhcnQgaXRlbSBub3QgZm91bmRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY2FydFJlcG8uZmluZE9uZUJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6IFwiMVwiIH0pO1xuICAgICAgcHJvZHVjdFJlcG8uZmluZE9uZUJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6IFwiMlwiIH0pO1xuICAgICAgY2FydEl0ZW1SZXBvLmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5SZW1vdmVfQ2FydF9JdGVtKFwiMVwiLCBcIjJcIikpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgTm90Rm91bmRFeGNlcHRpb24sXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgcmVtb3ZlIGNhcnQgaXRlbSBhbmQgcmV0dXJuIG9rXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tJdGVtID0geyBpZDogXCIzXCIgfTtcbiAgICAgIGNhcnRSZXBvLmZpbmRPbmVCeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlkOiBcIjFcIiB9KTtcbiAgICAgIHByb2R1Y3RSZXBvLmZpbmRPbmVCeS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlkOiBcIjJcIiB9KTtcbiAgICAgIGNhcnRJdGVtUmVwby5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tJdGVtKTtcbiAgICAgIGNhcnRJdGVtUmVwby5yZW1vdmUubW9ja1Jlc29sdmVkVmFsdWUoe30pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLlJlbW92ZV9DYXJ0X0l0ZW0oXCIxXCIsIFwiMlwiKTtcblxuICAgICAgZXhwZWN0KGNhcnRJdGVtUmVwby5yZW1vdmUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tJdGVtKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoXCJva1wiKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJpbmNyZWFzZV9RdWFudGl0eVwiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gaWYgY2FydCBpdGVtIG5vdCBmb3VuZFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjYXJ0SXRlbVJlcG8uZmluZE9uZUJ5Lm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuaW5jcmVhc2VfUXVhbnRpdHkoXCIxXCIpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIE5vdEZvdW5kRXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHJldHVybiAnbm8nIGlmIHF1YW50aXR5ID49IDk5OVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjYXJ0SXRlbVJlcG8uZmluZE9uZUJ5Lm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6IFwiMVwiLCBxdWFudGl0eTogOTk5IH0pO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5pbmNyZWFzZV9RdWFudGl0eShcIjFcIik7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKFwibm9cIik7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBpbmNyZW1lbnQgcXVhbnRpdHkgYW5kIHNhdmUgaWYgdmFsaWRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0l0ZW0gPSB7IGlkOiBcIjFcIiwgcXVhbnRpdHk6IDUgfTtcbiAgICAgIGNhcnRJdGVtUmVwby5maW5kT25lQnkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0l0ZW0pO1xuICAgICAgY2FydEl0ZW1SZXBvLnNhdmUubW9ja1Jlc29sdmVkVmFsdWUoe30pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmluY3JlYXNlX1F1YW50aXR5KFwiMVwiKTtcblxuICAgICAgZXhwZWN0KG1vY2tJdGVtLnF1YW50aXR5KS50b0JlKDYpO1xuICAgICAgZXhwZWN0KGNhcnRJdGVtUmVwby5zYXZlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2NrSXRlbSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKFwib2tcIik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiZGVjcmVhc2VfUXVhbnRpdHlcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIGlmIGNhcnQgaXRlbSBub3QgZm91bmRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY2FydEl0ZW1SZXBvLmZpbmRPbmVCeS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmRlY3JlYXNlX1F1YW50aXR5KFwiMVwiKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBOb3RGb3VuZEV4Y2VwdGlvbixcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCByZXR1cm4gJ25vJyBpZiBxdWFudGl0eSA8PSAxXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNhcnRJdGVtUmVwby5maW5kT25lQnkubW9ja1Jlc29sdmVkVmFsdWUoeyBpZDogXCIxXCIsIHF1YW50aXR5OiAxIH0pO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5kZWNyZWFzZV9RdWFudGl0eShcIjFcIik7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKFwibm9cIik7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBkZWNyZW1lbnQgcXVhbnRpdHkgYW5kIHNhdmUgaWYgdmFsaWRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0l0ZW0gPSB7IGlkOiBcIjFcIiwgcXVhbnRpdHk6IDUgfTtcbiAgICAgIGNhcnRJdGVtUmVwby5maW5kT25lQnkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0l0ZW0pO1xuICAgICAgY2FydEl0ZW1SZXBvLnNhdmUubW9ja1Jlc29sdmVkVmFsdWUoe30pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmRlY3JlYXNlX1F1YW50aXR5KFwiMVwiKTtcblxuICAgICAgZXhwZWN0KG1vY2tJdGVtLnF1YW50aXR5KS50b0JlKDQpO1xuICAgICAgZXhwZWN0KGNhcnRJdGVtUmVwby5zYXZlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2NrSXRlbSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKFwib2tcIik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiU2VhcmNoUHJvZHVjdHNcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHJldHVybiBwYWdpbmF0ZWQgcHJvZHVjdHNcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1FCID0ge1xuICAgICAgICB3aGVyZTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICAgIG9yV2hlcmU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgICBsZWZ0Sm9pbkFuZFNlbGVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICAgIHNraXA6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgICB0YWtlOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgICAgZ2V0TWFueUFuZENvdW50OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoW1t7IGlkOiBcInAxXCIgfV0sIDFdKSxcbiAgICAgIH07XG4gICAgICBwcm9kdWN0UmVwby5jcmVhdGVRdWVyeUJ1aWxkZXIgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKG1vY2tRQik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuU2VhcmNoUHJvZHVjdHMoXCJ0ZXN0XCIsIDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHByb2R1Y3RzOiBbeyBpZDogXCJwMVwiIH1dLFxuICAgICAgICBjdXJyZW50UGFnZTogMSxcbiAgICAgICAgdG90YWxQYWdlczogMSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgdGhyb3cgZXJyb3IgaWYgcXVlcnkgYnVpbGRlciBmYWlsc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcm9kdWN0UmVwby5jcmVhdGVRdWVyeUJ1aWxkZXIgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZmFpbFwiKTtcbiAgICAgIH0pO1xuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuU2VhcmNoUHJvZHVjdHMoXCJ4XCIsIDEpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIC9GYWlsZWQgdG8gc2VhcmNoIHByb2R1Y3RzLyxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiRmluZFByb2R1Y3RzQnlDYXRlZ29yeVwiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgcmV0dXJuIHBhZ2luYXRlZCBwcm9kdWN0cyBieSBjYXRlZ29yeVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUUIgPSB7XG4gICAgICAgIHdoZXJlOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgICAgbGVmdEpvaW5BbmRTZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgICBza2lwOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgICAgdGFrZTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICAgIGdldE1hbnlBbmRDb3VudDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKFtbeyBpZDogXCJwMlwiIH1dLCAxXSksXG4gICAgICB9O1xuICAgICAgcHJvZHVjdFJlcG8uY3JlYXRlUXVlcnlCdWlsZGVyID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShtb2NrUUIpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLkZpbmRQcm9kdWN0c0J5Q2F0ZWdvcnkoXCJjYXQxXCIsIDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHByb2R1Y3RzOiBbeyBpZDogXCJwMlwiIH1dLFxuICAgICAgICBjdXJyZW50UGFnZTogMSxcbiAgICAgICAgdG90YWxQYWdlczogMSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgdGhyb3cgZXJyb3IgaWYgcXVlcnkgYnVpbGRlciBmYWlsc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBwcm9kdWN0UmVwby5jcmVhdGVRdWVyeUJ1aWxkZXIgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZmFpbFwiKTtcbiAgICAgIH0pO1xuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuRmluZFByb2R1Y3RzQnlDYXRlZ29yeShcImNhdDFcIiwgMSkpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgL0ZhaWxlZCB0byBmZXRjaCBwcm9kdWN0cyBieSBjYXRlZ29yeS8sXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9