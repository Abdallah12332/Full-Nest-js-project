{"version":3,"names":["common_1","cov_23q27meybi","s","require","config_1","nodemailer","__importStar","EmailService","configService","transporter","constructor","f","EMAIL","get","PASSWORD","b","ServiceUnavailableException","createTransport","service","auth","user","pass","Mailer","to","dto","msg","from","process","env","subject","text","html","code","sendMail","error","console","sendPasswordResetEmail","exports","__decorate","Injectable","ConfigService","_a","Object"],"sources":["/home/omar/Desktop/Protofolio_without_redis/src/auth/Mailer.ts"],"sourcesContent":["import { Injectable, ServiceUnavailableException } from \"@nestjs/common\";\nimport { ConfigService } from \"@nestjs/config\";\nimport * as nodemailer from \"nodemailer\";\n\n@Injectable()\nexport class EmailService {\n  private transporter: nodemailer.Transporter;\n\n  constructor(private configService: ConfigService) {\n    const EMAIL = this.configService.get<string>(\"EMAIL\");\n    const PASSWORD = this.configService.get<string>(\"PASSWORD\");\n\n    if (!EMAIL || !PASSWORD) {\n      throw new ServiceUnavailableException(\n        \"Email service not configured. Missing EMAIL or PASSWORD environment variables.\",\n      );\n    }\n\n    this.transporter = nodemailer.createTransport({\n      service: \"gmail\",\n      auth: {\n        user: EMAIL,\n        pass: PASSWORD,\n      },\n    });\n  }\n\n  async Mailer(\n    to: string,\n    dto: { code: string; expiresAt: Date },\n  ): Promise<string> {\n    const msg = {\n      to: to,\n      from: process.env.EMAIL,\n      subject: \"كود التحقق\",\n      text: \"ادخل كود التحقق في الموقع قبل 15 دقيقه نسمح فقط بمحاولتان\",\n      html: `\n  <div style=\"font-family: Arial, sans-serif; max-width: 400px; margin: auto; padding: 20px; border: 1px solid #eee; border-radius: 8px; background-color: #fafafa; text-align: center;\">\n    <h2 style=\"color: #333;\">Email Verification</h2>\n    <p style=\"font-size: 14px; color: #555;\">\n      استخدم الكود أدناه لتأكيد بريدك الإلكتروني. الكود صالح لمدة 15 دقيقة.\n    </p>\n    <div style=\"font-size: 24px; font-weight: bold; letter-spacing: 4px; color: #2d89ef; margin: 20px 0;\">\n      ${dto.code}\n    </div>\n    <p style=\"font-size: 12px; color: #999;\">\n      إذا لم تطلب هذا الكود تجاهل هذه الرسالة.\n    </p>\n  </div>\n`,\n    };\n\n    try {\n      await this.transporter.sendMail(msg);\n      return \"the Email sent!\";\n    } catch (error) {\n      console.error(error);\n      throw new ServiceUnavailableException(\n        \"Failed to send verification email. Please try again later.\",\n      );\n    }\n  }\n\n  async sendPasswordResetEmail(\n    to: string,\n    dto: { code: string; expiresAt: Date },\n  ): Promise<string> {\n    const msg = {\n      to: to,\n      from: process.env.EMAIL,\n      subject: \"إعادة تعيين كلمة المرور\",\n      text: \"استخدم الرقم الموجود وضعه في الموقعنا\",\n      html: `\n  <div style=\"font-family: Arial, sans-serif; max-width: 400px; margin: auto; padding: 20px; border: 1px solid #eee; border-radius: 8px; background-color: #fafafa; text-align: center;\">\n    <h2 style=\"color: #333;\">Password Reset</h2>\n    <p style=\"font-size: 14px; color: #555;\">\n      استخدم الرقم أدناه لإعادة تعيين كلمة المرور الخاصة بك. الرقم صالح لمدة ساعة واحدة.\n    </p>\n    <div style=\"font-size: 12px; font-family: monospace; color: #2d89ef; margin: 20px 0; padding: 10px; background: #f0f0f0; border-radius: 4px; word-break: break-all;\">\n      ${dto.code}\n    </div>\n    <p style=\"font-size: 12px; color: #999;\">\n      إذا لم تطلب إعادة تعيين كلمة المرور، تجاهل هذه الرسالة.\n    </p>\n  </div>\n`,\n    };\n\n    try {\n      await this.transporter.sendMail(msg);\n      return \"Password reset email sent!\";\n    } catch (error) {\n      console.error(error);\n      throw new ServiceUnavailableException(\n        \"Failed to send password reset email. Please try again later.\",\n      );\n    }\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}