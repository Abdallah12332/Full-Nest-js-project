{"file":"/home/omar/Desktop/Protofolio_without_redis/src/auth/auth.service.spec.ts","mappings":"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","names":[],"sources":["/home/omar/Desktop/Protofolio_without_redis/src/auth/auth.service.spec.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unsafe-assignment */\n// موكات يجب أن تكون قبل أي imports تصلح لـ hoisting\njest.mock(\"./generation\", () => ({\n  generation: jest.fn(() => ({\n    num: 123456,\n    expiresAt: new Date(\"2025-11-03T22:08:23.789Z\"),\n  })),\n}));\n\n// mock bcryptjs قبل الاستيراد\njest.mock(\"bcryptjs\", () => ({\n  __esModule: true,\n  compare: jest.fn(),\n  hash: jest.fn(),\n  default: {\n    compare: jest.fn(),\n    hash: jest.fn(),\n  },\n}));\n\nimport * as bcrypt from \"bcryptjs\";\nimport { Test, TestingModule } from \"@nestjs/testing\";\nimport { getRepositoryToken } from \"@nestjs/typeorm\";\nimport { JwtService } from \"@nestjs/jwt\";\nimport { ConfigService } from \"@nestjs/config\";\n\nimport { AuthService } from \"./auth.service\";\nimport { User } from \"../entities/User.entity\";\nimport { Cart } from \"../entities/Cart.entity\";\nimport { Verification } from \"../entities/Verification.entity\";\nimport { FailedAttempt } from \"../entities/FailedAttempt.entity\";\nimport { PasswordReset } from \"../entities/PasswordReset.entity\";\nimport { EmailService } from \"./Mailer\";\nimport { RefreshTokenBlacklist } from \"../entities/BlackList.entity\";\nimport { ApiResponse } from \"../common/dto/response.dto\";\nimport { Repository } from \"typeorm\";\n\ndescribe(\"AuthService\", () => {\n  let service: AuthService;\n  let emailService: EmailService;\n\n  // Repos كلها معرفة بالـ methods اللي يستخدمهم service\n  const mockUserRepository: Partial<Record<keyof Repository<User>, jest.Mock>> =\n    {\n      findOne: jest.fn(),\n      create: jest.fn(),\n      save: jest.fn(),\n      update: jest.fn(),\n      delete: jest.fn(),\n      find: jest.fn(),\n    };\n\n  const mockCartRepository = {\n    findOne: jest.fn(),\n    create: jest.fn(),\n    save: jest.fn(),\n    update: jest.fn(),\n    delete: jest.fn(),\n    find: jest.fn(),\n  };\n\n  const mockVerificationRepository = {\n    findOne: jest.fn(),\n    create: jest.fn(),\n    save: jest.fn(),\n    update: jest.fn(),\n    delete: jest.fn(),\n    find: jest.fn(),\n  };\n\n  const mockFailedAttemptRepository = {\n    findOne: jest.fn(),\n    create: jest.fn(),\n    save: jest.fn(),\n    update: jest.fn(),\n    delete: jest.fn(),\n    find: jest.fn(),\n  };\n\n  const mockPasswordResetRepository = {\n    findOne: jest.fn(),\n    create: jest.fn(),\n    save: jest.fn(),\n    update: jest.fn(),\n    delete: jest.fn(),\n    find: jest.fn(),\n  };\n\n  const mockBlacklistRepository = {\n    findOne: jest.fn(),\n    create: jest.fn(),\n    save: jest.fn(),\n    update: jest.fn(),\n    delete: jest.fn(),\n    find: jest.fn(),\n  };\n\n  beforeEach(async () => {\n    // مسح الـ mocks\n    jest.clearAllMocks();\n\n    // قيم افتراضية للـ bcrypt\n    (bcrypt.hash as jest.Mock).mockResolvedValue(\"hashed-password\");\n    (bcrypt.compare as jest.Mock).mockResolvedValue(true);\n\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        AuthService,\n        {\n          provide: JwtService,\n          useValue: {\n            sign: jest.fn().mockReturnValue(\"mock-jwt-token\"),\n            verify: jest.fn().mockReturnValue({ sub: \"test-uuid\" }),\n          },\n        },\n        {\n          provide: ConfigService,\n          useValue: {\n            get: jest.fn(),\n          },\n        },\n        { provide: getRepositoryToken(User), useValue: mockUserRepository },\n        { provide: getRepositoryToken(Cart), useValue: mockCartRepository },\n        {\n          provide: getRepositoryToken(Verification),\n          useValue: mockVerificationRepository,\n        },\n        {\n          provide: getRepositoryToken(FailedAttempt),\n          useValue: mockFailedAttemptRepository,\n        },\n        {\n          provide: getRepositoryToken(PasswordReset),\n          useValue: mockPasswordResetRepository,\n        },\n        {\n          provide: getRepositoryToken(RefreshTokenBlacklist),\n          useValue: mockBlacklistRepository,\n        },\n        {\n          provide: EmailService,\n          useValue: {\n            Mailer: jest.fn().mockResolvedValue(\"Email sent!\"),\n            sendPasswordResetEmail: jest\n              .fn()\n              .mockResolvedValue(\"Password reset email sent!\"),\n          },\n        },\n      ],\n    }).compile();\n\n    service = module.get<AuthService>(AuthService);\n    emailService = module.get<EmailService>(EmailService);\n  });\n\n  it(\"should be defined\", () => {\n    expect(service).toBeDefined();\n  });\n\n  describe(\"register_half\", () => {\n    const email = \"new@example.com\";\n    const ip = \"127.0.0.1\";\n\n    beforeEach(() => {\n      // إعادة تعيين bcrypt في بداية كل اختبار\n      (bcrypt.hash as jest.Mock).mockResolvedValue(\"hashed-password\");\n      (bcrypt.compare as jest.Mock).mockResolvedValue(true);\n      mockFailedAttemptRepository.findOne.mockResolvedValue(null);\n    });\n\n    it(\"should send verification email if user does not exist\", async () => {\n      mockUserRepository.findOne!.mockResolvedValueOnce(null);\n      mockVerificationRepository.findOne.mockResolvedValueOnce(null);\n\n      const mailerSpy = jest\n        .spyOn(emailService, \"Mailer\")\n        .mockResolvedValue(\"Email sent!\");\n\n      await service.register_half(email, ip);\n\n      expect(mailerSpy).toHaveBeenCalledWith(\n        email,\n        expect.objectContaining({\n          code: expect.anything(),\n          expiresAt: expect.any(Date),\n        }),\n      );\n\n      mailerSpy.mockRestore();\n    });\n\n    it(\"should throw when user already exists\", async () => {\n      mockUserRepository.findOne!.mockResolvedValueOnce({ email });\n      await expect(service.register_half(email, ip)).rejects.toThrow(\n        \"انت لديك حساب انتقل الي صفحه تسجيل الدخول (login page)\",\n      );\n    });\n\n    it(\"should update existing verification record\", async () => {\n      mockUserRepository.findOne!.mockResolvedValueOnce(null);\n      mockVerificationRepository.findOne.mockResolvedValueOnce({ email });\n\n      const result = await service.register_half(email, ip);\n\n      expect(mockVerificationRepository.update).toHaveBeenCalledWith(\n        { email },\n        expect.objectContaining({\n          code: expect.anything(),\n          expiresAt: expect.any(Date),\n        }),\n      );\n\n      expect(result).toBeInstanceOf(ApiResponse);\n      expect(result.success).toBe(true);\n      expect(result.message).toBe(\"Email sent!\");\n      expect(result.data).toBeUndefined();\n    });\n  });\n\n  describe(\"register_full\", () => {\n    const email = \"user@example.com\";\n    const code = \"123456\";\n    const ipAddress = \"127.0.0.1\";\n\n    beforeEach(() => {\n      (bcrypt.hash as jest.Mock).mockResolvedValue(\"hashed-password\");\n      (bcrypt.compare as jest.Mock).mockResolvedValue(true);\n    });\n\n    it(\"should throw NotFoundException if verification record not found\", async () => {\n      mockVerificationRepository.findOne.mockResolvedValueOnce(null);\n      await expect(\n        service.register_full(email, code, ipAddress),\n      ).rejects.toThrow(\"Email:code not found\");\n    });\n\n    it(\"should throw BadRequestException if code is expired\", async () => {\n      mockVerificationRepository.findOne.mockResolvedValueOnce({\n        email,\n        code,\n        expiresAt: new Date(Date.now() - 10000),\n      });\n\n      await expect(\n        service.register_full(email, code, ipAddress),\n      ).rejects.toThrow(\"code is expired\");\n    });\n\n    it(\"should throw BadRequestException if code is invalid\", async () => {\n      mockVerificationRepository.findOne.mockResolvedValueOnce({\n        email,\n        code: \"000000\",\n        expiresAt: new Date(Date.now() + 10000),\n      });\n\n      const recordFailedAttemptSpy = jest.spyOn(\n        service as any,\n        \"recordFailedAttempt\",\n      );\n\n      await expect(\n        service.register_full(email, code, ipAddress),\n      ).rejects.toThrow(\"invalid code\");\n\n      expect(recordFailedAttemptSpy).toHaveBeenCalledWith(\n        email,\n        ipAddress,\n        \"verification\",\n      );\n    });\n\n    it(\"should create user and cart if code valid\", async () => {\n      mockVerificationRepository.findOne.mockResolvedValueOnce({\n        email,\n        code,\n        expiresAt: new Date(Date.now() + 10000),\n      });\n\n      mockUserRepository.create!.mockReturnValueOnce({\n        email,\n        provider: \"local\",\n        isVerified: false,\n        googleId: undefined,\n        role: \"user\",\n      });\n      mockUserRepository.save!.mockResolvedValueOnce({ id: 1, email });\n\n      mockCartRepository.create.mockReturnValueOnce({ id: 10 });\n      mockCartRepository.save.mockResolvedValueOnce({ id: 10 });\n\n      const clearFailedAttemptsSpy = jest.spyOn(\n        service as any,\n        \"clearFailedAttempts\",\n      );\n\n      const result = await service.register_full(email, code, ipAddress);\n\n      expect(clearFailedAttemptsSpy).toHaveBeenCalledWith(\n        email,\n        ipAddress,\n        \"verification\",\n      );\n      expect(mockVerificationRepository.delete).toHaveBeenCalledWith({ email });\n      expect(mockUserRepository.create).toHaveBeenCalledWith({\n        email,\n        provider: \"local\",\n        isVerified: false,\n        googleId: undefined,\n        role: \"user\",\n      });\n      expect(mockCartRepository.create).toHaveBeenCalledWith({\n        user: expect.objectContaining({ email }),\n      });\n\n      expect(result).toBeInstanceOf(ApiResponse);\n      expect(result.success).toBe(true);\n      expect(result.message).toBe(\"Code verified successfully\");\n    });\n  });\n\n  describe(\"register_complete\", () => {\n    const email = \"new@example.com\";\n    const password = \"securePassword123\";\n\n    beforeEach(() => {\n      (bcrypt.hash as jest.Mock).mockResolvedValue(\"hashed-password\");\n      (bcrypt.compare as jest.Mock).mockResolvedValue(true);\n    });\n\n    it(\"should throw NotFoundException if user not found\", async () => {\n      mockUserRepository.findOne!.mockResolvedValueOnce(null);\n      await expect(service.register_complete(email, password)).rejects.toThrow(\n        \"user not found\",\n      );\n    });\n\n    it(\"should complete registration and return tokens\", async () => {\n      const user = { id: \"uuid-123\", email, role: \"user\", isVerified: false };\n      mockUserRepository.findOne!.mockResolvedValueOnce(user);\n\n      (bcrypt.hash as jest.Mock)\n        .mockResolvedValueOnce(\"hashed-password\")\n        .mockResolvedValueOnce(\"hashed-refresh\");\n\n      const jwtService = service[\"jwtService\"];\n      const configService = service[\"configService\"];\n\n      jest.spyOn(jwtService, \"sign\").mockReturnValue(\"mock-token\");\n      jest.spyOn(configService, \"get\").mockReturnValue(\"1h\");\n\n      mockUserRepository.update!.mockResolvedValueOnce({ affected: 1 });\n\n      const result = await service.register_complete(email, password);\n\n      expect(mockUserRepository.findOne).toHaveBeenCalledWith({\n        where: { email },\n      });\n\n      expect(mockUserRepository.update).toHaveBeenCalledWith(\n        { email },\n        expect.objectContaining({\n          password: expect.any(String),\n          isVerified: true,\n          refresh_Token: expect.any(String),\n        }),\n      );\n      expect(result).toEqual({\n        access_token: \"mock-token\",\n        refresh_Token: \"mock-token\",\n      });\n    });\n  });\n\n  describe(\"login\", () => {\n    const email = \"test@example.com\";\n    const password = \"password123\";\n    const ipAddress = \"127.0.0.1\";\n\n    beforeEach(() => {\n      // إعادة تعيين bcrypt في بداية كل اختبار login\n      (bcrypt.hash as jest.Mock).mockResolvedValue(\"hashed-password\");\n      (\n        bcrypt.compare as jest.Mock<Promise<boolean>, [string, string]>\n      ).mockResolvedValue(true);\n\n      // تأكيد أن النسخة الحقيقية داخل AuthService مموهة أيضًا\n      jest.spyOn(bcrypt, \"compare\").mockResolvedValue(Promise.resolve(true));\n\n      // إعداد mock افتراضي لـ FailedAttemptRepository\n      mockFailedAttemptRepository.findOne.mockResolvedValue(null);\n    });\n\n    it(\"should throw NotFoundException if user not found\", async () => {\n      mockUserRepository.findOne!.mockResolvedValueOnce(null);\n      await expect(service.login(email, password, ipAddress)).rejects.toThrow(\n        \"User not found\",\n      );\n    });\n\n    it(\"should throw NotFoundException if user has no password\", async () => {\n      mockUserRepository.findOne!.mockResolvedValueOnce({ email });\n      await expect(service.login(email, password, ipAddress)).rejects.toThrow(\n        \"password not set\",\n      );\n    });\n\n    it(\"should throw NotFoundException if password not provided\", async () => {\n      mockUserRepository.findOne!.mockResolvedValueOnce({\n        email,\n        password: \"hashed\",\n      });\n      await expect(service.login(email, undefined, ipAddress)).rejects.toThrow(\n        \"write password\",\n      );\n    });\n\n    it(\"should throw UnauthorizedException if user is not verified\", async () => {\n      mockUserRepository.findOne!.mockResolvedValueOnce({\n        email,\n        password: \"hashed\",\n        isVerified: false,\n      });\n      await expect(service.login(email, password, ipAddress)).rejects.toThrow(\n        \"blocked\",\n      );\n    });\n\n    it(\"should throw BadRequestException if password is wrong\", async () => {\n      mockUserRepository.findOne!.mockResolvedValueOnce({\n        email,\n        password: \"hashed\",\n        isVerified: true,\n      });\n      (bcrypt.compare as jest.Mock).mockResolvedValueOnce(false);\n\n      await expect(service.login(email, password, ipAddress)).rejects.toThrow(\n        \"password is wrong\",\n      );\n    });\n\n    it(\"should return tokens if login successful\", async () => {\n      (bcrypt.compare as jest.Mock).mockResolvedValueOnce(true); // إجبار النجاح\n\n      const user = {\n        id: 1,\n        email: \"test@example.com\",\n        password: \"hashed\",\n        isVerified: true,\n        role: \"user\",\n        refresh_Token: null,\n      };\n\n      mockUserRepository.findOne!.mockResolvedValueOnce(user);\n      mockUserRepository.update!.mockResolvedValueOnce({ affected: 1 });\n\n      const jwtService = service[\"jwtService\"];\n      const configService = service[\"configService\"];\n      jest.spyOn(jwtService, \"sign\").mockReturnValue(\"mock-token\");\n      jest.spyOn(configService, \"get\").mockReturnValue(\"1h\");\n\n      const result = await service.login(\n        user.email,\n        \"password123\",\n        \"127.0.0.1\",\n      );\n\n      expect(result).toEqual({\n        access_token: \"mock-token\",\n        refresh_Token: \"mock-token\",\n      });\n\n      expect(mockUserRepository.update).toHaveBeenCalledWith(\n        { email: user.email },\n        { refresh_Token: expect.any(String) },\n      );\n    });\n  });\n});\n"],"version":3}