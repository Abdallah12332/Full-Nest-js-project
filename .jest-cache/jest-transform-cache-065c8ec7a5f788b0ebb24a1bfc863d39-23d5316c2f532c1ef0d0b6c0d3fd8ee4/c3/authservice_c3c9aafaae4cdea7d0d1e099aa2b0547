19ef422bd82104cee990250a89340d60
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
var _a, _b, _c, _d, _e, _f, _g, _h, _j;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AuthService = void 0;
const common_1 = require("@nestjs/common");
const User_entity_1 = require("../entities/User.entity");
const typeorm_1 = require("@nestjs/typeorm");
const typeorm_2 = require("typeorm");
const Cart_entity_1 = require("../entities/Cart.entity");
const jwt_1 = require("@nestjs/jwt");
const generation_1 = require("./generation");
const Mailer_1 = require("./Mailer");
const Verification_entity_1 = require("../entities/Verification.entity");
const FailedAttempt_entity_1 = require("../entities/FailedAttempt.entity");
const PasswordReset_entity_1 = require("../entities/PasswordReset.entity");
const bcrypt = __importStar(require("bcryptjs"));
const crypto = __importStar(require("crypto"));
const response_dto_1 = require("../common/dto/response.dto");
const BlackList_entity_1 = require("../entities/BlackList.entity");
const config_1 = require("@nestjs/config");
let AuthService = class AuthService {
    jwtService;
    userRepository;
    CartRepo;
    VerficationRepo;
    FailedAttemptRepo;
    PasswordResetRepo;
    blacklistRepo;
    EmailService;
    configService;
    constructor(jwtService, userRepository, CartRepo, VerficationRepo, FailedAttemptRepo, PasswordResetRepo, blacklistRepo, EmailService, configService) {
        this.jwtService = jwtService;
        this.userRepository = userRepository;
        this.CartRepo = CartRepo;
        this.VerficationRepo = VerficationRepo;
        this.FailedAttemptRepo = FailedAttemptRepo;
        this.PasswordResetRepo = PasswordResetRepo;
        this.blacklistRepo = blacklistRepo;
        this.EmailService = EmailService;
        this.configService = configService;
    }
    // Rate limiting helper methods
    async checkRateLimit(email, ipAddress, type) {
        // Check rate limit for this specific email+ip combination
        const attempt = await this.FailedAttemptRepo.findOne({
            where: { email, ipAddress, type },
        });
        if (attempt) {
            // Check if account is locked
            if (attempt.lockedUntil && new Date() < attempt.lockedUntil) {
                const remainingTime = Math.ceil((attempt.lockedUntil.getTime() - Date.now()) / 60000);
                throw new common_1.HttpException(`Account temporarily locked. Try again in ${remainingTime} minutes.`, common_1.HttpStatus.TOO_MANY_REQUESTS);
            }
            // Check attempt count
            const maxAttempts = type === "login" ? 5 : 3;
            const lockDuration = type === "login" ? 30 : 15; // minutes
            if (attempt.attempts >= maxAttempts) {
                const lockUntil = new Date(Date.now() + lockDuration * 60 * 1000);
                // Update the specific email+ip record
                await this.FailedAttemptRepo.update({ email, ipAddress, type }, { lockedUntil: lockUntil });
                throw new common_1.HttpException(`Too many failed attempts. Account locked for ${lockDuration} minutes.`, common_1.HttpStatus.TOO_MANY_REQUESTS);
            }
        }
    }
    async recordFailedAttempt(email, ipAddress, type) {
        // Find existing attempt for this email+ip combination
        const attempt = await this.FailedAttemptRepo.findOne({
            where: { email, ipAddress, type },
        });
        // Update or create attempt record
        if (attempt) {
            await this.FailedAttemptRepo.update({ email, ipAddress, type }, {
                attempts: attempt.attempts + 1,
                lastAttempt: new Date(),
            });
        }
        else {
            const newAttempt = this.FailedAttemptRepo.create({
                email,
                ipAddress,
                type,
                attempts: 1,
                lastAttempt: new Date(),
            });
            await this.FailedAttemptRepo.save(newAttempt);
        }
    }
    async clearFailedAttempts(email, ipAddress, type) {
        const attempt = await this.FailedAttemptRepo.findOne({
            where: { email, ipAddress, type },
        });
        if (attempt) {
            await this.FailedAttemptRepo.update({ email, ipAddress, type }, {
                attempts: 0,
                lockedUntil: undefined,
                lastAttempt: new Date(),
            });
        }
    }
    async register_half(email, ipAddress) {
        // Check rate limit for verification codes
        await this.checkRateLimit(email, ipAddress, "verification");
        const user = await this.userRepository.findOne({ where: { email } });
        if (user) {
            throw new common_1.BadRequestException("انت لديك حساب انتقل الي صفحه تسجيل الدخول (login page)");
        }
        const ok = await this.VerficationRepo.findOne({ where: { email } });
        const { num, expiresAt } = (0, generation_1.generation)();
        const dto = {
            code: num,
            expiresAt: expiresAt,
        };
        await this.EmailService.Mailer(email, dto);
        const Verfication = {
            email,
            code: num,
            expiresAt,
        };
        if (!ok) {
            const createable = this.VerficationRepo.create(Verfication);
            await this.VerficationRepo.save(createable);
        }
        else {
            await this.VerficationRepo.update({ email }, { code: dto.code, expiresAt });
        }
        return response_dto_1.ApiResponse.success("Email sent!");
    }
    async register_full(email, code, ipAddress) {
        const ok = await this.VerficationRepo.findOne({ where: { email } });
        if (!ok) {
            throw new common_1.NotFoundException("Email:code not found");
        }
        if (new Date() > ok.expiresAt) {
            throw new common_1.BadRequestException("code is expired");
        }
        if (ok.code !== code) {
            // Record failed verification attempt
            await this.recordFailedAttempt(email, ipAddress, "verification");
            throw new common_1.BadRequestException("invalid code");
        }
        // Clear failed attempts on successful verification
        await this.clearFailedAttempts(email, ipAddress, "verification");
        await this.VerficationRepo.delete({ email });
        const user = this.userRepository.create({
            email: email,
            provider: "local",
            isVerified: false,
            googleId: undefined,
            role: "user",
        });
        await this.userRepository.save(user);
        const cart = this.CartRepo.create({ user: user });
        await this.CartRepo.save(cart);
        return response_dto_1.ApiResponse.success("Code verified successfully");
    }
    async register_complete(email, password) {
        const user = await this.userRepository.findOne({ where: { email } });
        if (!user) {
            throw new common_1.NotFoundException("user not found");
        }
        if (user.isVerified === true) {
            throw new common_1.BadRequestException("that's verified user");
        }
        const hashed_password = await bcrypt.hash(password, 10);
        const payload = {
            sub: user.id,
            username: user.email,
            role: user.role,
        };
        const envrefresh = String(this.configService.get("JWT_EXPIRES_REFRESHTOKEN"));
        const refresh_Token = this.jwtService.sign(payload, {
            expiresIn: envrefresh,
            issuer: "Protofolio",
        });
        const hashed_refersh_Token = await bcrypt.hash(refresh_Token, 10);
        await this.userRepository.update({ email }, {
            password: hashed_password,
            isVerified: true,
            refresh_Token: hashed_refersh_Token,
        });
        const access_token = this.jwtService.sign(payload, {
            issuer: "Protofolio",
        });
        return { access_token: access_token, refresh_Token: refresh_Token };
    }
    async login(email, password, ipAddress) {
        // Check rate limit for login attempts
        if (email && ipAddress) {
            await this.checkRateLimit(email, ipAddress, "login");
        }
        const user = await this.userRepository.findOne({ where: { email } });
        if (!user) {
            if (email && ipAddress)
                await this.recordFailedAttempt(email, ipAddress, "login");
            throw new common_1.NotFoundException("User not found");
        }
        const hashed_password = user.password;
        if (!hashed_password) {
            if (email && ipAddress)
                await this.recordFailedAttempt(email, ipAddress, "login");
            throw new common_1.NotFoundException("password not set");
        }
        if (!password) {
            if (email && ipAddress)
                await this.recordFailedAttempt(email, ipAddress, "login");
            throw new common_1.NotFoundException("write password");
        }
        if (user.isVerified === false) {
            throw new common_1.UnauthorizedException("blocked");
        }
        const ok = await bcrypt.compare(password, hashed_password);
        if (!ok) {
            if (email && ipAddress)
                await this.recordFailedAttempt(email, ipAddress, "login");
            throw new common_1.BadRequestException("password is wrong");
        }
        // Clear failed attempts on successful login
        if (email && ipAddress)
            await this.clearFailedAttempts(email, ipAddress, "login");
        const payload = {
            id: user.id,
            email: user.email,
        };
        const envrefresh = String(this.configService.get("JWT_EXPIRES_REFRESHTOKEN"));
        const refresh_Token = this.jwtService.sign(payload, {
            expiresIn: envrefresh,
            issuer: "Protofolio",
        });
        const hashed_refersh_Token = await bcrypt.hash(refresh_Token, 10);
        await this.userRepository.update({ email: user.email }, { refresh_Token: hashed_refersh_Token });
        const login_token = this.jwtService.sign(payload, { issuer: "Protofolio" });
        return { access_token: login_token, refresh_Token: refresh_Token };
    }
    // Password reset methods
    async requestPasswordReset(email) {
        const user = await this.userRepository.findOne({ where: { email } });
        if (!user) {
            throw new common_1.NotFoundException("User not found");
        }
        // Check if user has a password set
        if (!user.password) {
            throw new common_1.BadRequestException("Password not set for this account");
        }
        if (user.isVerified === false) {
            throw new common_1.UnauthorizedException("Blocked");
        }
        // Generate reset token
        const token = crypto.randomBytes(32).toString("hex");
        const expiresAt = new Date(Date.now() + 60 * 60 * 1000); // 1 hour
        // Delete any existing reset tokens for this email
        await this.PasswordResetRepo.delete({ email });
        // Create new reset token
        const passwordReset = this.PasswordResetRepo.create({
            email,
            token,
            expiresAt,
            used: false,
        });
        await this.PasswordResetRepo.save(passwordReset);
        // Send reset email
        const resetDto = {
            code: token,
            expiresAt: expiresAt,
        };
        await this.EmailService.sendPasswordResetEmail(email, resetDto);
        return response_dto_1.ApiResponse.success("Password reset email sent!");
    }
    async confirmPasswordReset(email, token, newPassword) {
        const resetRecord = await this.PasswordResetRepo.findOne({
            where: { email, token },
        });
        if (!resetRecord) {
            throw new common_1.NotFoundException("Invalid reset token");
        }
        if (resetRecord.used) {
            throw new common_1.BadRequestException("Reset token already used");
        }
        if (new Date() > resetRecord.expiresAt) {
            throw new common_1.BadRequestException("Reset token expired");
        }
        const user = await this.userRepository.findOne({ where: { email } });
        if (!user) {
            throw new common_1.NotFoundException("User not found");
        }
        // Hash new password
        const hashedPassword = await bcrypt.hash(newPassword, 10);
        // Update user password
        await this.userRepository.update({ email }, { password: hashedPassword });
        // Mark token as used
        await this.PasswordResetRepo.update({ email, token }, { used: true });
        return response_dto_1.ApiResponse.success("Password reset successful!");
    }
    // تحسين دالة log_out
    async log_out(email, refresh_Token) {
        if (!refresh_Token) {
            throw new common_1.BadRequestException("Refresh token is required");
        }
        // البحث عن المستخدم
        const user = await this.userRepository.findOne({ where: { email } });
        if (!user) {
            throw new common_1.NotFoundException("User not found");
        }
        // التحقق من أن الـ refresh token يطابق المخزن
        const isValidToken = user.refresh_Token
            ? await bcrypt.compare(refresh_Token, user.refresh_Token)
            : false;
        if (!isValidToken) {
            throw new common_1.UnauthorizedException("Invalid refresh token");
        }
        // إضافة الـ refresh token للقائمة السوداء
        await this.blacklistRepo.save({ token: refresh_Token });
        // مسح الـ refresh token من قاعدة البيانات
        await this.userRepository.update({ email }, { refresh_Token: null });
        return response_dto_1.ApiResponse.success("Logged out successfully");
    }
    async validateGoogleUser(profile) {
        if (!profile.emails || profile.emails.length === 0) {
            throw new common_1.BadRequestException("Email not found");
        }
        let user = await this.userRepository.findOne({
            where: { email: profile.emails[0].value },
        });
        if (!user) {
            user = this.userRepository.create({
                email: profile.emails[0].value,
                name: profile.displayName,
                Photo: profile.photos?.[0]?.value,
                googleId: profile.id,
                provider: "google",
                isVerified: true,
                role: "user",
            });
            await this.userRepository.save(user);
            const cart = this.CartRepo.create({ user });
            await this.CartRepo.save(cart);
        }
        else if (!user.googleId) {
            if (!user.isVerified) {
                throw new common_1.UnauthorizedException("Blocked");
            }
            await this.userRepository.update({ id: user.id }, {
                googleId: profile.id,
                provider: "google",
                isVerified: true,
                Photo: profile.photos?.[0]?.value,
                name: profile.displayName,
            });
        }
        // إنشاء payload وJWT
        const payload = {
            sub: user.id,
            username: user.email,
            role: user.role,
        };
        const token = this.jwtService.sign(payload, { issuer: "Protofolio" });
        const envrefresh = String(this.configService.get("JWT_EXPIRES_REFRESHTOKEN"));
        // إنشاء refresh token مشفر
        const refreshToken = this.jwtService.sign(payload, {
            expiresIn: envrefresh,
            issuer: "Protofolio",
        });
        const hashedRefreshToken = await bcrypt.hash(refreshToken, 10);
        await this.userRepository.update({ email: user.email }, { refresh_Token: hashedRefreshToken });
        return {
            user: {
                id: user.id,
                email: user.email,
                name: user.name,
                photo: user.Photo,
                role: user.role,
            },
            token,
            refresh_Token: refreshToken,
        };
    }
    async update_token(email, refreshToken) {
        // التحقق من صحة التوكن أولاً
        try {
            this.jwtService.verify(refreshToken, {
                issuer: "Protofolio",
            });
        }
        catch {
            throw new common_1.UnauthorizedException("Invalid or expired refresh token");
        }
        // التحقق من القائمة السوداء - باستخدام التوكن الأصلي (غير المشفر)
        const isBlacklisted = await this.blacklistRepo.findOne({
            where: { token: refreshToken },
        });
        if (isBlacklisted) {
            throw new common_1.UnauthorizedException("Refresh token has been revoked");
        }
        // البحث عن المستخدم
        const user = await this.userRepository.findOne({ where: { email } });
        if (!user) {
            throw new common_1.NotFoundException("User not found");
        }
        // التحقق من حالة المستخدم
        if (!user.isVerified) {
            throw new common_1.UnauthorizedException("User not verified");
        }
        // التحقق من وجود refresh token مخزن
        if (!user.refresh_Token) {
            throw new common_1.UnauthorizedException("No refresh token stored");
        }
        // تحقق من تطابق refresh token مع المخزن في قاعدة البيانات
        const isMatch = await bcrypt.compare(refreshToken, user.refresh_Token);
        if (!isMatch) {
            throw new common_1.UnauthorizedException("Refresh token mismatch");
        }
        // إنشاء tokens جديدة
        const newPayload = { sub: user.id, username: user.email, role: user.role };
        const access_token = this.jwtService.sign(newPayload, {
            issuer: "Protofolio",
            expiresIn: "15m",
        });
        // إبطال الـ refresh token القديم
        await this.blacklistRepo.save({ token: refreshToken });
        return {
            access_token,
        };
    }
};
exports.AuthService = AuthService;
exports.AuthService = AuthService = __decorate([
    (0, common_1.Injectable)(),
    __param(1, (0, typeorm_1.InjectRepository)(User_entity_1.User)),
    __param(2, (0, typeorm_1.InjectRepository)(Cart_entity_1.Cart)),
    __param(3, (0, typeorm_1.InjectRepository)(Verification_entity_1.Verification)),
    __param(4, (0, typeorm_1.InjectRepository)(FailedAttempt_entity_1.FailedAttempt)),
    __param(5, (0, typeorm_1.InjectRepository)(PasswordReset_entity_1.PasswordReset)),
    __param(6, (0, typeorm_1.InjectRepository)(BlackList_entity_1.RefreshTokenBlacklist)),
    __metadata("design:paramtypes", [typeof (_a = typeof jwt_1.JwtService !== "undefined" && jwt_1.JwtService) === "function" ? _a : Object, typeof (_b = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _b : Object, typeof (_c = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _c : Object, typeof (_d = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _d : Object, typeof (_e = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _e : Object, typeof (_f = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _f : Object, typeof (_g = typeof typeorm_2.Repository !== "undefined" && typeorm_2.Repository) === "function" ? _g : Object, typeof (_h = typeof Mailer_1.EmailService !== "undefined" && Mailer_1.EmailService) === "function" ? _h : Object, typeof (_j = typeof config_1.ConfigService !== "undefined" && config_1.ConfigService) === "function" ? _j : Object])
], AuthService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvb21hci9EZXNrdG9wL1Byb3RvZm9saW9fd2l0aG91dF9yZWRpcy9zcmMvYXV0aC9hdXRoLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQU93QjtBQUN4Qix5REFBK0M7QUFDL0MsNkNBQW1EO0FBQ25ELHFDQUFxQztBQUNyQyx5REFBK0M7QUFDL0MscUNBQXlDO0FBQ3pDLDZDQUEwQztBQUMxQyxxQ0FBd0M7QUFDeEMseUVBQStEO0FBQy9ELDJFQUFpRTtBQUNqRSwyRUFBaUU7QUFDakUsaURBQW1DO0FBQ25DLCtDQUFpQztBQUdqQyw2REFBeUQ7QUFDekQsbUVBQXFFO0FBQ3JFLDJDQUErQztBQUd4QyxJQUFNLFdBQVcsR0FBakIsTUFBTSxXQUFXO0lBRVo7SUFFUztJQUVBO0lBRUE7SUFFQTtJQUVBO0lBRUE7SUFDQTtJQUNBO0lBZm5CLFlBQ1UsVUFBc0IsRUFFYixjQUFnQyxFQUVoQyxRQUEwQixFQUUxQixlQUF5QyxFQUV6QyxpQkFBNEMsRUFFNUMsaUJBQTRDLEVBRTVDLGFBQWdELEVBQ2hELFlBQTBCLEVBQzFCLGFBQTRCO1FBZHJDLGVBQVUsR0FBVixVQUFVLENBQVk7UUFFYixtQkFBYyxHQUFkLGNBQWMsQ0FBa0I7UUFFaEMsYUFBUSxHQUFSLFFBQVEsQ0FBa0I7UUFFMUIsb0JBQWUsR0FBZixlQUFlLENBQTBCO1FBRXpDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBMkI7UUFFNUMsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUEyQjtRQUU1QyxrQkFBYSxHQUFiLGFBQWEsQ0FBbUM7UUFDaEQsaUJBQVksR0FBWixZQUFZLENBQWM7UUFDMUIsa0JBQWEsR0FBYixhQUFhLENBQWU7SUFDNUMsQ0FBQztJQUVKLCtCQUErQjtJQUN2QixLQUFLLENBQUMsY0FBYyxDQUMxQixLQUFhLEVBQ2IsU0FBaUIsRUFDakIsSUFBOEI7UUFFOUIsMERBQTBEO1FBQzFELE1BQU0sT0FBTyxH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RGVza3RvcC9Qcm90b2ZvbGlvX3dpdGhvdXRfcmVkaXMvc3JjL2F1dGgvYXV0aC5zZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEJhZFJlcXVlc3RFeGNlcHRpb24sXG4gIEluamVjdGFibGUsXG4gIE5vdEZvdW5kRXhjZXB0aW9uLFxuICBIdHRwRXhjZXB0aW9uLFxuICBIdHRwU3RhdHVzLFxuICBVbmF1dGhvcml6ZWRFeGNlcHRpb24sXG59IGZyb20gXCJAbmVzdGpzL2NvbW1vblwiO1xuaW1wb3J0IHsgVXNlciB9IGZyb20gXCIuLi9lbnRpdGllcy9Vc2VyLmVudGl0eVwiO1xuaW1wb3J0IHsgSW5qZWN0UmVwb3NpdG9yeSB9IGZyb20gXCJAbmVzdGpzL3R5cGVvcm1cIjtcbmltcG9ydCB7IFJlcG9zaXRvcnkgfSBmcm9tIFwidHlwZW9ybVwiO1xuaW1wb3J0IHsgQ2FydCB9IGZyb20gXCIuLi9lbnRpdGllcy9DYXJ0LmVudGl0eVwiO1xuaW1wb3J0IHsgSnd0U2VydmljZSB9IGZyb20gXCJAbmVzdGpzL2p3dFwiO1xuaW1wb3J0IHsgZ2VuZXJhdGlvbiB9IGZyb20gXCIuL2dlbmVyYXRpb25cIjtcbmltcG9ydCB7IEVtYWlsU2VydmljZSB9IGZyb20gXCIuL01haWxlclwiO1xuaW1wb3J0IHsgVmVyaWZpY2F0aW9uIH0gZnJvbSBcIi4uL2VudGl0aWVzL1ZlcmlmaWNhdGlvbi5lbnRpdHlcIjtcbmltcG9ydCB7IEZhaWxlZEF0dGVtcHQgfSBmcm9tIFwiLi4vZW50aXRpZXMvRmFpbGVkQXR0ZW1wdC5lbnRpdHlcIjtcbmltcG9ydCB7IFBhc3N3b3JkUmVzZXQgfSBmcm9tIFwiLi4vZW50aXRpZXMvUGFzc3dvcmRSZXNldC5lbnRpdHlcIjtcbmltcG9ydCAqIGFzIGJjcnlwdCBmcm9tIFwiYmNyeXB0anNcIjtcbmltcG9ydCAqIGFzIGNyeXB0byBmcm9tIFwiY3J5cHRvXCI7XG5pbXBvcnQgeyBHb29nbGVQcm9maWxlIH0gZnJvbSBcIi4vR29vZ2xlUHJvZmlsZVwiO1xuaW1wb3J0IHsgSnd0UGF5bG9hZCB9IGZyb20gXCIuL0p3dFBheWxvYWRcIjtcbmltcG9ydCB7IEFwaVJlc3BvbnNlIH0gZnJvbSBcIi4uL2NvbW1vbi9kdG8vcmVzcG9uc2UuZHRvXCI7XG5pbXBvcnQgeyBSZWZyZXNoVG9rZW5CbGFja2xpc3QgfSBmcm9tIFwiLi4vZW50aXRpZXMvQmxhY2tMaXN0LmVudGl0eVwiO1xuaW1wb3J0IHsgQ29uZmlnU2VydmljZSB9IGZyb20gXCJAbmVzdGpzL2NvbmZpZ1wiO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQXV0aFNlcnZpY2Uge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGp3dFNlcnZpY2U6IEp3dFNlcnZpY2UsXG4gICAgQEluamVjdFJlcG9zaXRvcnkoVXNlcilcbiAgICBwcml2YXRlIHJlYWRvbmx5IHVzZXJSZXBvc2l0b3J5OiBSZXBvc2l0b3J5PFVzZXI+LFxuICAgIEBJbmplY3RSZXBvc2l0b3J5KENhcnQpXG4gICAgcHJpdmF0ZSByZWFkb25seSBDYXJ0UmVwbzogUmVwb3NpdG9yeTxDYXJ0PixcbiAgICBASW5qZWN0UmVwb3NpdG9yeShWZXJpZmljYXRpb24pXG4gICAgcHJpdmF0ZSByZWFkb25seSBWZXJmaWNhdGlvblJlcG86IFJlcG9zaXRvcnk8VmVyaWZpY2F0aW9uPixcbiAgICBASW5qZWN0UmVwb3NpdG9yeShGYWlsZWRBdHRlbXB0KVxuICAgIHByaXZhdGUgcmVhZG9ubHkgRmFpbGVkQXR0ZW1wdFJlcG86IFJlcG9zaXRvcnk8RmFpbGVkQXR0ZW1wdD4sXG4gICAgQEluamVjdFJlcG9zaXRvcnkoUGFzc3dvcmRSZXNldClcbiAgICBwcml2YXRlIHJlYWRvbmx5IFBhc3N3b3JkUmVzZXRSZXBvOiBSZXBvc2l0b3J5PFBhc3N3b3JkUmVzZXQ+LFxuICAgIEBJbmplY3RSZXBvc2l0b3J5KFJlZnJlc2hUb2tlbkJsYWNrbGlzdClcbiAgICBwcml2YXRlIHJlYWRvbmx5IGJsYWNrbGlzdFJlcG86IFJlcG9zaXRvcnk8UmVmcmVzaFRva2VuQmxhY2tsaXN0PixcbiAgICBwcml2YXRlIHJlYWRvbmx5IEVtYWlsU2VydmljZTogRW1haWxTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgY29uZmlnU2VydmljZTogQ29uZmlnU2VydmljZSxcbiAgKSB7fVxuXG4gIC8vIFJhdGUgbGltaXRpbmcgaGVscGVyIG1ldGhvZHNcbiAgcHJpdmF0ZSBhc3luYyBjaGVja1JhdGVMaW1pdChcbiAgICBlbWFpbDogc3RyaW5nLFxuICAgIGlwQWRkcmVzczogc3RyaW5nLFxuICAgIHR5cGU6IFwibG9naW5cIiB8IFwidmVyaWZpY2F0aW9uXCIsXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIENoZWNrIHJhdGUgbGltaXQgZm9yIHRoaXMgc3BlY2lmaWMgZW1haWwraXAgY29tYmluYXRpb25cbiAgICBjb25zdCBhdHRlbXB0ID0gYXdhaXQgdGhpcy5GYWlsZWRBdHRlbXB0UmVwby5maW5kT25lKHtcbiAgICAgIHdoZXJlOiB7IGVtYWlsLCBpcEFkZHJlc3MsIHR5cGUgfSxcbiAgICB9KTtcblxuICAgIGlmIChhdHRlbXB0KSB7XG4gICAgICAvLyBDaGVjayBpZiBhY2NvdW50IGlzIGxvY2tlZFxuICAgICAgaWYgKGF0dGVtcHQubG9ja2VkVW50aWwgJiYgbmV3IERhdGUoKSA8IGF0dGVtcHQubG9ja2VkVW50aWwpIHtcbiAgICAgICAgY29uc3QgcmVtYWluaW5nVGltZSA9IE1hdGguY2VpbChcbiAgICAgICAgICAoYXR0ZW1wdC5sb2NrZWRVbnRpbC5nZXRUaW1lKCkgLSBEYXRlLm5vdygpKSAvIDYwMDAwLFxuICAgICAgICApO1xuICAgICAgICB0aHJvdyBuZXcgSHR0cEV4Y2VwdGlvbihcbiAgICAgICAgICBgQWNjb3VudCB0ZW1wb3JhcmlseSBsb2NrZWQuIFRyeSBhZ2FpbiBpbiAke3JlbWFpbmluZ1RpbWV9IG1pbnV0ZXMuYCxcbiAgICAgICAgICBIdHRwU3RhdHVzLlRPT19NQU5ZX1JFUVVFU1RTLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBhdHRlbXB0IGNvdW50XG4gICAgICBjb25zdCBtYXhBdHRlbXB0cyA9IHR5cGUgPT09IFwibG9naW5cIiA/IDUgOiAzO1xuICAgICAgY29uc3QgbG9ja0R1cmF0aW9uID0gdHlwZSA9PT0gXCJsb2dpblwiID8gMzAgOiAxNTsgLy8gbWludXRlc1xuXG4gICAgICBpZiAoYXR0ZW1wdC5hdHRlbXB0cyA+PSBtYXhBdHRlbXB0cykge1xuICAgICAgICBjb25zdCBsb2NrVW50aWwgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgbG9ja0R1cmF0aW9uICogNjAgKiAxMDAwKTtcbiAgICAgICAgLy8gVXBkYXRlIHRoZSBzcGVjaWZpYyBlbWFpbCtpcCByZWNvcmRcbiAgICAgICAgYXdhaXQgdGhpcy5GYWlsZWRBdHRlbXB0UmVwby51cGRhdGUoXG4gICAgICAgICAgeyBlbWFpbCwgaXBBZGRyZXNzLCB0eXBlIH0sXG4gICAgICAgICAgeyBsb2NrZWRVbnRpbDogbG9ja1VudGlsIH0sXG4gICAgICAgICk7XG4gICAgICAgIHRocm93IG5ldyBIdHRwRXhjZXB0aW9uKFxuICAgICAgICAgIGBUb28gbWFueSBmYWlsZWQgYXR0ZW1wdHMuIEFjY291bnQgbG9ja2VkIGZvciAke2xvY2tEdXJhdGlvbn0gbWludXRlcy5gLFxuICAgICAgICAgIEh0dHBTdGF0dXMuVE9PX01BTllfUkVRVUVTVFMsXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyByZWNvcmRGYWlsZWRBdHRlbXB0KFxuICAgIGVtYWlsOiBzdHJpbmcsXG4gICAgaXBBZGRyZXNzOiBzdHJpbmcsXG4gICAgdHlwZTogXCJsb2dpblwiIHwgXCJ2ZXJpZmljYXRpb25cIixcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gRmluZCBleGlzdGluZyBhdHRlbXB0IGZvciB0aGlzIGVtYWlsK2lwIGNvbWJpbmF0aW9uXG4gICAgY29uc3QgYXR0ZW1wdCA9IGF3YWl0IHRoaXMuRmFpbGVkQXR0ZW1wdFJlcG8uZmluZE9uZSh7XG4gICAgICB3aGVyZTogeyBlbWFpbCwgaXBBZGRyZXNzLCB0eXBlIH0sXG4gICAgfSk7XG5cbiAgICAvLyBVcGRhdGUgb3IgY3JlYXRlIGF0dGVtcHQgcmVjb3JkXG4gICAgaWYgKGF0dGVtcHQpIHtcbiAgICAgIGF3YWl0IHRoaXMuRmFpbGVkQXR0ZW1wdFJlcG8udXBkYXRlKFxuICAgICAgICB7IGVtYWlsLCBpcEFkZHJlc3MsIHR5cGUgfSxcbiAgICAgICAge1xuICAgICAgICAgIGF0dGVtcHRzOiBhdHRlbXB0LmF0dGVtcHRzICsgMSxcbiAgICAgICAgICBsYXN0QXR0ZW1wdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG5ld0F0dGVtcHQgPSB0aGlzLkZhaWxlZEF0dGVtcHRSZXBvLmNyZWF0ZSh7XG4gICAgICAgIGVtYWlsLFxuICAgICAgICBpcEFkZHJlc3MsXG4gICAgICAgIHR5cGUsXG4gICAgICAgIGF0dGVtcHRzOiAxLFxuICAgICAgICBsYXN0QXR0ZW1wdDogbmV3IERhdGUoKSxcbiAgICAgIH0pO1xuICAgICAgYXdhaXQgdGhpcy5GYWlsZWRBdHRlbXB0UmVwby5zYXZlKG5ld0F0dGVtcHQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY2xlYXJGYWlsZWRBdHRlbXB0cyhcbiAgICBlbWFpbDogc3RyaW5nLFxuICAgIGlwQWRkcmVzczogc3RyaW5nLFxuICAgIHR5cGU6IFwibG9naW5cIiB8IFwidmVyaWZpY2F0aW9uXCIsXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGF0dGVtcHQgPSBhd2FpdCB0aGlzLkZhaWxlZEF0dGVtcHRSZXBvLmZpbmRPbmUoe1xuICAgICAgd2hlcmU6IHsgZW1haWwsIGlwQWRkcmVzcywgdHlwZSB9LFxuICAgIH0pO1xuXG4gICAgaWYgKGF0dGVtcHQpIHtcbiAgICAgIGF3YWl0IHRoaXMuRmFpbGVkQXR0ZW1wdFJlcG8udXBkYXRlKFxuICAgICAgICB7IGVtYWlsLCBpcEFkZHJlc3MsIHR5cGUgfSxcbiAgICAgICAge1xuICAgICAgICAgIGF0dGVtcHRzOiAwLFxuICAgICAgICAgIGxvY2tlZFVudGlsOiB1bmRlZmluZWQsXG4gICAgICAgICAgbGFzdEF0dGVtcHQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHJlZ2lzdGVyX2hhbGYoZW1haWw6IHN0cmluZywgaXBBZGRyZXNzOiBzdHJpbmcpIHtcbiAgICAvLyBDaGVjayByYXRlIGxpbWl0IGZvciB2ZXJpZmljYXRpb24gY29kZXNcbiAgICBhd2FpdCB0aGlzLmNoZWNrUmF0ZUxpbWl0KGVtYWlsLCBpcEFkZHJlc3MsIFwidmVyaWZpY2F0aW9uXCIpO1xuXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMudXNlclJlcG9zaXRvcnkuZmluZE9uZSh7IHdoZXJlOiB7IGVtYWlsIH0gfSk7XG4gICAgaWYgKHVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKFxuICAgICAgICBcItin2YbYqiDZhNiv2YrZgyDYrdiz2KfYqCDYp9mG2KrZgtmEINin2YTZiiDYtdmB2K3ZhyDYqtiz2KzZitmEINin2YTYr9iu2YjZhCAobG9naW4gcGFnZSlcIixcbiAgICAgICk7XG4gICAgfVxuICAgIGNvbnN0IG9rID0gYXdhaXQgdGhpcy5WZXJmaWNhdGlvblJlcG8uZmluZE9uZSh7IHdoZXJlOiB7IGVtYWlsIH0gfSk7XG5cbiAgICBjb25zdCB7IG51bSwgZXhwaXJlc0F0IH0gPSBnZW5lcmF0aW9uKCk7XG4gICAgY29uc3QgZHRvID0ge1xuICAgICAgY29kZTogbnVtLFxuICAgICAgZXhwaXJlc0F0OiBleHBpcmVzQXQsXG4gICAgfTtcbiAgICBhd2FpdCB0aGlzLkVtYWlsU2VydmljZS5NYWlsZXIoZW1haWwsIGR0byk7XG4gICAgY29uc3QgVmVyZmljYXRpb24gPSB7XG4gICAgICBlbWFpbCxcbiAgICAgIGNvZGU6IG51bSxcbiAgICAgIGV4cGlyZXNBdCxcbiAgICB9O1xuICAgIGlmICghb2spIHtcbiAgICAgIGNvbnN0IGNyZWF0ZWFibGUgPSB0aGlzLlZlcmZpY2F0aW9uUmVwby5jcmVhdGUoVmVyZmljYXRpb24pO1xuICAgICAgYXdhaXQgdGhpcy5WZXJmaWNhdGlvblJlcG8uc2F2ZShjcmVhdGVhYmxlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgdGhpcy5WZXJmaWNhdGlvblJlcG8udXBkYXRlKFxuICAgICAgICB7IGVtYWlsIH0sXG4gICAgICAgIHsgY29kZTogZHRvLmNvZGUsIGV4cGlyZXNBdCB9LFxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gQXBpUmVzcG9uc2Uuc3VjY2VzcyhcIkVtYWlsIHNlbnQhXCIpO1xuICB9XG4gIGFzeW5jIHJlZ2lzdGVyX2Z1bGwoZW1haWw6IHN0cmluZywgY29kZTogc3RyaW5nLCBpcEFkZHJlc3M6IHN0cmluZykge1xuICAgIGNvbnN0IG9rID0gYXdhaXQgdGhpcy5WZXJmaWNhdGlvblJlcG8uZmluZE9uZSh7IHdoZXJlOiB7IGVtYWlsIH0gfSk7XG4gICAgaWYgKCFvaykge1xuICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKFwiRW1haWw6Y29kZSBub3QgZm91bmRcIik7XG4gICAgfVxuICAgIGlmIChuZXcgRGF0ZSgpID4gb2suZXhwaXJlc0F0KSB7XG4gICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbihcImNvZGUgaXMgZXhwaXJlZFwiKTtcbiAgICB9XG4gICAgaWYgKG9rLmNvZGUgIT09IGNvZGUpIHtcbiAgICAgIC8vIFJlY29yZCBmYWlsZWQgdmVyaWZpY2F0aW9uIGF0dGVtcHRcbiAgICAgIGF3YWl0IHRoaXMucmVjb3JkRmFpbGVkQXR0ZW1wdChlbWFpbCwgaXBBZGRyZXNzLCBcInZlcmlmaWNhdGlvblwiKTtcbiAgICAgIHRocm93IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKFwiaW52YWxpZCBjb2RlXCIpO1xuICAgIH1cblxuICAgIC8vIENsZWFyIGZhaWxlZCBhdHRlbXB0cyBvbiBzdWNjZXNzZnVsIHZlcmlmaWNhdGlvblxuICAgIGF3YWl0IHRoaXMuY2xlYXJGYWlsZWRBdHRlbXB0cyhlbWFpbCwgaXBBZGRyZXNzLCBcInZlcmlmaWNhdGlvblwiKTtcbiAgICBhd2FpdCB0aGlzLlZlcmZpY2F0aW9uUmVwby5kZWxldGUoeyBlbWFpbCB9KTtcblxuICAgIGNvbnN0IHVzZXIgPSB0aGlzLnVzZXJSZXBvc2l0b3J5LmNyZWF0ZSh7XG4gICAgICBlbWFpbDogZW1haWwsXG4gICAgICBwcm92aWRlcjogXCJsb2NhbFwiLFxuICAgICAgaXNWZXJpZmllZDogZmFsc2UsXG4gICAgICBnb29nbGVJZDogdW5kZWZpbmVkLFxuICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgfSk7XG4gICAgYXdhaXQgdGhpcy51c2VyUmVwb3NpdG9yeS5zYXZlKHVzZXIpO1xuICAgIGNvbnN0IGNhcnQgPSB0aGlzLkNhcnRSZXBvLmNyZWF0ZSh7IHVzZXI6IHVzZXIgfSk7XG4gICAgYXdhaXQgdGhpcy5DYXJ0UmVwby5zYXZlKGNhcnQpO1xuICAgIHJldHVybiBBcGlSZXNwb25zZS5zdWNjZXNzKFwiQ29kZSB2ZXJpZmllZCBzdWNjZXNzZnVsbHlcIik7XG4gIH1cbiAgYXN5bmMgcmVnaXN0ZXJfY29tcGxldGUoZW1haWw6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZykge1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LmZpbmRPbmUoeyB3aGVyZTogeyBlbWFpbCB9IH0pO1xuICAgIGlmICghdXNlcikge1xuICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKFwidXNlciBub3QgZm91bmRcIik7XG4gICAgfVxuICAgIGlmICh1c2VyLmlzVmVyaWZpZWQgPT09IHRydWUpIHtcbiAgICAgIHRocm93IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKFwidGhhdCdzIHZlcmlmaWVkIHVzZXJcIik7XG4gICAgfVxuXG4gICAgY29uc3QgaGFzaGVkX3Bhc3N3b3JkID0gYXdhaXQgYmNyeXB0Lmhhc2gocGFzc3dvcmQsIDEwKTtcblxuICAgIGNvbnN0IHBheWxvYWQ6IEp3dFBheWxvYWQgPSB7XG4gICAgICBzdWI6IHVzZXIuaWQsXG4gICAgICB1c2VybmFtZTogdXNlci5lbWFpbCxcbiAgICAgIHJvbGU6IHVzZXIucm9sZSxcbiAgICB9O1xuICAgIGNvbnN0IGVudnJlZnJlc2ggPSBTdHJpbmcoXG4gICAgICB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0PHN0cmluZz4oXCJKV1RfRVhQSVJFU19SRUZSRVNIVE9LRU5cIiksXG4gICAgKTtcbiAgICBjb25zdCByZWZyZXNoX1Rva2VuID0gdGhpcy5qd3RTZXJ2aWNlLnNpZ24ocGF5bG9hZCwge1xuICAgICAgZXhwaXJlc0luOiBlbnZyZWZyZXNoLFxuICAgICAgaXNzdWVyOiBcIlByb3RvZm9saW9cIixcbiAgICB9KTtcbiAgICBjb25zdCBoYXNoZWRfcmVmZXJzaF9Ub2tlbiA9IGF3YWl0IGJjcnlwdC5oYXNoKHJlZnJlc2hfVG9rZW4sIDEwKTtcbiAgICBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LnVwZGF0ZShcbiAgICAgIHsgZW1haWwgfSxcbiAgICAgIHtcbiAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZF9wYXNzd29yZCxcbiAgICAgICAgaXNWZXJpZmllZDogdHJ1ZSxcbiAgICAgICAgcmVmcmVzaF9Ub2tlbjogaGFzaGVkX3JlZmVyc2hfVG9rZW4sXG4gICAgICB9LFxuICAgICk7XG4gICAgY29uc3QgYWNjZXNzX3Rva2VuID0gdGhpcy5qd3RTZXJ2aWNlLnNpZ24ocGF5bG9hZCwge1xuICAgICAgaXNzdWVyOiBcIlByb3RvZm9saW9cIixcbiAgICB9KTtcbiAgICByZXR1cm4geyBhY2Nlc3NfdG9rZW46IGFjY2Vzc190b2tlbiwgcmVmcmVzaF9Ub2tlbjogcmVmcmVzaF9Ub2tlbiB9O1xuICB9XG5cbiAgYXN5bmMgbG9naW4oZW1haWw/OiBzdHJpbmcsIHBhc3N3b3JkPzogc3RyaW5nLCBpcEFkZHJlc3M/OiBzdHJpbmcpIHtcbiAgICAvLyBDaGVjayByYXRlIGxpbWl0IGZvciBsb2dpbiBhdHRlbXB0c1xuICAgIGlmIChlbWFpbCAmJiBpcEFkZHJlc3MpIHtcbiAgICAgIGF3YWl0IHRoaXMuY2hlY2tSYXRlTGltaXQoZW1haWwsIGlwQWRkcmVzcywgXCJsb2dpblwiKTtcbiAgICB9XG5cbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy51c2VyUmVwb3NpdG9yeS5maW5kT25lKHsgd2hlcmU6IHsgZW1haWwgfSB9KTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIGlmIChlbWFpbCAmJiBpcEFkZHJlc3MpXG4gICAgICAgIGF3YWl0IHRoaXMucmVjb3JkRmFpbGVkQXR0ZW1wdChlbWFpbCwgaXBBZGRyZXNzLCBcImxvZ2luXCIpO1xuICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKFwiVXNlciBub3QgZm91bmRcIik7XG4gICAgfVxuICAgIGNvbnN0IGhhc2hlZF9wYXNzd29yZCA9IHVzZXIucGFzc3dvcmQ7XG4gICAgaWYgKCFoYXNoZWRfcGFzc3dvcmQpIHtcbiAgICAgIGlmIChlbWFpbCAmJiBpcEFkZHJlc3MpXG4gICAgICAgIGF3YWl0IHRoaXMucmVjb3JkRmFpbGVkQXR0ZW1wdChlbWFpbCwgaXBBZGRyZXNzLCBcImxvZ2luXCIpO1xuICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKFwicGFzc3dvcmQgbm90IHNldFwiKTtcbiAgICB9XG4gICAgaWYgKCFwYXNzd29yZCkge1xuICAgICAgaWYgKGVtYWlsICYmIGlwQWRkcmVzcylcbiAgICAgICAgYXdhaXQgdGhpcy5yZWNvcmRGYWlsZWRBdHRlbXB0KGVtYWlsLCBpcEFkZHJlc3MsIFwibG9naW5cIik7XG4gICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oXCJ3cml0ZSBwYXNzd29yZFwiKTtcbiAgICB9XG4gICAgaWYgKHVzZXIuaXNWZXJpZmllZCA9PT0gZmFsc2UpIHtcbiAgICAgIHRocm93IG5ldyBVbmF1dGhvcml6ZWRFeGNlcHRpb24oXCJibG9ja2VkXCIpO1xuICAgIH1cbiAgICBjb25zdCBvayA9IGF3YWl0IGJjcnlwdC5jb21wYXJlKHBhc3N3b3JkLCBoYXNoZWRfcGFzc3dvcmQpO1xuICAgIGlmICghb2spIHtcbiAgICAgIGlmIChlbWFpbCAmJiBpcEFkZHJlc3MpXG4gICAgICAgIGF3YWl0IHRoaXMucmVjb3JkRmFpbGVkQXR0ZW1wdChlbWFpbCwgaXBBZGRyZXNzLCBcImxvZ2luXCIpO1xuICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oXCJwYXNzd29yZCBpcyB3cm9uZ1wiKTtcbiAgICB9XG5cbiAgICAvLyBDbGVhciBmYWlsZWQgYXR0ZW1wdHMgb24gc3VjY2Vzc2Z1bCBsb2dpblxuICAgIGlmIChlbWFpbCAmJiBpcEFkZHJlc3MpXG4gICAgICBhd2FpdCB0aGlzLmNsZWFyRmFpbGVkQXR0ZW1wdHMoZW1haWwsIGlwQWRkcmVzcywgXCJsb2dpblwiKTtcblxuICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICBpZDogdXNlci5pZCxcbiAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgIH07XG4gICAgY29uc3QgZW52cmVmcmVzaCA9IFN0cmluZyhcbiAgICAgIHRoaXMuY29uZmlnU2VydmljZS5nZXQ8c3RyaW5nPihcIkpXVF9FWFBJUkVTX1JFRlJFU0hUT0tFTlwiKSxcbiAgICApO1xuICAgIGNvbnN0IHJlZnJlc2hfVG9rZW4gPSB0aGlzLmp3dFNlcnZpY2Uuc2lnbihwYXlsb2FkLCB7XG4gICAgICBleHBpcmVzSW46IGVudnJlZnJlc2gsXG4gICAgICBpc3N1ZXI6IFwiUHJvdG9mb2xpb1wiLFxuICAgIH0pO1xuICAgIGNvbnN0IGhhc2hlZF9yZWZlcnNoX1Rva2VuID0gYXdhaXQgYmNyeXB0Lmhhc2gocmVmcmVzaF9Ub2tlbiwgMTApO1xuICAgIGF3YWl0IHRoaXMudXNlclJlcG9zaXRvcnkudXBkYXRlKFxuICAgICAgeyBlbWFpbDogdXNlci5lbWFpbCB9LFxuICAgICAgeyByZWZyZXNoX1Rva2VuOiBoYXNoZWRfcmVmZXJzaF9Ub2tlbiB9LFxuICAgICk7XG4gICAgY29uc3QgbG9naW5fdG9rZW4gPSB0aGlzLmp3dFNlcnZpY2Uuc2lnbihwYXlsb2FkLCB7IGlzc3VlcjogXCJQcm90b2ZvbGlvXCIgfSk7XG4gICAgcmV0dXJuIHsgYWNjZXNzX3Rva2VuOiBsb2dpbl90b2tlbiwgcmVmcmVzaF9Ub2tlbjogcmVmcmVzaF9Ub2tlbiB9O1xuICB9XG4gIC8vIFBhc3N3b3JkIHJlc2V0IG1ldGhvZHNcbiAgYXN5bmMgcmVxdWVzdFBhc3N3b3JkUmVzZXQoZW1haWw6IHN0cmluZykge1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LmZpbmRPbmUoeyB3aGVyZTogeyBlbWFpbCB9IH0pO1xuICAgIGlmICghdXNlcikge1xuICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKFwiVXNlciBub3QgZm91bmRcIik7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBoYXMgYSBwYXNzd29yZCBzZXRcbiAgICBpZiAoIXVzZXIucGFzc3dvcmQpIHtcbiAgICAgIHRocm93IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKFwiUGFzc3dvcmQgbm90IHNldCBmb3IgdGhpcyBhY2NvdW50XCIpO1xuICAgIH1cbiAgICBpZiAodXNlci5pc1ZlcmlmaWVkID09PSBmYWxzZSkge1xuICAgICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZEV4Y2VwdGlvbihcIkJsb2NrZWRcIik7XG4gICAgfVxuXG4gICAgLy8gR2VuZXJhdGUgcmVzZXQgdG9rZW5cbiAgICBjb25zdCB0b2tlbiA9IGNyeXB0by5yYW5kb21CeXRlcygzMikudG9TdHJpbmcoXCJoZXhcIik7XG4gICAgY29uc3QgZXhwaXJlc0F0ID0gbmV3IERhdGUoRGF0ZS5ub3coKSArIDYwICogNjAgKiAxMDAwKTsgLy8gMSBob3VyXG5cbiAgICAvLyBEZWxldGUgYW55IGV4aXN0aW5nIHJlc2V0IHRva2VucyBmb3IgdGhpcyBlbWFpbFxuICAgIGF3YWl0IHRoaXMuUGFzc3dvcmRSZXNldFJlcG8uZGVsZXRlKHsgZW1haWwgfSk7XG5cbiAgICAvLyBDcmVhdGUgbmV3IHJlc2V0IHRva2VuXG4gICAgY29uc3QgcGFzc3dvcmRSZXNldCA9IHRoaXMuUGFzc3dvcmRSZXNldFJlcG8uY3JlYXRlKHtcbiAgICAgIGVtYWlsLFxuICAgICAgdG9rZW4sXG4gICAgICBleHBpcmVzQXQsXG4gICAgICB1c2VkOiBmYWxzZSxcbiAgICB9KTtcbiAgICBhd2FpdCB0aGlzLlBhc3N3b3JkUmVzZXRSZXBvLnNhdmUocGFzc3dvcmRSZXNldCk7XG5cbiAgICAvLyBTZW5kIHJlc2V0IGVtYWlsXG4gICAgY29uc3QgcmVzZXREdG8gPSB7XG4gICAgICBjb2RlOiB0b2tlbixcbiAgICAgIGV4cGlyZXNBdDogZXhwaXJlc0F0LFxuICAgIH07XG4gICAgYXdhaXQgdGhpcy5FbWFpbFNlcnZpY2Uuc2VuZFBhc3N3b3JkUmVzZXRFbWFpbChlbWFpbCwgcmVzZXREdG8pO1xuXG4gICAgcmV0dXJuIEFwaVJlc3BvbnNlLnN1Y2Nlc3MoXCJQYXNzd29yZCByZXNldCBlbWFpbCBzZW50IVwiKTtcbiAgfVxuXG4gIGFzeW5jIGNvbmZpcm1QYXNzd29yZFJlc2V0KFxuICAgIGVtYWlsOiBzdHJpbmcsXG4gICAgdG9rZW46IHN0cmluZyxcbiAgICBuZXdQYXNzd29yZDogc3RyaW5nLFxuICApIHtcbiAgICBjb25zdCByZXNldFJlY29yZCA9IGF3YWl0IHRoaXMuUGFzc3dvcmRSZXNldFJlcG8uZmluZE9uZSh7XG4gICAgICB3aGVyZTogeyBlbWFpbCwgdG9rZW4gfSxcbiAgICB9KTtcblxuICAgIGlmICghcmVzZXRSZWNvcmQpIHtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbihcIkludmFsaWQgcmVzZXQgdG9rZW5cIik7XG4gICAgfVxuXG4gICAgaWYgKHJlc2V0UmVjb3JkLnVzZWQpIHtcbiAgICAgIHRocm93IG5ldyBCYWRSZXF1ZXN0RXhjZXB0aW9uKFwiUmVzZXQgdG9rZW4gYWxyZWFkeSB1c2VkXCIpO1xuICAgIH1cblxuICAgIGlmIChuZXcgRGF0ZSgpID4gcmVzZXRSZWNvcmQuZXhwaXJlc0F0KSB7XG4gICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbihcIlJlc2V0IHRva2VuIGV4cGlyZWRcIik7XG4gICAgfVxuXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMudXNlclJlcG9zaXRvcnkuZmluZE9uZSh7IHdoZXJlOiB7IGVtYWlsIH0gfSk7XG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb24oXCJVc2VyIG5vdCBmb3VuZFwiKTtcbiAgICB9XG5cbiAgICAvLyBIYXNoIG5ldyBwYXNzd29yZFxuICAgIGNvbnN0IGhhc2hlZFBhc3N3b3JkID0gYXdhaXQgYmNyeXB0Lmhhc2gobmV3UGFzc3dvcmQsIDEwKTtcblxuICAgIC8vIFVwZGF0ZSB1c2VyIHBhc3N3b3JkXG4gICAgYXdhaXQgdGhpcy51c2VyUmVwb3NpdG9yeS51cGRhdGUoeyBlbWFpbCB9LCB7IHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCB9KTtcblxuICAgIC8vIE1hcmsgdG9rZW4gYXMgdXNlZFxuICAgIGF3YWl0IHRoaXMuUGFzc3dvcmRSZXNldFJlcG8udXBkYXRlKHsgZW1haWwsIHRva2VuIH0sIHsgdXNlZDogdHJ1ZSB9KTtcblxuICAgIHJldHVybiBBcGlSZXNwb25zZS5zdWNjZXNzKFwiUGFzc3dvcmQgcmVzZXQgc3VjY2Vzc2Z1bCFcIik7XG4gIH1cbiAgLy8g2KrYrdiz2YrZhiDYr9in2YTYqSBsb2dfb3V0XG4gIGFzeW5jIGxvZ19vdXQoZW1haWw6IHN0cmluZywgcmVmcmVzaF9Ub2tlbjogc3RyaW5nKSB7XG4gICAgaWYgKCFyZWZyZXNoX1Rva2VuKSB7XG4gICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbihcIlJlZnJlc2ggdG9rZW4gaXMgcmVxdWlyZWRcIik7XG4gICAgfVxuXG4gICAgLy8g2KfZhNio2K3YqyDYudmGINin2YTZhdiz2KrYrtiv2YVcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy51c2VyUmVwb3NpdG9yeS5maW5kT25lKHsgd2hlcmU6IHsgZW1haWwgfSB9KTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbihcIlVzZXIgbm90IGZvdW5kXCIpO1xuICAgIH1cbiAgICAvLyDYp9mE2KrYrdmC2YIg2YXZhiDYo9mGINin2YTZgCByZWZyZXNoIHRva2VuINmK2LfYp9io2YIg2KfZhNmF2K7YstmGXG4gICAgY29uc3QgaXNWYWxpZFRva2VuID0gdXNlci5yZWZyZXNoX1Rva2VuXG4gICAgICA/IGF3YWl0IGJjcnlwdC5jb21wYXJlKHJlZnJlc2hfVG9rZW4sIHVzZXIucmVmcmVzaF9Ub2tlbilcbiAgICAgIDogZmFsc2U7XG4gICAgaWYgKCFpc1ZhbGlkVG9rZW4pIHtcbiAgICAgIHRocm93IG5ldyBVbmF1dGhvcml6ZWRFeGNlcHRpb24oXCJJbnZhbGlkIHJlZnJlc2ggdG9rZW5cIik7XG4gICAgfVxuXG4gICAgLy8g2KXYttin2YHYqSDYp9mE2YAgcmVmcmVzaCB0b2tlbiDZhNmE2YLYp9im2YXYqSDYp9mE2LPZiNiv2KfYoVxuICAgIGF3YWl0IHRoaXMuYmxhY2tsaXN0UmVwby5zYXZlKHsgdG9rZW46IHJlZnJlc2hfVG9rZW4gfSk7XG5cbiAgICAvLyDZhdiz2K0g2KfZhNmAIHJlZnJlc2ggdG9rZW4g2YXZhiDZgtin2LnYr9ipINin2YTYqNmK2KfZhtin2KpcbiAgICBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LnVwZGF0ZSh7IGVtYWlsIH0sIHsgcmVmcmVzaF9Ub2tlbjogbnVsbCB9KTtcblxuICAgIHJldHVybiBBcGlSZXNwb25zZS5zdWNjZXNzKFwiTG9nZ2VkIG91dCBzdWNjZXNzZnVsbHlcIik7XG4gIH1cblxuICBhc3luYyB2YWxpZGF0ZUdvb2dsZVVzZXIocHJvZmlsZTogR29vZ2xlUHJvZmlsZSkge1xuICAgIGlmICghcHJvZmlsZS5lbWFpbHMgfHwgcHJvZmlsZS5lbWFpbHMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbihcIkVtYWlsIG5vdCBmb3VuZFwiKTtcbiAgICB9XG5cbiAgICBsZXQgdXNlciA9IGF3YWl0IHRoaXMudXNlclJlcG9zaXRvcnkuZmluZE9uZSh7XG4gICAgICB3aGVyZTogeyBlbWFpbDogcHJvZmlsZS5lbWFpbHNbMF0udmFsdWUgfSxcbiAgICB9KTtcblxuICAgIGlmICghdXNlcikge1xuICAgICAgdXNlciA9IHRoaXMudXNlclJlcG9zaXRvcnkuY3JlYXRlKHtcbiAgICAgICAgZW1haWw6IHByb2ZpbGUuZW1haWxzWzBdLnZhbHVlLFxuICAgICAgICBuYW1lOiBwcm9maWxlLmRpc3BsYXlOYW1lLFxuICAgICAgICBQaG90bzogcHJvZmlsZS5waG90b3M/LlswXT8udmFsdWUsXG4gICAgICAgIGdvb2dsZUlkOiBwcm9maWxlLmlkLFxuICAgICAgICBwcm92aWRlcjogXCJnb29nbGVcIixcbiAgICAgICAgaXNWZXJpZmllZDogdHJ1ZSxcbiAgICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICB9KTtcbiAgICAgIGF3YWl0IHRoaXMudXNlclJlcG9zaXRvcnkuc2F2ZSh1c2VyKTtcblxuICAgICAgY29uc3QgY2FydCA9IHRoaXMuQ2FydFJlcG8uY3JlYXRlKHsgdXNlciB9KTtcbiAgICAgIGF3YWl0IHRoaXMuQ2FydFJlcG8uc2F2ZShjYXJ0KTtcbiAgICB9IGVsc2UgaWYgKCF1c2VyLmdvb2dsZUlkKSB7XG4gICAgICBpZiAoIXVzZXIuaXNWZXJpZmllZCkge1xuICAgICAgICB0aHJvdyBuZXcgVW5hdXRob3JpemVkRXhjZXB0aW9uKFwiQmxvY2tlZFwiKTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHRoaXMudXNlclJlcG9zaXRvcnkudXBkYXRlKFxuICAgICAgICB7IGlkOiB1c2VyLmlkIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBnb29nbGVJZDogcHJvZmlsZS5pZCxcbiAgICAgICAgICBwcm92aWRlcjogXCJnb29nbGVcIixcbiAgICAgICAgICBpc1ZlcmlmaWVkOiB0cnVlLFxuICAgICAgICAgIFBob3RvOiBwcm9maWxlLnBob3Rvcz8uWzBdPy52YWx1ZSxcbiAgICAgICAgICBuYW1lOiBwcm9maWxlLmRpc3BsYXlOYW1lLFxuICAgICAgICB9LFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyDYpdmG2LTYp9ihIHBheWxvYWQg2YhKV1RcbiAgICBjb25zdCBwYXlsb2FkOiBKd3RQYXlsb2FkID0ge1xuICAgICAgc3ViOiB1c2VyLmlkLFxuICAgICAgdXNlcm5hbWU6IHVzZXIuZW1haWwsXG4gICAgICByb2xlOiB1c2VyLnJvbGUsXG4gICAgfTtcbiAgICBjb25zdCB0b2tlbiA9IHRoaXMuand0U2VydmljZS5zaWduKHBheWxvYWQsIHsgaXNzdWVyOiBcIlByb3RvZm9saW9cIiB9KTtcblxuICAgIGNvbnN0IGVudnJlZnJlc2ggPSBTdHJpbmcoXG4gICAgICB0aGlzLmNvbmZpZ1NlcnZpY2UuZ2V0PHN0cmluZz4oXCJKV1RfRVhQSVJFU19SRUZSRVNIVE9LRU5cIiksXG4gICAgKTtcbiAgICAvLyDYpdmG2LTYp9ihIHJlZnJlc2ggdG9rZW4g2YXYtNmB2LFcbiAgICBjb25zdCByZWZyZXNoVG9rZW4gPSB0aGlzLmp3dFNlcnZpY2Uuc2lnbihwYXlsb2FkLCB7XG4gICAgICBleHBpcmVzSW46IGVudnJlZnJlc2gsXG4gICAgICBpc3N1ZXI6IFwiUHJvdG9mb2xpb1wiLFxuICAgIH0pO1xuICAgIGNvbnN0IGhhc2hlZFJlZnJlc2hUb2tlbiA9IGF3YWl0IGJjcnlwdC5oYXNoKHJlZnJlc2hUb2tlbiwgMTApO1xuICAgIGF3YWl0IHRoaXMudXNlclJlcG9zaXRvcnkudXBkYXRlKFxuICAgICAgeyBlbWFpbDogdXNlci5lbWFpbCB9LFxuICAgICAgeyByZWZyZXNoX1Rva2VuOiBoYXNoZWRSZWZyZXNoVG9rZW4gfSxcbiAgICApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHVzZXI6IHtcbiAgICAgICAgaWQ6IHVzZXIuaWQsXG4gICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgICBuYW1lOiB1c2VyLm5hbWUsXG4gICAgICAgIHBob3RvOiB1c2VyLlBob3RvLFxuICAgICAgICByb2xlOiB1c2VyLnJvbGUsXG4gICAgICB9LFxuICAgICAgdG9rZW4sXG4gICAgICByZWZyZXNoX1Rva2VuOiByZWZyZXNoVG9rZW4sXG4gICAgfTtcbiAgfVxuICBhc3luYyB1cGRhdGVfdG9rZW4oXG4gICAgZW1haWw6IHN0cmluZyxcbiAgICByZWZyZXNoVG9rZW46IHN0cmluZyxcbiAgKTogUHJvbWlzZTx7IGFjY2Vzc190b2tlbjogc3RyaW5nIH0+IHtcbiAgICAvLyDYp9mE2KrYrdmC2YIg2YXZhiDYtdit2Kkg2KfZhNiq2YjZg9mGINij2YjZhNin2YtcblxuICAgIHRyeSB7XG4gICAgICB0aGlzLmp3dFNlcnZpY2UudmVyaWZ5KHJlZnJlc2hUb2tlbiwge1xuICAgICAgICBpc3N1ZXI6IFwiUHJvdG9mb2xpb1wiLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCB7XG4gICAgICB0aHJvdyBuZXcgVW5hdXRob3JpemVkRXhjZXB0aW9uKFwiSW52YWxpZCBvciBleHBpcmVkIHJlZnJlc2ggdG9rZW5cIik7XG4gICAgfVxuXG4gICAgLy8g2KfZhNiq2K3ZgtmCINmF2YYg2KfZhNmC2KfYptmF2Kkg2KfZhNiz2YjYr9in2KEgLSDYqNin2LPYqtiu2K/Yp9mFINin2YTYqtmI2YPZhiDYp9mE2KPYtdmE2YogKNi62YrYsSDYp9mE2YXYtNmB2LEpXG4gICAgY29uc3QgaXNCbGFja2xpc3RlZCA9IGF3YWl0IHRoaXMuYmxhY2tsaXN0UmVwby5maW5kT25lKHtcbiAgICAgIHdoZXJlOiB7IHRva2VuOiByZWZyZXNoVG9rZW4gfSxcbiAgICB9KTtcbiAgICBpZiAoaXNCbGFja2xpc3RlZCkge1xuICAgICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZEV4Y2VwdGlvbihcIlJlZnJlc2ggdG9rZW4gaGFzIGJlZW4gcmV2b2tlZFwiKTtcbiAgICB9XG5cbiAgICAvLyDYp9mE2KjYrdirINi52YYg2KfZhNmF2LPYqtiu2K/ZhVxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLnVzZXJSZXBvc2l0b3J5LmZpbmRPbmUoeyB3aGVyZTogeyBlbWFpbCB9IH0pO1xuICAgIGlmICghdXNlcikge1xuICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uKFwiVXNlciBub3QgZm91bmRcIik7XG4gICAgfVxuXG4gICAgLy8g2KfZhNiq2K3ZgtmCINmF2YYg2K3Yp9mE2Kkg2KfZhNmF2LPYqtiu2K/ZhVxuICAgIGlmICghdXNlci5pc1ZlcmlmaWVkKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdXRob3JpemVkRXhjZXB0aW9uKFwiVXNlciBub3QgdmVyaWZpZWRcIik7XG4gICAgfVxuXG4gICAgLy8g2KfZhNiq2K3ZgtmCINmF2YYg2YjYrNmI2K8gcmVmcmVzaCB0b2tlbiDZhdiu2LLZhlxuICAgIGlmICghdXNlci5yZWZyZXNoX1Rva2VuKSB7XG4gICAgICB0aHJvdyBuZXcgVW5hdXRob3JpemVkRXhjZXB0aW9uKFwiTm8gcmVmcmVzaCB0b2tlbiBzdG9yZWRcIik7XG4gICAgfVxuXG4gICAgLy8g2KrYrdmC2YIg2YXZhiDYqti32KfYqNmCIHJlZnJlc2ggdG9rZW4g2YXYuSDYp9mE2YXYrtiy2YYg2YHZiiDZgtin2LnYr9ipINin2YTYqNmK2KfZhtin2KpcbiAgICBjb25zdCBpc01hdGNoID0gYXdhaXQgYmNyeXB0LmNvbXBhcmUocmVmcmVzaFRva2VuLCB1c2VyLnJlZnJlc2hfVG9rZW4pO1xuICAgIGlmICghaXNNYXRjaCkge1xuICAgICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZEV4Y2VwdGlvbihcIlJlZnJlc2ggdG9rZW4gbWlzbWF0Y2hcIik7XG4gICAgfVxuXG4gICAgLy8g2KXZhti02KfYoSB0b2tlbnMg2KzYr9mK2K/YqVxuICAgIGNvbnN0IG5ld1BheWxvYWQgPSB7IHN1YjogdXNlci5pZCwgdXNlcm5hbWU6IHVzZXIuZW1haWwsIHJvbGU6IHVzZXIucm9sZSB9O1xuXG4gICAgY29uc3QgYWNjZXNzX3Rva2VuID0gdGhpcy5qd3RTZXJ2aWNlLnNpZ24obmV3UGF5bG9hZCwge1xuICAgICAgaXNzdWVyOiBcIlByb3RvZm9saW9cIixcbiAgICAgIGV4cGlyZXNJbjogXCIxNW1cIixcbiAgICB9KTtcblxuICAgIC8vINil2KjYt9in2YQg2KfZhNmAIHJlZnJlc2ggdG9rZW4g2KfZhNmC2K/ZitmFXG4gICAgYXdhaXQgdGhpcy5ibGFja2xpc3RSZXBvLnNhdmUoeyB0b2tlbjogcmVmcmVzaFRva2VuIH0pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGFjY2Vzc190b2tlbixcbiAgICB9O1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=