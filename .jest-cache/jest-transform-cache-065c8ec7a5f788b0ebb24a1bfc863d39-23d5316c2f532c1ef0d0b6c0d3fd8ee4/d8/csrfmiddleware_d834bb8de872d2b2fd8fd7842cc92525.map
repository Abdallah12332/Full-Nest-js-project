{"version":3,"names":["common_1","cov_qhzsf2tvc","s","require","csurf","__importStar","CsrfMiddleware","csrfProtection","default","cookie","httpOnly","sameSite","secure","process","env","NODE_ENV","value","req","f","b","headers","body","use","res","next","exports","__decorate","Injectable"],"sources":["/home/omar/Desktop/Protofolio_without_redis/src/csrf.middleware.ts"],"sourcesContent":["import { Injectable, NestMiddleware } from \"@nestjs/common\";\nimport * as csurf from \"csurf\";\nimport { Request, Response, NextFunction } from \"express\";\n\n@Injectable()\nexport class CsrfMiddleware implements NestMiddleware {\n  private readonly csrfProtection = csurf.default({\n    cookie: {\n      httpOnly: false,\n      sameSite: \"strict\",\n      secure: process.env.NODE_ENV === \"production\",\n    },\n    value: (req: Request): string =>\n      (req.headers[\"x-csrf-token\"] as string) ||\n      (req.body as Record<string, string>)[\"_csrf\"] ||\n      \"\",\n  });\n\n  use(req: Request, res: Response, next: NextFunction) {\n    this.csrfProtection(req, res, next);\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}