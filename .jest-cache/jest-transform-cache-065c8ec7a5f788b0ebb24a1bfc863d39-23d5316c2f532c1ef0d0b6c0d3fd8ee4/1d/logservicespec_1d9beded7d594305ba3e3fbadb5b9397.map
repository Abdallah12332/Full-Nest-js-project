{"file":"/home/omar/Desktop/Protofolio_without_redis/src/log/log.service.spec.ts","mappings":"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","names":[],"sources":["/home/omar/Desktop/Protofolio_without_redis/src/log/log.service.spec.ts"],"sourcesContent":["import { Test, TestingModule } from \"@nestjs/testing\";\nimport { LogService } from \"./log.service\";\nimport { getRepositoryToken } from \"@nestjs/typeorm\";\nimport { Log } from \"../entities/Log.entity\";\n\ndescribe(\"LogService\", () => {\n  let service: LogService;\n  let logRepo: Record<string, jest.Mock>;\n\n  beforeEach(async () => {\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        LogService,\n        {\n          provide: getRepositoryToken(Log),\n          useValue: {\n            save: jest.fn(),\n            find: jest.fn(),\n          },\n        },\n      ],\n    }).compile();\n\n    service = module.get<LogService>(LogService);\n    logRepo = module.get(getRepositoryToken(Log));\n  });\n\n  it(\"should be defined\", () => {\n    expect(service).toBeDefined();\n  });\n\n  describe(\"log()\", () => {\n    it(\"should save info log\", async () => {\n      logRepo.save.mockResolvedValue({});\n      await service.log(\"Test message\", \"TestContext\");\n      expect(logRepo.save).toHaveBeenCalledWith({\n        level: \"info\",\n        message: \"Test message\",\n        context: \"TestContext\",\n      });\n    });\n  });\n\n  describe(\"error()\", () => {\n    it(\"should save error log with trace\", async () => {\n      logRepo.save.mockResolvedValue({});\n      await service.error(\"Error occurred\", \"trace123\", \"ErrorContext\");\n      expect(logRepo.save).toHaveBeenCalledWith({\n        level: \"error\",\n        message: \"Error occurred trace123\",\n        context: \"ErrorContext\",\n      });\n    });\n\n    it(\"should save error log without trace\", async () => {\n      logRepo.save.mockResolvedValue({});\n      await service.error(\"Error only\");\n      expect(logRepo.save).toHaveBeenCalledWith({\n        level: \"error\",\n        message: \"Error only \",\n        context: undefined,\n      });\n    });\n  });\n\n  describe(\"warn()\", () => {\n    it(\"should save warning log\", async () => {\n      logRepo.save.mockResolvedValue({});\n      await service.warn(\"Warning message\", \"WarnContext\");\n      expect(logRepo.save).toHaveBeenCalledWith({\n        level: \"warn\",\n        message: \"Warning message\",\n        context: \"WarnContext\",\n      });\n    });\n  });\n\n  describe(\"getlog()\", () => {\n    it(\"should return logs from repo\", async () => {\n      const mockLogs = [{ id: 1, message: \"test\" }];\n      logRepo.find.mockResolvedValue(mockLogs);\n\n      const result = await service.getlog(10, 0);\n      expect(logRepo.find).toHaveBeenCalledWith({\n        take: 10,\n        skip: 0,\n        order: { timestamp: \"DESC\" },\n      });\n      expect(result).toBe(mockLogs);\n    });\n  });\n});\n"],"version":3}