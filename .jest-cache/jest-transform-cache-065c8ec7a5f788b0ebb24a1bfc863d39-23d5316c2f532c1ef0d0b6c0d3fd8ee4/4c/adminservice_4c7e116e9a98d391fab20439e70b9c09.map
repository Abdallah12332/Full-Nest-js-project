{"file":"/home/omar/Desktop/Protofolio_without_redis/src/admin/admin.service.ts","mappings":";;;;;;;;;;;;;;;;AAAA,2CAMwB;AACxB,6CAAmD;AACnD,yDAA+C;AAC/C,yDAA+C;AAC/C,+DAAqD;AACrD,6DAAmD;AACnD,qCAAqC;AACrC,mEAAwD;AAGjD,IAAM,YAAY,GAAlB,MAAM,YAAY;IAGJ;IAEA;IAEA;IAEA;IAEA;IAVnB,YAEmB,QAA0B,EAE1B,QAA0B,EAE1B,WAAgC,EAEhC,UAA8B,EAE9B,QAA8B;QAR9B,aAAQ,GAAR,QAAQ,CAAkB;QAE1B,aAAQ,GAAR,QAAQ,CAAkB;QAE1B,gBAAW,GAAX,WAAW,CAAqB;QAEhC,eAAU,GAAV,UAAU,CAAoB;QAE9B,aAAQ,GAAR,QAAQ,CAAsB;IAC9C,CAAC;IACJ,KAAK,CAAC,aAAa,CAAC,IAAY,EAAE,IAAY;QAC5C,IAAI,CAAC;YACH,MAAM,KAAK,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;YACnE,OAAO,KAAK,CAAC;QACf,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,MAAM,IAAI,KAAK,CAAC,yBAAyB,GAAG,GAAG,CAAC,CAAC;QACnD,CAAC;IACH,CAAC;IAED,KAAK,CAAC,QAAQ,CAAC,EAAU;QACvB,IAAI,CAAC;YACH,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;YAC5D,IAAI,CAAC,IAAI,EAAE,CAAC;gBACV,MAAM,IAAI,0BAAiB,CAAC,gBAAgB,EAAE,YAAY,CAAC,CAAC;YAC9D,CAAC;YACD,OAAO,IAAI,CAAC;QACd,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,IAAI,GAAG,YAAY,0BAAiB;gBAAE,MAAM,GAAG,CAAC;YAChD,MAAM,IAAI,KAAK,CAAC,yBAAyB,GAAG,GAAG,CAAC,CAAC;QACnD,CAAC;IACH,CAAC;IAED,KAAK,CAAC,UAAU,CAAC,QAAc;QAC7B,IAAI,CAAC;YACH,MAAM,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;gBAChC,IAAI,EAAE,QAAQ,CAAC,IAAI;gBACnB,KAAK,EAAE,QAAQ,CAAC,KAAK;gBACrB,QAAQ,EAAE,QAAQ,CAAC,QAAQ;gBAC3B,QAAQ,EAAE,QAAQ,CAAC,QAAQ,IAAI,OAAO;gBACtC,IAAI,EAAE,QAAQ,CAAC,IAAI;gBACnB,UAAU,EAAE,QAAQ,CAAC,UAAU;gBAC/B,QAAQ,EAAE,QAAQ,CAAC,QAAQ;aAC5B,CAAC,CAAC;YACH,MAAM,SAAS,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAEjD,MAAM,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC;gBAChC,IAAI,EAAE,SAAS;aAChB,CAAC,CAAC;YACH,MAAM,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC/B,OAAO,SAAS,CAAC;QACnB,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,MAAM,IAAI,KAAK,CAAC,yBAAyB,GAAG,GAAG,CAAC,CAAC;QACnD,CAAC;IACH,CAAC;IAED,KAAK,CAAC,UAAU,CAAC,EAAU,EAAE,YAA2B;QACtD,IAAI,CAAC;YACH,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;YAC5D,IAAI,CAAC,IAAI,EAAE,CAAC;gBACV,MAAM,IAAI,0BAAiB,CAAC,gBAAgB,EAAE,YAAY,CAAC,CAAC;YAC9D,CAAC;YACD,MAAM,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE,EAAE,YAAY,CAAC,CAAC;YAC7C,OAAO,IAAI,CAAC;QACd,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,IAAI,GAAG,YAAY,0BAAiB;gBAAE,MAAM,GAAG,CAAC;YAChD,MAAM,IAAI,KAAK,CAAC,yBAAyB,GAAG,GAAG,CAAC,CAAC;QACnD,CAAC;IACH,CAAC;IAED,KAAK,CAAC,UAAU,CAAC,EAAU;QACzB,IAAI,CAAC,EAAE,EAAE,CAAC;YACR,MAAM,IAAI,4BAAmB,CAAC,gBAAgB,CAAC,CAAC;QAClD,CAAC;QACD,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC;YACvC,KAAK,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE;YACjB,SAAS,EAAE,CAAC,QAAQ,EAAE,MAAM,EAAE,SAAS,CAAC;SACzC,CAAC,CAAC;QACH,IAAI,CAAC,IAAI,EAAE,CAAC;YACV,MAAM,IAAI,0BAAiB,CAAC,gBAAgB,EAAE,YAAY,CAAC,CAAC;QAC9D,CAAC;QACD,MAAM,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;QACjC,OAAO,kBAAkB,CAAC;IAC5B,CAAC;IAED,qBAAqB;IACrB,KAAK,CAAC,iBAAiB,CAAC,IAAY,EAAE,IAAY;QAChD,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC;gBAC3C,IAAI,EAAE,IAAI;gBACV,IAAI,EAAE,IAAI;gBACV,SAAS,EAAE,CAAC,SAAS,CAAC;aACvB,CAAC,CAAC;YACH,OAAO,QAAQ,CAAC;QAClB,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,MAAM,IAAI,KAAK,CAAC,4BAA4B,GAAG,GAAG,CAAC,CAAC;QACtD,CAAC;IACH,CAAC;IAED,KAAK,CAAC,WAAW,CAAC,EAAU;QAC1B,IAAI,CAAC;YACH,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;gBAC7C,KAAK,EAAE,EAAE,EAAE,EAAE;gBACb,SAAS,EAAE,CAAC,SAAS,CAAC;aACvB,CAAC,CAAC;YACH,IAAI,CAAC,OAAO,EAAE,CAAC;gBACb,MAAM,IAAI,0BAAiB,CAAC,mBAAmB,EAAE,YAAY,CAAC,CAAC;YACjE,CAAC;YACD,OAAO,OAAO,CAAC;QACjB,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,IAAI,GAAG,YAAY,sBAAa,EAAE,CAAC;gBACjC,MAAM,GAAG,CAAC;YACZ,CAAC;YACD,MAAM,IAAI,qCAA4B,CAAC,yBAAyB,CAAC,CAAC;QACpE,CAAC;IACH,CAAC;IAED,KAAK,CAAC,aAAa,CAAC,WAA6B;QAC/C,IAAI,CAAC;YACH,IACE,CAAC,WAAW,CAAC,IAAI;gBACjB,CAAC,WAAW,CAAC,WAAW;gBACxB,CAAC,WAAW,CAAC,KAAK;gBAClB,CAAC,WAAW,CAAC,KAAK,EAClB,CAAC;gBACD,MAAM,IAAI,4BAAmB,CAC3B,kDAAkD,CACnD,CAAC;YACJ,CAAC;YAED,MAAM,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;gBACtC,IAAI,EAAE,WAAW,CAAC,IAAI;gBACtB,WAAW,EAAE,WAAW,CAAC,WAAW;gBACpC,gBAAgB,EAAE,WAAW,CAAC,gBAAgB;gBAC9C,KAAK,EAAE,WAAW,CAAC,KAAK;gBACxB,KAAK,EAAE,WAAW,CAAC,KAAK;gBACxB,UAAU,EAAE,WAAW,CAAC,UAAU;gBAClC,MAAM,EAAE,WAAW,CAAC,MAAM,IAAI,EAAE;aACjC,CAAC,CAAC;YAEH,MAAM,YAAY,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAC1D,OAAO,YAAY,CAAC;QACtB,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,IAAI,GAAG,YAAY,4BAAmB,EAAE,CAAC;gBACvC,MAAM,GAAG,CAAC;YACZ,CAAC;YACD,MAAM,IAAI,KAAK,CAAC,4BAA4B,GAAG,GAAG,CAAC,CAAC;QACtD,CAAC;IACH,CAAC;IAED,KAAK,CAAC,aAAa,CACjB,EAAU,EACV,cAAgC;QAEhC,IAAI,CAAC;YACH,IAAI,CAAC,EAAE,EAAE,CAAC;gBACR,MAAM,IAAI,4BAAmB,CAAC,wBAAwB,CAAC,CAAC;YAC1D,CAAC;YAED,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;YAClE,IAAI,CAAC,OAAO,EAAE,CAAC;gBACb,MAAM,IAAI,0BAAiB,CAAC,mBAAmB,EAAE,YAAY,CAAC,CAAC;YACjE,CAAC;YAED,MAAM,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,EAAE,EAAE,cAAc,CAAC,CAAC;YAClD,OAAO,8BAA8B,CAAC;QACxC,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,IACE,GAAG,YAAY,4BAAmB;gBAClC,GAAG,YAAY,0BAAiB,EAChC,CAAC;gBACD,MAAM,GAAG,CAAC;YACZ,CAAC;YACD,MAAM,IAAI,KAAK,CAAC,4BAA4B,GAAG,GAAG,CAAC,CAAC;QACtD,CAAC;IACH,CAAC;IAED,KAAK,CAAC,aAAa,CAAC,EAAU;QAC5B,IAAI,CAAC;YACH,IAAI,CAAC,EAAE,EAAE,CAAC;gBACR,MAAM,IAAI,4BAAmB,CAAC,wBAAwB,CAAC,CAAC;YAC1D,CAAC;YAED,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;gBAC7C,KAAK,EAAE,EAAE,EAAE,EAAE;gBACb,SAAS,EAAE,CAAC,SAAS,EAAE,WAAW,CAAC;aACpC,CAAC,CAAC;YAEH,IAAI,CAAC,OAAO,EAAE,CAAC;gBACb,MAAM,IAAI,0BAAiB,CAAC,mBAAmB,EAAE,YAAY,CAAC,CAAC;YACjE,CAAC;YAED,MAAM,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;YACvC,OAAO,8BAA8B,CAAC;QACxC,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,IACE,GAAG,YAAY,4BAAmB;gBAClC,GAAG,YAAY,0BAAiB,EAChC,CAAC;gBACD,MAAM,GAAG,CAAC;YACZ,CAAC;YACD,MAAM,IAAI,KAAK,CAAC,4BAA4B,GAAG,GAAG,CAAC,CAAC;QACtD,CAAC;IACH,CAAC;IACD,KAAK,CAAC,SAAS,CAAC,EAAU;QACxB,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;QACnD,IAAI,CAAC,IAAI,EAAE,CAAC;YACV,MAAM,IAAI,0BAAiB,CAAC,gBAAgB,CAAC,CAAC;QAChD,CAAC;QACD,OAAO,IAAI,CAAC;IACd,CAAC;IACD,KAAK,CAAC,aAAa,CAAC,EAAU;QAC5B,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;QACvD,IAAI,CAAC,QAAQ,EAAE,CAAC;YACd,MAAM,IAAI,0BAAiB,CAAC,cAAc,CAAC,CAAC;QAC9C,CAAC;QACD,OAAO,QAAQ,CAAC;IAClB,CAAC;CACF,CAAA;AA5NY,oCAAY;uBAAZ,YAAY;IADxB,IAAA,mBAAU,GAAE;IAGR,WAAA,IAAA,0BAAgB,EAAC,kBAAI,CAAC,CAAA;IAEtB,WAAA,IAAA,0BAAgB,EAAC,kBAAI,CAAC,CAAA;IAEtB,WAAA,IAAA,0BAAgB,EAAC,wBAAO,CAAC,CAAA;IAEzB,WAAA,IAAA,0BAAgB,EAAC,sBAAM,CAAC,CAAA;IAExB,WAAA,IAAA,0BAAgB,EAAC,2BAAQ,CAAC,CAAA;yDAPA,oBAAU,oBAAV,oBAAU,oDAEV,oBAAU,oBAAV,oBAAU,oDAEP,oBAAU,oBAAV,oBAAU,oDAEX,oBAAU,oBAAV,oBAAU,oDAEZ,oBAAU,oBAAV,oBAAU;GAX5B,YAAY,CA4NxB","names":[],"sources":["/home/omar/Desktop/Protofolio_without_redis/src/admin/admin.service.ts"],"sourcesContent":["import {\n  BadRequestException,\n  HttpException,\n  Injectable,\n  InternalServerErrorException,\n  NotFoundException,\n} from \"@nestjs/common\";\nimport { InjectRepository } from \"@nestjs/typeorm\";\nimport { Cart } from \"../entities/Cart.entity\";\nimport { User } from \"../entities/User.entity\";\nimport { Product } from \"../entities/Product.entity\";\nimport { Review } from \"../entities/Review.entity\";\nimport { Repository } from \"typeorm\";\nimport { CartItem } from \"../entities/Cart_Item.entity\";\n\n@Injectable()\nexport class AdminService {\n  constructor(\n    @InjectRepository(User)\n    private readonly UserRepo: Repository<User>,\n    @InjectRepository(Cart)\n    private readonly CartRepo: Repository<Cart>,\n    @InjectRepository(Product)\n    private readonly ProductRepo: Repository<Product>,\n    @InjectRepository(Review)\n    private readonly ReviewRepo: Repository<Review>,\n    @InjectRepository(CartItem)\n    private readonly CartItem: Repository<CartItem>,\n  ) {}\n  async FindLimitUser(take: number, skip: number): Promise<User[]> {\n    try {\n      const users = await this.UserRepo.find({ skip: skip, take: take });\n      return users;\n    } catch (err) {\n      throw new Error(\"Failed to create user: \" + err);\n    }\n  }\n\n  async FindUser(id: string): Promise<User> {\n    try {\n      const user = await this.UserRepo.findOne({ where: { id } });\n      if (!user) {\n        throw new NotFoundException(`User with id ${id} not found`);\n      }\n      return user;\n    } catch (err) {\n      if (err instanceof NotFoundException) throw err;\n      throw new Error(\"Failed to create user: \" + err);\n    }\n  }\n\n  async CreateUser(userData: User): Promise<User> {\n    try {\n      const user = this.UserRepo.create({\n        name: userData.name,\n        email: userData.email,\n        password: userData.password,\n        provider: userData.provider || \"local\",\n        role: userData.role,\n        isVerified: userData.isVerified,\n        googleId: userData.googleId,\n      });\n      const savedUser = await this.UserRepo.save(user);\n\n      const cart = this.CartRepo.create({\n        user: savedUser,\n      });\n      await this.CartRepo.save(cart);\n      return savedUser;\n    } catch (err) {\n      throw new Error(\"Failed to create user: \" + err);\n    }\n  }\n\n  async UpdateUser(id: string, updated_User: Partial<User>): Promise<string> {\n    try {\n      const user = await this.UserRepo.findOne({ where: { id } });\n      if (!user) {\n        throw new NotFoundException(`User with id ${id} not found`);\n      }\n      await this.UserRepo.update(id, updated_User);\n      return \"ok\";\n    } catch (err) {\n      if (err instanceof NotFoundException) throw err;\n      throw new Error(\"Failed to Update user: \" + err);\n    }\n  }\n\n  async DeleteUser(id: string): Promise<string> {\n    if (!id) {\n      throw new BadRequestException(\"id is required\");\n    }\n    const user = await this.UserRepo.findOne({\n      where: { id: id },\n      relations: [\"orders\", \"cart\", \"reviews\"],\n    });\n    if (!user) {\n      throw new NotFoundException(`User with id ${id} not found`);\n    }\n    await this.UserRepo.remove(user);\n    return \"the user deleted\";\n  }\n\n  // Product operations\n  async FindLimitProducts(take: number, skip: number): Promise<Product[]> {\n    try {\n      const products = await this.ProductRepo.find({\n        skip: skip,\n        take: take,\n        relations: [\"reviews\"],\n      });\n      return products;\n    } catch (err) {\n      throw new Error(\"Failed to fetch products: \" + err);\n    }\n  }\n\n  async FindProduct(id: string): Promise<Product> {\n    try {\n      const product = await this.ProductRepo.findOne({\n        where: { id },\n        relations: [\"reviews\"],\n      });\n      if (!product) {\n        throw new NotFoundException(`Product with id ${id} not found`);\n      }\n      return product;\n    } catch (err) {\n      if (err instanceof HttpException) {\n        throw err;\n      }\n      throw new InternalServerErrorException(\"Failed to fetch product\");\n    }\n  }\n\n  async CreateProduct(productData: Partial<Product>): Promise<Product> {\n    try {\n      if (\n        !productData.name ||\n        !productData.description ||\n        !productData.price ||\n        !productData.stock\n      ) {\n        throw new BadRequestException(\n          \"Name, description, price, and stock are required\",\n        );\n      }\n\n      const product = this.ProductRepo.create({\n        name: productData.name,\n        description: productData.description,\n        more_description: productData.more_description,\n        price: productData.price,\n        stock: productData.stock,\n        categoryId: productData.categoryId,\n        images: productData.images || [],\n      });\n\n      const savedProduct = await this.ProductRepo.save(product);\n      return savedProduct;\n    } catch (err) {\n      if (err instanceof BadRequestException) {\n        throw err;\n      }\n      throw new Error(\"Failed to create product: \" + err);\n    }\n  }\n\n  async UpdateProduct(\n    id: string,\n    updatedProduct: Partial<Product>,\n  ): Promise<string> {\n    try {\n      if (!id) {\n        throw new BadRequestException(\"Product ID is required\");\n      }\n\n      const product = await this.ProductRepo.findOne({ where: { id } });\n      if (!product) {\n        throw new NotFoundException(`Product with id ${id} not found`);\n      }\n\n      await this.ProductRepo.update(id, updatedProduct);\n      return \"Product updated successfully\";\n    } catch (err) {\n      if (\n        err instanceof BadRequestException ||\n        err instanceof NotFoundException\n      ) {\n        throw err;\n      }\n      throw new Error(\"Failed to update product: \" + err);\n    }\n  }\n\n  async DeleteProduct(id: string): Promise<string> {\n    try {\n      if (!id) {\n        throw new BadRequestException(\"Product ID is required\");\n      }\n\n      const product = await this.ProductRepo.findOne({\n        where: { id },\n        relations: [\"reviews\", \"cartItems\"],\n      });\n\n      if (!product) {\n        throw new NotFoundException(`Product with id ${id} not found`);\n      }\n\n      await this.ProductRepo.remove(product);\n      return \"Product deleted successfully\";\n    } catch (err) {\n      if (\n        err instanceof BadRequestException ||\n        err instanceof NotFoundException\n      ) {\n        throw err;\n      }\n      throw new Error(\"Failed to delete product: \" + err);\n    }\n  }\n  async Find_Cart(id: string): Promise<Cart> {\n    const cart = await this.CartRepo.findOneBy({ id });\n    if (!cart) {\n      throw new NotFoundException(\"cart not found\");\n    }\n    return cart;\n  }\n  async Find_CartItem(id: string): Promise<CartItem> {\n    const cartItem = await this.CartItem.findOneBy({ id });\n    if (!cartItem) {\n      throw new NotFoundException(\"no cart Item\");\n    }\n    return cartItem;\n  }\n}\n"],"version":3}