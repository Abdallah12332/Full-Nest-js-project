c9b0ea88babbd6a4e09f1f3fdcdd899f
"use strict";
/* eslint-disable @typescript-eslint/unbound-method */
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const admin_controller_1 = require("./admin.controller");
const admin_service_1 = require("./admin.service");
const log_service_1 = require("../log/log.service");
const throttler_1 = require("@nestjs/throttler");
const Cart_entity_1 = require("../entities/Cart.entity");
describe("AdminController", () => {
    let controller;
    let adminService;
    let logService;
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            controllers: [admin_controller_1.AdminController],
            providers: [
                {
                    provide: admin_service_1.AdminService,
                    useValue: {
                        FindLimitUser: jest.fn(),
                        FindUser: jest.fn(),
                        CreateUser: jest.fn(),
                        UpdateUser: jest.fn(),
                        DeleteUser: jest.fn(),
                        FindLimitProducts: jest.fn(),
                        FindProduct: jest.fn(),
                        CreateProduct: jest.fn(),
                        UpdateProduct: jest.fn(),
                        DeleteProduct: jest.fn(),
                        Find_Cart: jest.fn(),
                        Find_CartItem: jest.fn(),
                    },
                },
                {
                    provide: log_service_1.LogService,
                    useValue: {
                        getlog: jest.fn(),
                    },
                },
                {
                    provide: "THROTTLER:MODULE_OPTIONS",
                    useValue: {},
                },
            ],
        })
            .overrideGuard(throttler_1.ThrottlerGuard)
            .useValue({ canActivate: () => true })
            .compile();
        controller = module.get(admin_controller_1.AdminController);
        adminService = module.get(admin_service_1.AdminService);
        logService = module.get(log_service_1.LogService);
    });
    it("should be defined", () => {
        expect(controller).toBeDefined();
    });
    describe("FindLimitUser", () => {
        it("should return users", async () => {
            const mockUsers = [{ id: "1", name: "User1" }];
            jest.spyOn(adminService, "FindLimitUser").mockResolvedValue(mockUsers);
            const result = await controller.FindLimitUser({ take: 1, skip: 0 });
            expect(result).toEqual(expect.objectContaining({
                success: true,
                message: "Users retrieved successfully",
                data: mockUsers,
            }));
            expect(adminService.FindLimitUser).toHaveBeenCalledWith(1, 0);
        });
    });
    describe("FindUser", () => {
        it("should return one user", async () => {
            const mockUser = { id: "1", name: "User1" };
            jest.spyOn(adminService, "FindUser").mockResolvedValue(mockUser);
            const result = await controller.FindUser("1");
            expect(result).toEqual(expect.objectContaining({
                success: true,
                message: "User retrieved successfully",
                data: mockUser,
            }));
        });
    });
    describe("CreateUser", () => {
        it("should create user and return response", async () => {
            const mockUser = { id: "1", name: "User1" };
            jest.spyOn(adminService, "CreateUser").mockResolvedValue(mockUser);
            const result = await controller.CreateUser(mockUser);
            expect(result).toEqual(expect.objectContaining({
                success: true,
                message: "User created successfully",
                data: mockUser,
            }));
            expect(adminService.CreateUser).toHaveBeenCalledWith(mockUser);
        });
    });
    describe("UpdateUser", () => {
        it("should update user", async () => {
            jest.spyOn(adminService, "UpdateUser").mockResolvedValue("ok");
            const result = await controller.UpdateUser({
                id: "1",
                updated_User: {
                    name: "New",
                    id: "",
                    Photo: "",
                    email: "",
                    provider: "local",
                    role: "user",
                    isVerified: false,
                    refresh_Token: "",
                    createdAt: new Date(),
                    updatedAt: new Date(),
                    orders: [],
                    cart: new Cart_entity_1.Cart(),
                    reviews: [],
                },
            });
            expect(result).toEqual(expect.objectContaining({
                success: true,
                message: "User updated successfully",
            }));
            expect(adminService.UpdateUser).toHaveBeenCalledWith("1", expect.objectContaining({ name: "New" }));
        });
    });
    describe("DeleteUser", () => {
        it("should delete user", async () => {
            jest.spyOn(adminService, "DeleteUser").mockResolvedValue("ok");
            const result = await controller.DeleteUser("1");
            expect(result).toEqual(expect.objectContaining({
                success: true,
                message: "User deleted successfully",
            }));
        });
    });
    describe("FindLimitProducts", () => {
        it("should return limited products", async () => {
            const mockProducts = [{ id: "1", name: "Prod" }];
            jest
                .spyOn(adminService, "FindLimitProducts")
                .mockResolvedValue(mockProducts);
            const result = await controller.FindLimitProducts({ take: 2, skip: 0 });
            expect(result).toEqual(expect.objectContaining({
                success: true,
                message: "Products retrieved successfully",
                data: mockProducts,
            }));
        });
    });
    describe("FindProduct", () => {
        it("should return product by id", async () => {
            const mockProduct = { id: "1", name: "Prod" };
            jest.spyOn(adminService, "FindProduct").mockResolvedValue(mockProduct);
            const result = await controller.FindProduct("1");
            expect(result).toEqual(expect.objectContaining({
                success: true,
                message: "Product retrieved successfully",
                data: mockProduct,
            }));
        });
    });
    describe("CreateProduct", () => {
        it("should create product", async () => {
            const mockProduct = { id: "1", name: "Prod" };
            jest.spyOn(adminService, "CreateProduct").mockResolvedValue(mockProduct);
            const result = await controller.CreateProduct(mockProduct);
            expect(result).toEqual(expect.objectContaining({
                success: true,
                message: "Product created successfully",
                data: mockProduct,
            }));
        });
    });
    describe("UpdateProduct", () => {
        it("should update product", async () => {
            jest
                .spyOn(adminService, "UpdateProduct")
                .mockResolvedValue("Product updated successfully");
            const result = await controller.UpdateProduct({
                id: "1",
                updatedProduct: {
                    name: "new",
                    id: "",
                    description: "",
                    price: 0,
                    stock: 0,
                    images: [],
                    createdAt: new Date(),
                    updatedAt: new Date(),
                    reviews: [],
                    cartItems: [],
                },
            });
            expect(result).toEqual(expect.objectContaining({
                success: true,
                message: "Product updated successfully",
            }));
        });
    });
    describe("DeleteProduct", () => {
        it("should delete product", async () => {
            jest
                .spyOn(adminService, "DeleteProduct")
                .mockResolvedValue("Product deleted successfully");
            const result = await controller.DeleteProduct("1");
            expect(result).toEqual(expect.objectContaining({
                success: true,
                message: "Product deleted successfully",
            }));
        });
    });
    describe("Find_Cart", () => {
        it("should return cart by id", async () => {
            const mockCart = { id: "1" };
            jest.spyOn(adminService, "Find_Cart").mockResolvedValue(mockCart);
            const result = await controller.Find_Cart({ id: "1" });
            expect(result).toEqual(expect.objectContaining({
                success: true,
                message: "Cart retrieved successfully",
                data: mockCart,
            }));
        });
    });
    describe("Find_CartItem", () => {
        it("should return cart item by id", async () => {
            const mockCartItem = { id: "1" };
            jest.spyOn(adminService, "Find_CartItem").mockResolvedValue(mockCartItem);
            const result = await controller.Find_CartItem({ id: "1" });
            expect(result).toEqual(expect.objectContaining({
                success: true,
                message: "Cart item retrieved successfully",
                data: mockCartItem,
            }));
        });
    });
    describe("getlog", () => {
        it("should return logs", async () => {
            const mockLogs = [
                { id: "1", message: "log", level: "info", timestamp: new Date() },
            ];
            jest.spyOn(logService, "getlog").mockResolvedValue(mockLogs);
            const result = await controller.getlog({ take: 2, skip: 0 });
            expect(result).toEqual(expect.objectContaining({
                success: true,
                message: "Logs retrieved successfully",
                data: mockLogs,
            }));
            expect(logService.getlog).toHaveBeenCalledWith(2, 0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvb21hci9EZXNrdG9wL1Byb3RvZm9saW9fd2l0aG91dF9yZWRpcy9zcmMvYWRtaW4vYWRtaW4uY29udHJvbGxlci5zcGVjLnRzIiwibWFwcGluZ3MiOiI7QUFBQSxzREFBc0Q7O0FBRXRELDZDQUFzRDtBQUN0RCx5REFBcUQ7QUFDckQsbURBQStDO0FBQy9DLG9EQUFnRDtBQUNoRCxpREFBbUQ7QUFHbkQseURBQStDO0FBSS9DLFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7SUFDL0IsSUFBSSxVQUEyQixDQUFDO0lBQ2hDLElBQUksWUFBMEIsQ0FBQztJQUMvQixJQUFJLFVBQXNCLENBQUM7SUFFM0IsVUFBVSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLE1BQU0sTUFBTSxHQUFrQixNQUFNLGNBQUksQ0FBQyxtQkFBbUIsQ0FBQztZQUMzRCxXQUFXLEVBQUUsQ0FBQyxrQ0FBZSxDQUFDO1lBQzlCLFNBQVMsRUFBRTtnQkFDVDtvQkFDRSxPQUFPLEVBQUUsNEJBQVk7b0JBQ3JCLFFBQVEsRUFBRTt3QkFDUixhQUFhLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTt3QkFDeEIsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7d0JBQ25CLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3dCQUNyQixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTt3QkFDckIsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7d0JBQ3JCLGlCQUFpQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7d0JBQzVCLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3dCQUN0QixhQUFhLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTt3QkFDeEIsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7d0JBQ3hCLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO3dCQUN4QixTQUFTLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTt3QkFDcEIsYUFBYSxFQUFFLElBQUks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Q0FBQztZQUN0QixJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUU3RCxNQUFNLE1BQU0sR0FBRyxNQUFNLFVBQVUsQ0FBQyxNQUFNLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzdELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQ3BCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDdEIsT0FBTyxFQUFFLElBQUk7Z0JBQ2IsT0FBTyxFQUFFLDZCQUE2QjtnQkFDdEMsSUFBSSxFQUFFLFFBQVE7YUFDZixDQUFDLENBQ0gsQ0FBQztZQUNGLE1BQU0sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3ZELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9vbWFyL0Rlc2t0b3AvUHJvdG9mb2xpb193aXRob3V0X3JlZGlzL3NyYy9hZG1pbi9hZG1pbi5jb250cm9sbGVyLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L3VuYm91bmQtbWV0aG9kICovXG5cbmltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tIFwiQG5lc3Rqcy90ZXN0aW5nXCI7XG5pbXBvcnQgeyBBZG1pbkNvbnRyb2xsZXIgfSBmcm9tIFwiLi9hZG1pbi5jb250cm9sbGVyXCI7XG5pbXBvcnQgeyBBZG1pblNlcnZpY2UgfSBmcm9tIFwiLi9hZG1pbi5zZXJ2aWNlXCI7XG5pbXBvcnQgeyBMb2dTZXJ2aWNlIH0gZnJvbSBcIi4uL2xvZy9sb2cuc2VydmljZVwiO1xuaW1wb3J0IHsgVGhyb3R0bGVyR3VhcmQgfSBmcm9tIFwiQG5lc3Rqcy90aHJvdHRsZXJcIjtcbmltcG9ydCB7IFVzZXIgfSBmcm9tIFwiLi4vZW50aXRpZXMvVXNlci5lbnRpdHlcIjtcbmltcG9ydCB7IFByb2R1Y3QgfSBmcm9tIFwiLi4vZW50aXRpZXMvUHJvZHVjdC5lbnRpdHlcIjtcbmltcG9ydCB7IENhcnQgfSBmcm9tIFwiLi4vZW50aXRpZXMvQ2FydC5lbnRpdHlcIjtcbmltcG9ydCB7IENhcnRJdGVtIH0gZnJvbSBcIi4uL2VudGl0aWVzL0NhcnRfSXRlbS5lbnRpdHlcIjtcbmltcG9ydCB7IExvZyB9IGZyb20gXCIuLi9lbnRpdGllcy9Mb2cuZW50aXR5XCI7XG5cbmRlc2NyaWJlKFwiQWRtaW5Db250cm9sbGVyXCIsICgpID0+IHtcbiAgbGV0IGNvbnRyb2xsZXI6IEFkbWluQ29udHJvbGxlcjtcbiAgbGV0IGFkbWluU2VydmljZTogQWRtaW5TZXJ2aWNlO1xuICBsZXQgbG9nU2VydmljZTogTG9nU2VydmljZTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgY29udHJvbGxlcnM6IFtBZG1pbkNvbnRyb2xsZXJdLFxuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBBZG1pblNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IHtcbiAgICAgICAgICAgIEZpbmRMaW1pdFVzZXI6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIEZpbmRVc2VyOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBDcmVhdGVVc2VyOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBVcGRhdGVVc2VyOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBEZWxldGVVc2VyOiBqZXN0LmZuKCksXG4gICAgICAgICAgICBGaW5kTGltaXRQcm9kdWN0czogamVzdC5mbigpLFxuICAgICAgICAgICAgRmluZFByb2R1Y3Q6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIENyZWF0ZVByb2R1Y3Q6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIFVwZGF0ZVByb2R1Y3Q6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIERlbGV0ZVByb2R1Y3Q6IGplc3QuZm4oKSxcbiAgICAgICAgICAgIEZpbmRfQ2FydDogamVzdC5mbigpLFxuICAgICAgICAgICAgRmluZF9DYXJ0SXRlbTogamVzdC5mbigpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBwcm92aWRlOiBMb2dTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiB7XG4gICAgICAgICAgICBnZXRsb2c6IGplc3QuZm4oKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogXCJUSFJPVFRMRVI6TU9EVUxFX09QVElPTlNcIixcbiAgICAgICAgICB1c2VWYWx1ZToge30sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pXG4gICAgICAub3ZlcnJpZGVHdWFyZChUaHJvdHRsZXJHdWFyZClcbiAgICAgIC51c2VWYWx1ZSh7IGNhbkFjdGl2YXRlOiAoKSA9PiB0cnVlIH0pXG4gICAgICAuY29tcGlsZSgpO1xuXG4gICAgY29udHJvbGxlciA9IG1vZHVsZS5nZXQoQWRtaW5Db250cm9sbGVyKTtcbiAgICBhZG1pblNlcnZpY2UgPSBtb2R1bGUuZ2V0KEFkbWluU2VydmljZSk7XG4gICAgbG9nU2VydmljZSA9IG1vZHVsZS5nZXQoTG9nU2VydmljZSk7XG4gIH0pO1xuXG4gIGl0KFwic2hvdWxkIGJlIGRlZmluZWRcIiwgKCkgPT4ge1xuICAgIGV4cGVjdChjb250cm9sbGVyKS50b0JlRGVmaW5lZCgpO1xuICB9KTtcblxuICBkZXNjcmliZShcIkZpbmRMaW1pdFVzZXJcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHJldHVybiB1c2Vyc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVXNlcnMgPSBbeyBpZDogXCIxXCIsIG5hbWU6IFwiVXNlcjFcIiB9XSBhcyB1bmtub3duIGFzIFVzZXJbXTtcbiAgICAgIGplc3Quc3B5T24oYWRtaW5TZXJ2aWNlLCBcIkZpbmRMaW1pdFVzZXJcIikubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXJzKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5GaW5kTGltaXRVc2VyKHsgdGFrZTogMSwgc2tpcDogMCB9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIG1lc3NhZ2U6IFwiVXNlcnMgcmV0cmlldmVkIHN1Y2Nlc3NmdWxseVwiLFxuICAgICAgICAgIGRhdGE6IG1vY2tVc2VycyxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgICAgZXhwZWN0KGFkbWluU2VydmljZS5GaW5kTGltaXRVc2VyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgxLCAwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJGaW5kVXNlclwiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgcmV0dXJuIG9uZSB1c2VyXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tVc2VyID0geyBpZDogXCIxXCIsIG5hbWU6IFwiVXNlcjFcIiB9IGFzIHVua25vd24gYXMgVXNlcjtcbiAgICAgIGplc3Quc3B5T24oYWRtaW5TZXJ2aWNlLCBcIkZpbmRVc2VyXCIpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5GaW5kVXNlcihcIjFcIik7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICBtZXNzYWdlOiBcIlVzZXIgcmV0cmlldmVkIHN1Y2Nlc3NmdWxseVwiLFxuICAgICAgICAgIGRhdGE6IG1vY2tVc2VyLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiQ3JlYXRlVXNlclwiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgY3JlYXRlIHVzZXIgYW5kIHJldHVybiByZXNwb25zZVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVXNlciA9IHsgaWQ6IFwiMVwiLCBuYW1lOiBcIlVzZXIxXCIgfSBhcyB1bmtub3duIGFzIFVzZXI7XG4gICAgICBqZXN0LnNweU9uKGFkbWluU2VydmljZSwgXCJDcmVhdGVVc2VyXCIpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5DcmVhdGVVc2VyKG1vY2tVc2VyKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIG1lc3NhZ2U6IFwiVXNlciBjcmVhdGVkIHN1Y2Nlc3NmdWxseVwiLFxuICAgICAgICAgIGRhdGE6IG1vY2tVc2VyLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgICBleHBlY3QoYWRtaW5TZXJ2aWNlLkNyZWF0ZVVzZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tVc2VyKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJVcGRhdGVVc2VyXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCB1cGRhdGUgdXNlclwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0LnNweU9uKGFkbWluU2VydmljZSwgXCJVcGRhdGVVc2VyXCIpLm1vY2tSZXNvbHZlZFZhbHVlKFwib2tcIik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuVXBkYXRlVXNlcih7XG4gICAgICAgIGlkOiBcIjFcIixcbiAgICAgICAgdXBkYXRlZF9Vc2VyOiB7XG4gICAgICAgICAgbmFtZTogXCJOZXdcIixcbiAgICAgICAgICBpZDogXCJcIixcbiAgICAgICAgICBQaG90bzogXCJcIixcbiAgICAgICAgICBlbWFpbDogXCJcIixcbiAgICAgICAgICBwcm92aWRlcjogXCJsb2NhbFwiLFxuICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgIGlzVmVyaWZpZWQ6IGZhbHNlLFxuICAgICAgICAgIHJlZnJlc2hfVG9rZW46IFwiXCIsXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICBvcmRlcnM6IFtdLFxuICAgICAgICAgIGNhcnQ6IG5ldyBDYXJ0KCksXG4gICAgICAgICAgcmV2aWV3czogW10sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgbWVzc2FnZTogXCJVc2VyIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5XCIsXG4gICAgICAgIH0pLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChhZG1pblNlcnZpY2UuVXBkYXRlVXNlcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIFwiMVwiLFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IG5hbWU6IFwiTmV3XCIgfSksXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIkRlbGV0ZVVzZXJcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIGRlbGV0ZSB1c2VyXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3Quc3B5T24oYWRtaW5TZXJ2aWNlLCBcIkRlbGV0ZVVzZXJcIikubW9ja1Jlc29sdmVkVmFsdWUoXCJva1wiKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5EZWxldGVVc2VyKFwiMVwiKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIG1lc3NhZ2U6IFwiVXNlciBkZWxldGVkIHN1Y2Nlc3NmdWxseVwiLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiRmluZExpbWl0UHJvZHVjdHNcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHJldHVybiBsaW1pdGVkIHByb2R1Y3RzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tQcm9kdWN0cyA9IFt7IGlkOiBcIjFcIiwgbmFtZTogXCJQcm9kXCIgfV0gYXMgdW5rbm93biBhcyBQcm9kdWN0W107XG4gICAgICBqZXN0XG4gICAgICAgIC5zcHlPbihhZG1pblNlcnZpY2UsIFwiRmluZExpbWl0UHJvZHVjdHNcIilcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9kdWN0cyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuRmluZExpbWl0UHJvZHVjdHMoeyB0YWtlOiAyLCBza2lwOiAwIH0pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgbWVzc2FnZTogXCJQcm9kdWN0cyByZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5XCIsXG4gICAgICAgICAgZGF0YTogbW9ja1Byb2R1Y3RzLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiRmluZFByb2R1Y3RcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHJldHVybiBwcm9kdWN0IGJ5IGlkXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tQcm9kdWN0ID0geyBpZDogXCIxXCIsIG5hbWU6IFwiUHJvZFwiIH0gYXMgdW5rbm93biBhcyBQcm9kdWN0O1xuICAgICAgamVzdC5zcHlPbihhZG1pblNlcnZpY2UsIFwiRmluZFByb2R1Y3RcIikubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3QpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLkZpbmRQcm9kdWN0KFwiMVwiKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIG1lc3NhZ2U6IFwiUHJvZHVjdCByZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5XCIsXG4gICAgICAgICAgZGF0YTogbW9ja1Byb2R1Y3QsXG4gICAgICAgIH0pLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJDcmVhdGVQcm9kdWN0XCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBjcmVhdGUgcHJvZHVjdFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUHJvZHVjdCA9IHsgaWQ6IFwiMVwiLCBuYW1lOiBcIlByb2RcIiB9IGFzIHVua25vd24gYXMgUHJvZHVjdDtcbiAgICAgIGplc3Quc3B5T24oYWRtaW5TZXJ2aWNlLCBcIkNyZWF0ZVByb2R1Y3RcIikubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3QpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLkNyZWF0ZVByb2R1Y3QobW9ja1Byb2R1Y3QpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgbWVzc2FnZTogXCJQcm9kdWN0IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5XCIsXG4gICAgICAgICAgZGF0YTogbW9ja1Byb2R1Y3QsXG4gICAgICAgIH0pLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJVcGRhdGVQcm9kdWN0XCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCB1cGRhdGUgcHJvZHVjdFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0XG4gICAgICAgIC5zcHlPbihhZG1pblNlcnZpY2UsIFwiVXBkYXRlUHJvZHVjdFwiKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUoXCJQcm9kdWN0IHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5XCIpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLlVwZGF0ZVByb2R1Y3Qoe1xuICAgICAgICBpZDogXCIxXCIsXG4gICAgICAgIHVwZGF0ZWRQcm9kdWN0OiB7XG4gICAgICAgICAgbmFtZTogXCJuZXdcIixcbiAgICAgICAgICBpZDogXCJcIixcbiAgICAgICAgICBkZXNjcmlwdGlvbjogXCJcIixcbiAgICAgICAgICBwcmljZTogMCxcbiAgICAgICAgICBzdG9jazogMCxcbiAgICAgICAgICBpbWFnZXM6IFtdLFxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgcmV2aWV3czogW10sXG4gICAgICAgICAgY2FydEl0ZW1zOiBbXSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICBtZXNzYWdlOiBcIlByb2R1Y3QgdXBkYXRlZCBzdWNjZXNzZnVsbHlcIixcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIkRlbGV0ZVByb2R1Y3RcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIGRlbGV0ZSBwcm9kdWN0XCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3RcbiAgICAgICAgLnNweU9uKGFkbWluU2VydmljZSwgXCJEZWxldGVQcm9kdWN0XCIpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZShcIlByb2R1Y3QgZGVsZXRlZCBzdWNjZXNzZnVsbHlcIik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuRGVsZXRlUHJvZHVjdChcIjFcIik7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICBtZXNzYWdlOiBcIlByb2R1Y3QgZGVsZXRlZCBzdWNjZXNzZnVsbHlcIixcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIkZpbmRfQ2FydFwiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgcmV0dXJuIGNhcnQgYnkgaWRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0NhcnQgPSB7IGlkOiBcIjFcIiB9IGFzIHVua25vd24gYXMgQ2FydDtcbiAgICAgIGplc3Quc3B5T24oYWRtaW5TZXJ2aWNlLCBcIkZpbmRfQ2FydFwiKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ2FydCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRyb2xsZXIuRmluZF9DYXJ0KHsgaWQ6IFwiMVwiIH0pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgbWVzc2FnZTogXCJDYXJ0IHJldHJpZXZlZCBzdWNjZXNzZnVsbHlcIixcbiAgICAgICAgICBkYXRhOiBtb2NrQ2FydCxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIkZpbmRfQ2FydEl0ZW1cIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHJldHVybiBjYXJ0IGl0ZW0gYnkgaWRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0NhcnRJdGVtID0geyBpZDogXCIxXCIgfSBhcyB1bmtub3duIGFzIENhcnRJdGVtO1xuICAgICAgamVzdC5zcHlPbihhZG1pblNlcnZpY2UsIFwiRmluZF9DYXJ0SXRlbVwiKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQ2FydEl0ZW0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250cm9sbGVyLkZpbmRfQ2FydEl0ZW0oeyBpZDogXCIxXCIgfSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICBtZXNzYWdlOiBcIkNhcnQgaXRlbSByZXRyaWV2ZWQgc3VjY2Vzc2Z1bGx5XCIsXG4gICAgICAgICAgZGF0YTogbW9ja0NhcnRJdGVtLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiZ2V0bG9nXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCByZXR1cm4gbG9nc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrTG9ncyA9IFtcbiAgICAgICAgeyBpZDogXCIxXCIsIG1lc3NhZ2U6IFwibG9nXCIsIGxldmVsOiBcImluZm9cIiwgdGltZXN0YW1wOiBuZXcgRGF0ZSgpIH0sXG4gICAgICBdIGFzIHVua25vd24gYXMgTG9nW107XG4gICAgICBqZXN0LnNweU9uKGxvZ1NlcnZpY2UsIFwiZ2V0bG9nXCIpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tMb2dzKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udHJvbGxlci5nZXRsb2coeyB0YWtlOiAyLCBza2lwOiAwIH0pO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgbWVzc2FnZTogXCJMb2dzIHJldHJpZXZlZCBzdWNjZXNzZnVsbHlcIixcbiAgICAgICAgICBkYXRhOiBtb2NrTG9ncyxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgICAgZXhwZWN0KGxvZ1NlcnZpY2UuZ2V0bG9nKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgyLCAwKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==