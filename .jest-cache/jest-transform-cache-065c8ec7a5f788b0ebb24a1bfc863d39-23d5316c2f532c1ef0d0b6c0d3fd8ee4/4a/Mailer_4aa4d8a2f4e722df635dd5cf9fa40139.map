{"file":"/home/omar/Desktop/Protofolio_without_redis/src/auth/Mailer.ts","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,2CAAyE;AACzE,2CAA+C;AAC/C,uDAAyC;AAGlC,IAAM,YAAY,GAAlB,MAAM,YAAY;IAGH;IAFZ,WAAW,CAAyB;IAE5C,YAAoB,aAA4B;QAA5B,kBAAa,GAAb,aAAa,CAAe;QAC9C,MAAM,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAS,OAAO,CAAC,CAAC;QACtD,MAAM,QAAQ,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAS,UAAU,CAAC,CAAC;QAE5D,IAAI,CAAC,KAAK,IAAI,CAAC,QAAQ,EAAE,CAAC;YACxB,MAAM,IAAI,oCAA2B,CACnC,gFAAgF,CACjF,CAAC;QACJ,CAAC;QAED,IAAI,CAAC,WAAW,GAAG,UAAU,CAAC,eAAe,CAAC;YAC5C,OAAO,EAAE,OAAO;YAChB,IAAI,EAAE;gBACJ,IAAI,EAAE,KAAK;gBACX,IAAI,EAAE,QAAQ;aACf;SACF,CAAC,CAAC;IACL,CAAC;IAED,KAAK,CAAC,MAAM,CACV,EAAU,EACV,GAAsC;QAEtC,MAAM,GAAG,GAAG;YACV,EAAE,EAAE,EAAE;YACN,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,KAAK;YACvB,OAAO,EAAE,YAAY;YACrB,IAAI,EAAE,2DAA2D;YACjE,IAAI,EAAE;;;;;;;QAOJ,GAAG,CAAC,IAAI;;;;;;CAMf;SACI,CAAC;QAEF,IAAI,CAAC;YACH,MAAM,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;YACrC,OAAO,iBAAiB,CAAC;QAC3B,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YACrB,MAAM,IAAI,oCAA2B,CACnC,4DAA4D,CAC7D,CAAC;QACJ,CAAC;IACH,CAAC;IAED,KAAK,CAAC,sBAAsB,CAC1B,EAAU,EACV,GAAsC;QAEtC,MAAM,GAAG,GAAG;YACV,EAAE,EAAE,EAAE;YACN,IAAI,EAAE,OAAO,CAAC,GAAG,CAAC,KAAK;YACvB,OAAO,EAAE,yBAAyB;YAClC,IAAI,EAAE,uCAAuC;YAC7C,IAAI,EAAE;;;;;;;QAOJ,GAAG,CAAC,IAAI;;;;;;CAMf;SACI,CAAC;QAEF,IAAI,CAAC;YACH,MAAM,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;YACrC,OAAO,4BAA4B,CAAC;QACtC,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YACrB,MAAM,IAAI,oCAA2B,CACnC,8DAA8D,CAC/D,CAAC;QACJ,CAAC;IACH,CAAC;CACF,CAAA;AA7FY,oCAAY;uBAAZ,YAAY;IADxB,IAAA,mBAAU,GAAE;yDAIwB,sBAAa,oBAAb,sBAAa;GAHrC,YAAY,CA6FxB","names":[],"sources":["/home/omar/Desktop/Protofolio_without_redis/src/auth/Mailer.ts"],"sourcesContent":["import { Injectable, ServiceUnavailableException } from \"@nestjs/common\";\nimport { ConfigService } from \"@nestjs/config\";\nimport * as nodemailer from \"nodemailer\";\n\n@Injectable()\nexport class EmailService {\n  private transporter: nodemailer.Transporter;\n\n  constructor(private configService: ConfigService) {\n    const EMAIL = this.configService.get<string>(\"EMAIL\");\n    const PASSWORD = this.configService.get<string>(\"PASSWORD\");\n\n    if (!EMAIL || !PASSWORD) {\n      throw new ServiceUnavailableException(\n        \"Email service not configured. Missing EMAIL or PASSWORD environment variables.\",\n      );\n    }\n\n    this.transporter = nodemailer.createTransport({\n      service: \"gmail\",\n      auth: {\n        user: EMAIL,\n        pass: PASSWORD,\n      },\n    });\n  }\n\n  async Mailer(\n    to: string,\n    dto: { code: string; expiresAt: Date },\n  ): Promise<string> {\n    const msg = {\n      to: to,\n      from: process.env.EMAIL,\n      subject: \"كود التحقق\",\n      text: \"ادخل كود التحقق في الموقع قبل 15 دقيقه نسمح فقط بمحاولتان\",\n      html: `\n  <div style=\"font-family: Arial, sans-serif; max-width: 400px; margin: auto; padding: 20px; border: 1px solid #eee; border-radius: 8px; background-color: #fafafa; text-align: center;\">\n    <h2 style=\"color: #333;\">Email Verification</h2>\n    <p style=\"font-size: 14px; color: #555;\">\n      استخدم الكود أدناه لتأكيد بريدك الإلكتروني. الكود صالح لمدة 15 دقيقة.\n    </p>\n    <div style=\"font-size: 24px; font-weight: bold; letter-spacing: 4px; color: #2d89ef; margin: 20px 0;\">\n      ${dto.code}\n    </div>\n    <p style=\"font-size: 12px; color: #999;\">\n      إذا لم تطلب هذا الكود تجاهل هذه الرسالة.\n    </p>\n  </div>\n`,\n    };\n\n    try {\n      await this.transporter.sendMail(msg);\n      return \"the Email sent!\";\n    } catch (error) {\n      console.error(error);\n      throw new ServiceUnavailableException(\n        \"Failed to send verification email. Please try again later.\",\n      );\n    }\n  }\n\n  async sendPasswordResetEmail(\n    to: string,\n    dto: { code: string; expiresAt: Date },\n  ): Promise<string> {\n    const msg = {\n      to: to,\n      from: process.env.EMAIL,\n      subject: \"إعادة تعيين كلمة المرور\",\n      text: \"استخدم الرقم الموجود وضعه في الموقعنا\",\n      html: `\n  <div style=\"font-family: Arial, sans-serif; max-width: 400px; margin: auto; padding: 20px; border: 1px solid #eee; border-radius: 8px; background-color: #fafafa; text-align: center;\">\n    <h2 style=\"color: #333;\">Password Reset</h2>\n    <p style=\"font-size: 14px; color: #555;\">\n      استخدم الرقم أدناه لإعادة تعيين كلمة المرور الخاصة بك. الرقم صالح لمدة ساعة واحدة.\n    </p>\n    <div style=\"font-size: 12px; font-family: monospace; color: #2d89ef; margin: 20px 0; padding: 10px; background: #f0f0f0; border-radius: 4px; word-break: break-all;\">\n      ${dto.code}\n    </div>\n    <p style=\"font-size: 12px; color: #999;\">\n      إذا لم تطلب إعادة تعيين كلمة المرور، تجاهل هذه الرسالة.\n    </p>\n  </div>\n`,\n    };\n\n    try {\n      await this.transporter.sendMail(msg);\n      return \"Password reset email sent!\";\n    } catch (error) {\n      console.error(error);\n      throw new ServiceUnavailableException(\n        \"Failed to send password reset email. Please try again later.\",\n      );\n    }\n  }\n}\n"],"version":3}